// modules are defined as an array
// [ module function, map of requires ]
//
// map of requires is short require name -> numeric require
//
// anything defined in a previous bundle is accessed via the
// orig method which is the require for previous bundles

require = (function (modules, cache, entry) {
  // Save the require from previous bundle to this closure if any
  var previousRequire = typeof require === "function" && require;

  function newRequire(name, jumped) {
    if (!cache[name]) {
      if (!modules[name]) {
        // if we cannot find the module within our internal map or
        // cache jump to the current global require ie. the last bundle
        // that was added to the page.
        var currentRequire = typeof require === "function" && require;
        if (!jumped && currentRequire) {
          return currentRequire(name, true);
        }

        // If there are other bundles on this page the require from the
        // previous one is saved to 'previousRequire'. Repeat this as
        // many times as there are bundles until the module is found or
        // we exhaust the require chain.
        if (previousRequire) {
          return previousRequire(name, true);
        }

        var err = new Error('Cannot find module \'' + name + '\'');
        err.code = 'MODULE_NOT_FOUND';
        throw err;
      }

      function localRequire(x) {
        return newRequire(localRequire.resolve(x));
      }

      localRequire.resolve = function (x) {
        return modules[name][1][x] || x;
      };

      var module = cache[name] = new newRequire.Module;
      modules[name][0].call(module.exports, localRequire, module, module.exports);
    }

    return cache[name].exports;
  }

  function Module() {
    this.bundle = newRequire;
    this.exports = {};
  }

  newRequire.Module = Module;
  newRequire.modules = modules;
  newRequire.cache = cache;
  newRequire.parent = previousRequire;

  for (var i = 0; i < entry.length; i++) {
    newRequire(entry[i]);
  }

  // Override the current require with this new one
  return newRequire;
})({11:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});let t=exports.gameEl=document.getElementById("game");t.innerHTML="",t.setAttribute("padding","0px");const e=exports.ASPECT_RATIO=14/9;let o=exports.width=Math.min(t.offsetWidth,1200),r=exports.height=o/e,s=exports.bounds={left:0,right:o,top:0,bottom:r},n=exports.unitX=o/100,p=exports.unitY=r/100,i=exports.scaleX=function(t){return n*t},x=exports.scaleY=function(t){return p*t};const u=exports.MAX_BALL_SPEED_X=150,c=exports.PADDLE_LEFT_RIGHT=!0;
},{}],4:[function(require,module,exports) {
"use strict";function t(t){if(t&&t.__esModule)return t;var s={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i]);return s.default=t,s}var s=require("./setup"),i=t(s);Crafty.c("Bounded",{restrict(){let t=this.w||10,s=this.h||10;this.x>=i.bounds.right-t&&(this.x=i.bounds.right-t),this.x<=i.bounds.left&&(this.x=i.bounds.left),this.y>=i.bounds.bottom-s&&(this.y=i.bounds.bottom-s),this.y<=i.bounds.top&&(this.y=i.bounds.top)},bounceOffWalls(){let t=this.w||10,s=this.h||10;this.restrict.call(this),this.x!==i.bounds.left&&this.x!==i.bounds.right-t||this.vx&&(this.vx*=-1),this.y!==i.bounds.bottom-s&&this.y!==i.bounds.top||this.vy&&(this.vy*=-1)}});
},{"./setup":11}],5:[function(require,module,exports) {
"use strict";function i(i){if(i&&i.__esModule)return i;var t={};if(null!=i)for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t.default=i,t}var t=require("./setup"),e=i(t);Crafty.c("Paddle",{startPaddle({up:i,down:t,left:s,right:r,x:h,y:n}){this.addComponent("2D, Canvas, Color, Keyboard, Bounded, Solid"),this.speed=e.scaleX(60),this.w=e.scaleX(1.5),this.h=e.scaleY(15),this.movingDir=0;let o=this;this.bind("movePaddles",function(h){this.isDown(i)?(o.y-=o.speed*(h/1e3),this.movingDir=-1):this.isDown(t)?(o.y+=o.speed*(h/1e3),this.movingDir=1):this.movingDir=0,e.PADDLE_LEFT_RIGHT&&(this.isDown(s)?o.x-=o.speed*(h/1e3):this.isDown(r)&&(o.x+=o.speed*(h/1e3))),this.restrict.call(this)}),this.place.call(this,h,n)},place(i,t){return this.x=i,this.y=t,this}});
},{"./setup":11}],14:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=exports.score1=0,o=exports.score2=0,t=exports.bounceCount=0,r=exports.whoJustScored=0,n=exports.gameMode=0,s=exports.cpuMode=1;const c=exports.winningCount=7;let p=exports.incrementScore1=function(){exports.score1=e+=1,exports.whoJustScored=r=1,e>=c&&Crafty.enterScene("winner")},u=exports.incrementScore2=function(){exports.score2=o+=1,exports.whoJustScored=r=2,o>=c&&Crafty.enterScene("winner")},x=exports.incrementBounceCount=function(){exports.bounceCount=t+=1,Crafty.trigger("updateBounceCount")},i=exports.prepForRound=function(){exports.whoJustScored=r=0};
},{}],17:[function(require,module,exports) {
module.exports="/d85a8d23853ff0b96a9500028177bf63.png";
},{}],6:[function(require,module,exports) {
"use strict";function i(i){return i&&i.__esModule?i:{default:i}}function t(i){if(i&&i.__esModule)return i;var t={};if(null!=i)for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t.default=i,t}var e=require("./setup"),l=t(e),n=require("./score"),s=require("./ball-final.png"),o=i(s);Crafty.c("Ball",{start({x:i,y:t,vx:e,vy:s}){this.isCollidingWithPaddle=!1,this.addComponent("2D, Canvas, Color, Bounded, Solid, Collision, pingpongball"),this.x=i,this.y=t,this.vx=e,this.vy=s;let o=this;this.bind("moveBall",function(i){o.x+=o.vx*(i/1e3),o.y+=o.vy*(i/1e3),this.bounceOffWalls();var t;(t=this.hit("Paddle"))?(this.isCollidingWithPaddle||(this.vx*=-1,this.vy+=l.scaleY(30)*t[0].obj.movingDir,(0,n.incrementBounceCount)()),this.isCollidingWithPaddle=!0):this.isCollidingWithPaddle=!1,this.x===l.bounds.left&&(0,n.incrementScore2)(),this.x===l.bounds.right-this.w&&(0,n.incrementScore1)()})}});
},{"./setup":11,"./score":14,"./ball-final.png":17}],18:[function(require,module,exports) {
"use strict";function t(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e.default=t,e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.UI_COLOR=exports.menuUISingleton=exports.bounceCountText=exports.menuSubText=exports.menuStartText3=exports.menuStartText2=exports.menuStartText=exports.winnerText=exports.someoneJustWonText=exports.startInstructionsText=exports.menuTitleText=exports.score2Text=exports.score1Text=exports.titleText=void 0;var e=require("./setup"),o=t(e),r=require("./score"),s=exports.titleText=void 0,x=exports.score1Text=void 0,i=exports.score2Text=void 0,n=exports.menuTitleText=void 0,T=exports.startInstructionsText=void 0,u=exports.someoneJustWonText=void 0,a=exports.winnerText=void 0,c=exports.menuStartText=void 0,p=exports.menuStartText2=void 0,h=exports.menuStartText3=void 0,d=exports.menuSubText=void 0,l=exports.bounceCountText=void 0;Crafty.c("menuUISingleton",{init(){this.bind("initMenuUI",function(){exports.menuTitleText=n=Crafty.e("GAMEUITEXT"),n.start({x:o.width/2-250,y:o.height/2-100,w:500,h:500,text:"Crafty Pong!",size:48,color:f}),exports.menuSubText=d=Crafty.e("GAMEUITEXT"),d.start({x:o.width/2-250,y:o.height/2,w:500,h:500,text:"made with Parcel.js and Crafty.js",size:14,color:f}),exports.menuStartText=c=Crafty.e("GAMEUITEXT"),c.start({x:o.width/2-250,y:o.height/2+50,w:500,h:500,text:"(A) Easy CPU",size:20,color:f}),c.textAlign("left"),exports.menuStartText2=p=Crafty.e("GAMEUITEXT"),p.start({x:o.width/2-250,y:o.height/2+70,w:500,h:500,text:"(B) Hard CPU",size:20,color:f}),p.textAlign("left"),exports.menuStartText3=h=Crafty.e("GAMEUITEXT"),h.start({x:o.width/2-250,y:o.height/2+90,w:500,h:500,text:"(C) 2-Player",size:20,color:f}),h.textAlign("left")}),this.bind("updateBounceCount",function(){void 0!==l&&l.destroy(),exports.bounceCountText=l=Crafty.e("GAMEUITEXT"),l.start({x:400,y:10,w:200,text:"Bounce count: "+r.bounceCount,size:14,color:f})}),this.bind("initGameUI",function(){exports.titleText=s=Crafty.e("GAMEUITEXT"),s.start({x:100,y:10,w:200,text:"Craftyjs Pong",size:20,color:f}),exports.score1Text=x=Crafty.e("GAMEUITEXT"),x.start({x:200,y:10,w:200,text:"score 1: "+r.score1,size:10,color:f}),exports.score2Text=i=Crafty.e("GAMEUITEXT"),i.start({x:300,y:10,w:200,text:"score 2: "+r.score2,size:10,color:f}),Crafty.trigger("updateBounceCount")}),this.bind("displaySomeoneJustWonText",function(){exports.someoneJustWonText=u=Crafty.e("GAMEUITEXT"),u.start({x:o.width/2,y:o.height/2,w:200,text:"Player "+r.whoJustScored+" scored!",size:20,color:f})}),this.bind("showWinnerUI",function(){exports.winnerText=a=Crafty.e("GAMEUITEXT"),a.start({x:o.width/2,y:o.height/2,w:200,text:"Player "+r.whoJustScored+" won!",size:20,color:f})})}});var y=exports.menuUISingleton=Crafty.e("menuUISingleton");const f=exports.UI_COLOR="#7fdbff";Crafty.c("GAMEUITEXT",{start({x:t,y:e,h:o,w:r,text:s,size:x,color:i}){this.addComponent("2D, DOM, Text"),this.x=t,this.y=e,this.h=o,this.w=r,this.textFont({size:x+"px",weight:"bold"}),this.textColor(i),this.setText(s),this.textAlign("center")},setText(t){this.text(t)}});
},{"./setup":11,"./score":14}],7:[function(require,module,exports) {
"use strict";function e(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n.default=e,n}var n=require("./ui"),r=e(n),t=require("./score"),i=e(t);Crafty.defineScene("mainMenu",function(){Crafty.trigger("initMenuUI");var e=Crafty.e("2D, DOM, Keyboard");e.x=0,e.y=0,e.bind("KeyDown",function(){this.isDown(Crafty.keys.A)?(i.gameMode=1,i.cpuMode=0,e.unbind("KeyDown"),Crafty.enterScene("playRound")):this.isDown(Crafty.keys.B)?(i.gameMode=1,i.cpuMode=1,e.unbind("KeyDown"),Crafty.enterScene("playRound")):this.isDown(Crafty.keys.C)&&(i.gameMode=2,e.unbind("KeyDown"),Crafty.enterScene("playRound"))})});
},{"./score":14,"./ui":18}],8:[function(require,module,exports) {
"use strict";function t(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=t[r]);return i.default=t,i}var i=require("./setup"),r=t(i),e=require("./score"),s=t(e);Crafty.c("CpuPaddle",{start({x:t,y:i,ball:e}){var o=this;this.addComponent("Paddle"),this.cpuSpeed=r.scaleY(25),this.startPaddle({x:t,y:i}),this.yv=0,this.ball=e,this.pid={p:.1,i:.001,iAccumulator:0,iCap:2,d:.1,error(){var t=r.bounds.bottom/2;let i=e.y+e.h/2,s=e.x+e.w/2;e.vx>0&&((t=i+e.vy*((r.bounds.right-s)/e.vx))<r.bounds.top-200||t>r.bounds.bottom+200)&&(t=r.bounds.bottom/2);return t-(o.y+o.h/2)},step(){return this.iAccumulator=Math.min(this.iAccumulator+this.error()*this.i,this.iCap),this.error()*this.p+this.iAccumulator}},this.bind("movePaddles",function(t){if(void 0!==o.ball){let r=o.y;1===s.cpuMode?(o.yv=o.pid.step(),o.y+=o.yv):o.y+=Math.sign(e.y-o.y)*o.cpuSpeed*(t/1e3),o.movingDir=i<r?-1:i>r?-1:0}})}});
},{"./setup":11,"./score":14}],9:[function(require,module,exports) {
"use strict";function e(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a.default=e,a}var a=require("./ui"),r=e(a),t=require("./setup"),l=e(t),s=require("./score"),f=e(s);Crafty.defineScene("playRound",function(){Crafty.trigger("initGameUI");var e;(e=Crafty.e("Ball")).start({x:l.width/2-l.scaleX(5)/2,y:l.height/2-l.scaleY(5*l.ASPECT_RATIO)/2,vx:l.scaleX((Math.random()>.5?1:-1)*(20+20*Math.random())),vy:l.scaleY((Math.random()>.5?1:-1)*(20+20*Math.random()))});let a=Crafty.e("Paddle");a.startPaddle({up:Crafty.keys.W,down:Crafty.keys.S,left:Crafty.keys.A,right:Crafty.keys.D,x:l.bounds.left+l.scaleX(2),y:l.height/2-l.scaleY(15)/2}),a.color("#01ff70");var r;1===f.gameMode?(r=Crafty.e("CpuPaddle")).start({x:l.bounds.right-l.scaleX(2)-l.scaleX(1.5),y:l.height/2-l.scaleY(15)/2,ball:e}):(r=Crafty.e("Paddle")).startPaddle({up:Crafty.keys.UP_ARROW,down:Crafty.keys.DOWN_ARROW,left:Crafty.keys.LEFT_ARROW,right:Crafty.keys.RIGHT_ARROW,x:l.bounds.right-l.scaleX(2)-l.scaleX(1.5),y:l.height/2-l.scaleY(15)/2}),r.color("#ff4136");var t,s=!0,y=!1,d=!1,o=0;Crafty.e("2D, Canvas").bind("EnterFrame",function(a){0!==f.whoJustScored&&(d||(o=a.frame),d=!0,Crafty.trigger("displaySomeoneJustWonText")),d?a.frame-o>60&&(f.prepForRound(),Crafty.enterScene("playRound")):(y&&(Crafty.trigger("movePaddles",a.dt),Crafty.trigger("moveBall",a.dt)),s&&(s=!1,t=a.frame),a.frame-t>60&&!y&&(y=!0),y&&a.frame%60==0&&Math.abs(e.vx)<l.scaleX(l.MAX_BALL_SPEED_X)&&(e.vx*=1.1))})});
},{"./setup":11,"./score":14,"./ui":18}],10:[function(require,module,exports) {
Crafty.defineScene("winner",function(){Crafty.trigger("showWinnerUI")});
},{}],12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=exports.randomInRange=function(e,t){return e+Math.random()*(t-e)};
},{}],13:[function(require,module,exports) {
"use strict";function e(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.startGame=void 0;var t=require("./ball-final.png"),a=e(t);let r={sprites:{[a.default]:{tile:123,tileh:123,map:{pingpongball:[0,0]}}}};const n=exports.startGame=function(){Crafty.paths({images:"/pong-crafty-parcel/"}),Crafty.load(r,function(){Crafty.enterScene("mainMenu")})};
},{"./ball-final.png":17}],21:[function(require,module,exports) {
function e(e,i,t){Object.defineProperty(e,i,{enumerable:!1,configurable:!1,get:function(){return e[t]},set:function(i){e[t]=i}})}module.exports={defineAliases:function(i){e(i,"image_whitelist","imageWhitelist")}};
},{}],70:[function(require,module,exports) {
module.exports="0.8.0";
},{}],22:[function(require,module,exports) {
function t(){var e=i++;return e in s?t():e}function e(t){if(null===t||"object"!=typeof t)return t;var i=t.constructor();for(var n in t)i[n]=e(t[n]);return i}var i,n,r,s,o,a,u,h,c,l=require("./version"),f=function(t){return new f.fn.init(t)};r={},u=Array.prototype.slice,h=/\s*,\s*/,c=/\s+/;var d=function(){i=1,n=0,s={},o={},a=[]};d(),f.fn=f.prototype={init:function(t){if("string"!=typeof t)return t||(t=0)in s||(s[t]=this),t in s?(this[0]=t,this.length=1,this.__c||(this.__c={}),this._callbacks||f._addCallbackMethods(this),s[t]||(s[t]=this),s[t]):(this.length=0,this);var e,i,n,o,a,u,l,d=0,g=!1,m=!1;if("*"===t){u=0;for(e in s)this[u]=+e,u++;return this.length=u,1===u?s[this[0]]:this}-1!==t.indexOf(",")?(m=!0,n=h):-1!==t.indexOf(" ")&&(g=!0,n=c);for(e in s)if(s.hasOwnProperty(e))if(i=s[e],g||m){for(u=0,l=(o=t.split(n)).length,a=0;u<l;u++)i.__c[o[u]]&&a++;(g&&a===l||m&&a>0)&&(this[d++]=+e)}else i.__c[t]&&(this[d++]=+e);if(d>0&&!g&&!m&&this.extend(r[t]),o&&g)for(u=0;u<l;u++)this.extend(r[o[u]]);return this.length=d,1===d?s[this[d-1]]:(f._addCallbackMethods(this),this)},setName:function(t){var e=String(t);return this._entityName=e,this.trigger("NewEntityName",e),this},getName:function(t){return this._entityName},addComponent:function(t){var e,i,n=0;for(e=1===arguments.length&&-1!==t.indexOf(",")?t.split(h):arguments;n<e.length;n++)if(!0!==this.__c[e[n]]&&(this.__c[e[n]]=!0,i=r[e[n]],this.extend(i),i&&"required"in i&&this.requires(i.required),i&&"init"in i&&i.init.call(this),i&&"events"in i)){var s=i.events;for(var o in s){var a="function"==typeof s[o]?s[o]:i[s[o]];this.bind(o,a)}}return this.trigger("NewComponent",e),this},toggleComponent:function(t){var e,i,n=0;if(arguments.length>1)for(e=arguments.length;n<e;n++)this.has(arguments[n])?this.removeComponent(arguments[n]):this.addComponent(arguments[n]);else if(-1!==t.indexOf(","))for(e=(i=t.split(h)).length;n<e;n++)this.has(i[n])?this.removeComponent(i[n]):this.addComponent(i[n]);else this.has(t)?this.removeComponent(t):this.addComponent(t);return this},requires:function(t){return this.addComponent(t)},removeComponent:function(t,e){var i=r[t];if(this.trigger("RemoveComponent",t),i&&"events"in i){var n=i.events;for(var s in n){var o="function"==typeof n[s]?n[s]:i[n[s]];this.unbind(s,o)}}if(i&&"remove"in i&&i.remove.call(this,!1),!1===e&&i)for(var a in i)delete this[a];return delete this.__c[t],this},getId:function(){return this[0]},has:function(t){return!!this.__c[t]},attr:function(t,e,i,n){return 1===arguments.length&&"string"==typeof arguments[0]?this._attr_get(t):this._attr_set(t,e,i,n)},_attr_get:function(t,e){var i,n;return void 0!==e&&null!==e||(e=this),t.indexOf(".")>-1?(n=t.split("."),i=n.shift(),n.join("."),this._attr_get(n.join("."),e[i])):e[t]},_attr_set:function(){var t,e,i;return"string"==typeof arguments[0]?(t=this._set_create_object(arguments[0],arguments[1]),e=!!arguments[2],i=arguments[3]||arguments[0].indexOf(".")>-1):(t=arguments[0],e=!!arguments[1],i=!!arguments[2]),e||this.trigger("Change",t),i?this._recursive_extend(t,this):this.extend.call(this,t),this},_set_create_object:function(t,e){var i,n,r,s={};return t.indexOf(".")>-1?(n=(i=t.split(".")).shift(),r=i.join("."),s[n]=this._set_create_object(r,e)):s[t]=e,s},_recursive_extend:function(t,e){var i;for(i in t)t[i].constructor===Object?e[i]=this._recursive_extend(t[i],e[i]):e[i]=t[i];return e},toArray:function(){return u.call(this,0)},timeout:function(t,e){return this.each(function(){var i=this;setTimeout(function(){t.call(i)},e)}),this},bind:function(t,e){if(1===this.length)this._bindCallback(t,e);else for(var i=0;i<this.length;i++){var n=s[this[i]];n&&n._bindCallback(t,e)}return this},uniqueBind:function(t,e){this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(r){e.call(i,r),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){var i,n;for(i=0;i<this.length;i++)(n=s[this[i]])&&n._unbindCallbacks(t,e);return this},trigger:function(t,e){if(1===this.length)this._runCallbacks(t,e);else for(var i=0;i<this.length;i++){var n=s[this[i]];n&&n._runCallbacks(t,e)}return this},each:function(t){for(var e=0,i=this.length;e<i;e++)s[this[e]]&&t.call(s[this[e]],e);return this},get:function(t){var e=this.length;if(void 0!==t){if(t>=e||t+e<0)return;return t>=0?s[this[t]]:s[this[t+e]]}for(var i=0,n=[];i<e;i++)s[this[i]]&&n.push(s[this[i]]);return n},clone:function(){var t,e,i=this.__c,n=f.e();for(t in i)n.addComponent(t);for(e in this)"0"!==e&&"_global"!==e&&"_changed"!==e&&"function"!=typeof this[e]&&"object"!=typeof this[e]&&(n[e]=this[e]);return n},setter:function(t,e){return this.defineField(t,function(){},e)},defineField:function(t,e,i){return f.defineField(this,t,e,i),this},destroy:function(){this.each(function(){var t;this.trigger("Remove");for(var e in this.__c)(t=r[e])&&"remove"in t&&t.remove.call(this,!0);this._unbindAll(),delete s[this[0]]})}},f.fn.init.prototype=f.fn,f.extend=f.fn.extend=function(t){var e;if(!t)return this;for(e in t)this!==t[e]&&(this[e]=t[e]);return this},f._callbackMethods={_bindCallback:function(t,e){var i=this._callbacks[t];i||((i=this._callbacks[t]=(o[t]||(o[t]={}))[this[0]]=[]).context=this,i.depth=0),i.push(e)},_runCallbacks:function(t,e){if(this._callbacks[t]){var i,n=this._callbacks[t],r=n.length;for(n.depth++,i=0;i<r;i++)void 0===n[i]?n.depth<=1&&(n.splice(i,1),i--,r--,0===n.length&&(delete this._callbacks[t],delete o[t][this[0]])):n[i].call(this,e);n.depth--}},_unbindCallbacks:function(t,e){if(this._callbacks[t])for(var i=this._callbacks[t],n=0;n<i.length;n++)e&&i[n]!==e||delete i[n]},_unbindAll:function(){if(this._callbacks)for(var t in this._callbacks)this._callbacks[t]&&(this._unbindCallbacks(t),delete o[t][this[0]])}},f._addCallbackMethods=function(t){t.extend(f._callbackMethods),t._callbacks={}},f._addCallbackMethods(f),f.extend({0:"global",init:function(t,e,i){if(!this._preBindDone)for(var n=0;n<this._bindOnInit.length;n++){var r=this._bindOnInit[n];f.bind(r.event,r.handler)}return f.viewport.init(t,e,i),this.trigger("Load"),this.timer.init(),this},_bindOnInit:[],_preBindDone:!1,_preBind:function(t,e){this._bindOnInit.push({event:t,handler:e})},getVersion:function(){return l},stop:function(t){if(f.trigger("CraftyStop",t),this.timer.stop(),t){f.audio.remove();for(var e in f._systems)f._systems[e].destroy();if(f.stage&&f.stage.elem.parentNode){var i=document.createElement("div");i.id=f.stage.elem.id,f.stage.elem.parentNode.replaceChild(i,f.stage.elem)}f._unbindAll(),f._addCallbackMethods(f),this._preBindDone=!1,d()}return this},pause:function(t){return(1===arguments.length?t:!this._paused)?(this.trigger("Pause"),this._paused=!0,setTimeout(function(){f.timer.stop()},0),f.keydown={}):(this.trigger("Unpause"),this._paused=!1,setTimeout(function(){f.timer.init()},0)),this},isPaused:function(){return this._paused},timer:function(){var t,e,i,r="fixed",s=5,o=40,a=0,u=0,h=50,c=1e3/h;return{init:function(){void 0===i&&(i=(new Date).getTime()-c);var n="undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null);n?(t=function(){f.timer.step(),null!==t&&(e=n(t))})():t=setInterval(function(){f.timer.step()},1e3/h)},stop:function(){f.trigger("CraftyStopTimer"),"function"!=typeof t&&clearInterval(t);var i="undefined"!=typeof window&&(window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null);i&&i(e),t=null},steptype:function(t,e){if("variable"===t||"semifixed"===t)r=t,e&&(o=e),f.trigger("NewSteptype",{mode:r,maxTimeStep:o});else{if("fixed"!==t){if(void 0!==t)throw"Invalid step type specified";return{mode:r,maxTimeStep:"variable"===r||"semifixed"===r?o:s}}r="fixed",e&&(s=e),f.trigger("NewSteptype",{mode:r,maxTimeStep:s})}},step:function(){var t,e,h,l=0,d=(new Date).getTime();if(a>0&&f.trigger("MeasureWaitTime",d-a),i+u>=d)a=d;else{var g=d-(i+u);g>20*c&&(u+=g-c,g=c),"fixed"===r?(l=Math.ceil(g/c),l=Math.min(l,s),e=c):"variable"===r?(l=1,e=g,e=Math.min(e,o)):"semifixed"===r&&(e=g/(l=Math.ceil(g/o)));for(var m=0;m<l;m++){h=d;var _={frame:n++,dt:e,gameTime:i};f.trigger("EnterFrameInput",_),f.trigger("EnterFrame",_),f.trigger("ExitFrame",_),i+=e,d=(new Date).getTime(),f.trigger("MeasureFrameTime",d-h)}l>0&&(t=d,f.trigger("PreRender"),f.trigger("RenderScene"),f.trigger("PostRender"),d=(new Date).getTime(),f.trigger("MeasureRenderTime",d-t)),a=d}},FPS:function(t){if(void 0===t)return h;c=1e3/(h=t),f.trigger("FPSChange",t)},simulateFrames:function(t,e){for(e=e||c;t-- >0;){var i={frame:n++,dt:e};f.trigger("EnterFrameInput",i),f.trigger("EnterFrame",i),f.trigger("ExitFrame",i)}f.trigger("PreRender"),f.trigger("RenderScene"),f.trigger("PostRender")}}}(),e:function(){var e=t();return s[e]=null,s[e]=f(e),arguments.length>0&&s[e].addComponent.apply(s[e],arguments),s[e].setName("Entity #"+e),s[e].addComponent("obj"),f.trigger("NewEntity",{id:e}),s[e]},c:function(t,e){r[t]=e},trigger:function(t,e){var i,n,r=o[t]||(o[t]={});for(i in r)r.hasOwnProperty(i)&&(n=r[i])&&0!==n.length&&n.context._runCallbacks(t,e)},bind:function(t,e){return this._bindCallback(t,e),e},uniqueBind:function(t,e){return this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(r){e.call(i,r),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){this._unbindCallbacks(t,e)},frame:function(){return n},components:function(){return r},isComp:function(t){return t in r},debug:function(t){return"handlers"===t?o:s},settings:function(){var t={},e={};return{register:function(t,i){e[t]=i},modify:function(i,n){e[i]&&(e[i].call(t[i],n),t[i]=n)},get:function(e){return t[e]}}}(),defineField:function(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,configurable:!1,enumerable:!0})},clone:e}),"function"==typeof define&&define("crafty",[],function(){return f}),module.exports=f;
},{"./version":70}],23:[function(require,module,exports) {
var t=require("../core/core.js"),i=function(i,s){this.timePerFrame=1e3/t.timer.FPS(),this.duration=i,"function"==typeof s?this.easing_function=s:"string"==typeof s&&this.standardEasingFunctions[s]?this.easing_function=this.standardEasingFunctions[s]:this.easing_function=this.standardEasingFunctions.linear,this.reset()};i.prototype={duration:0,clock:0,steps:null,complete:!1,paused:!1,reset:function(){this.loops=1,this.clock=0,this.complete=!1,this.paused=!1},repeat:function(t){this.loops=t},setProgress:function(t,i){this.clock=this.duration*t,void 0!==i&&(this.loops=i)},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.complete=!1},tick:function(t){if(!this.paused&&!this.complete)for(this.clock+=t,this.frames=Math.floor(this.clock/this.timePerFrame);this.clock>=this.duration&&!1===this.complete;)this.loops--,this.loops>0?this.clock-=this.duration:this.complete=!0},time:function(){return Math.min(this.clock/this.duration,1)},value:function(){return this.easing_function(this.time())},standardEasingFunctions:{linear:function(t){return t},smoothStep:function(t){return(3-2*t)*t*t},smootherStep:function(t){return(6*t*t-15*t+10)*t*t*t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1}}},module.exports=i;
},{"../core/core.js":22}],68:[function(require,module,exports) {

function t(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function n(e){if(s===setTimeout)return setTimeout(e,0);if((s===t||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}function r(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function o(){m&&f&&(m=!1,f.length?h=f.concat(h):p=-1,h.length&&i())}function i(){if(!m){var t=n(o);m=!0;for(var e=h.length;e;){for(f=h,h=[];++p<e;)f&&f[p].run();p=-1,e=h.length}f=null,m=!1,r(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var s,l,a=module.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:t}catch(e){s=t}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var f,h=[],m=!1,p=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new u(t,e)),1!==h.length||m||n(i)},u.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=c,a.addListener=c,a.once=c,a.off=c,a.removeListener=c,a.removeAllListeners=c,a.emit=c,a.prependListener=c,a.prependOnceListener=c,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0};
},{}],24:[function(require,module,exports) {
var process = require("process");
var e=require("process"),n=require("../core/core.js"),t="undefined"!=typeof window&&window.document;!function(){var i=n.support={},o="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase()||void 0!==e&&e.version,r=/(webkit)[ \/]([\w.]+)/.exec(o)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(o)||/(ms)ie ([\w.]+)/.exec(o)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(o)||/(v)\d+\.(\d+)/.exec(o)||[],d=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(o);if(d&&(n.mobile=d[0]),i.defineProperty=function(){if(!("defineProperty"in Object))return!1;try{Object.defineProperty({},"x",{})}catch(e){return!1}return!0}(),i.audio="undefined"!=typeof window&&"canPlayType"in t.createElement("audio"),i.prefix=r[1]||r[0],"moz"===i.prefix&&(i.prefix="Moz"),"o"===i.prefix&&(i.prefix="O"),"v"===i.prefix&&(i.prefix="node"),r[2]&&(i.versionName=r[2],i.version=+r[2].split(".")[0]),i.canvas="undefined"!=typeof window&&"getContext"in t.createElement("canvas"),i.canvas){var v;try{var a=t.createElement("canvas");(v=a.getContext("webgl")||a.getContext("experimental-webgl")).viewportWidth=i.canvas.width,v.viewportHeight=i.canvas.height}catch(e){}i.webgl=!!v}else i.webgl=!1;i.css3dtransform="undefined"!=typeof window&&(void 0!==t.createElement("div").style.Perspective||void 0!==t.createElement("div").style[i.prefix+"Perspective"]),i.deviceorientation="undefined"!=typeof window&&(void 0!==window.DeviceOrientationEvent||void 0!==window.OrientationEvent),i.devicemotion="undefined"!=typeof window&&void 0!==window.DeviceMotionEvent}(),module.exports={_events:{},addEvent:function(e,n,t,i){3===arguments.length&&(i=t,t=n,n=window.document);var o=function(n){i.call(e,n)},r=e[0]||"";this._events[r+n+t+i]||(this._events[r+n+t+i]=o,n.addEventListener(t,o,!1))},removeEvent:function(e,n,t,i){3===arguments.length&&(i=t,t=n,n=window.document);var o=e[0]||"",r=this._events[o+n+t+i];r&&(n.removeEventListener(t,r,!1),delete this._events[o+n+t+i])},background:function(e){n.stage.elem.style.background=e}};
},{"process":68,"../core/core.js":22}],25:[function(require,module,exports) {
var e=require("../core/core.js");module.exports={assets:{},__paths:{audio:"",images:""},paths:function(e){if(void 0===e)return this.__paths;e.audio&&(this.__paths.audio=e.audio),e.images&&(this.__paths.images=e.images)},asset:function(s,t){return 1===arguments.length?e.assets[s]:e.assets[s]?void 0:(e.assets[s]=t,this.trigger("NewAsset",{key:s,value:t}),t)},imageWhitelist:["jpg","jpeg","gif","png","svg"],load:function(s,t,i,r){function a(){var e=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",a,!1),l++,i&&i({loaded:l,total:c,percent:l/c*100,src:e}),l===c&&t&&t()}function o(){var e=this.src;r&&r({loaded:l,total:c,percent:l/c*100,src:e}),++l===c&&t&&t()}if(Array.isArray(s))e.log("Calling Crafty.load with an array of assets no longer works; see the docs for more details.");else{var n,u,d,p,f,l=0,c=((s="string"==typeof s?JSON.parse(s):s).audio?Object.keys(s.audio).length:0)+(s.images?Object.keys(s.images).length:0)+(s.sprites?Object.keys(s.sprites).length:0),g=e.paths(),h=function(e){return e.substr(e.lastIndexOf(".")+1).toLowerCase()},v=function(e,s){return-1===s.search("://")?"audio"===e?g.audio+s:g.images+s:s},m=function(s){return e.asset(s)||null},y=function(s){return e.support.audio&&e.audio.supports(h(s))},j=function(s){return-1!==e.imageWhitelist.indexOf(h(s))},O=function(s,t){s.onload=a,"webkit"===e.support.prefix&&(s.src=""),s.src=t};for(p in s)for(f in s[p])if(s[p].hasOwnProperty(f)){if(n=s[p][f],d=null,"audio"===p){if("object"==typeof n){var b=[];for(var w in n)m(u=v(p,n[w]))||!y(n[w])||e.audio.sounds[f]||b.push(u);b.length>0&&(d=e.audio.add(f,b))}else"string"==typeof n&&(m(u=v(p,n))||!y(n)||e.audio.sounds[f]||(d=e.audio.add(f,u)));d&&(d=d.obj),d&&d.addEventListener&&d.addEventListener("canplaythrough",a,!1)}else!m(u=v(p,f="sprites"===p?f:n))&&j(f)&&(d=new Image,"sprites"===p&&e.sprite(n.tile,n.tileh,u,n.map,n.paddingX,n.paddingY,n.paddingAroundBorder),e.asset(u,d),O(d,u));d?d.onerror=o:o.call({src:u})}0===c&&t&&t()}},removeAssets:function(s){s="string"==typeof s?JSON.parse(s):s;var t,i,r,a,o=e.paths(),n=function(e,s){return-1===s.search("://")?"audio"===e?o.audio+s:o.images+s:s};for(r in s)for(a in s[r])if(s[r].hasOwnProperty(a))if(t=s[r][a],"audio"===r)if("object"==typeof t)for(var u in t)i=n(r,t[u]),e.asset(i)&&e.audio.remove(a);else"string"==typeof t&&(i=n(r,t),e.asset(i)&&e.audio.remove(a));else if(a="sprites"===r?a:t,i=n(r,a),e.asset(i)){if("sprites"===r)for(var d in t.map)delete e.components()[d];delete e.assets[i]}}};
},{"../core/core.js":22}],26:[function(require,module,exports) {
var e=require("../core/core.js");module.exports={init:function(){this.changed=[],this.bind("Change",this._changed_attributes),this.bind("Change",this._changed_triggers)},_changed_triggers:function(t,n){var i;n=e.extend.call({pre:""},n);for(i in t)this.trigger("Change["+n.pre+i+"]",t[i]),t[i].constructor===Object&&this._changed_triggers(t[i],{pre:n.pre+i+"."})},_changed_attributes:function(e){var t;for(t in e)this.changed.push(t);return this},is_dirty:function(e){return 0===arguments.length?!!this.changed.length:this.changed.indexOf(e)>-1}};
},{"../core/core.js":22}],27:[function(require,module,exports) {
var e=require("../core/core.js");module.exports={_scenes:{},_current:null,scene:function(n,t,i){1!==arguments.length&&"function"==typeof arguments[1]?e.defineScene(n,t,i):e.enterScene(n,arguments[1])},defineScene:function(e,n,t){if("function"!=typeof n)throw"Init function is the wrong type.";this._scenes[e]={},this._scenes[e].initialize=n,void 0!==t&&(this._scenes[e].uninitialize=t)},enterScene:function(n,t){if("function"==typeof t)throw"Scene data cannot be a function";e.trigger("SceneDestroy",{newScene:n}),e.viewport.reset(),e("2D").each(function(){this.has("Persist")||this.destroy()}),null!==this._current&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this);var i=this._current;this._current=n,e.trigger("SceneChange",{oldScene:i,newScene:n}),this._scenes.hasOwnProperty(n)?this._scenes[n].initialize.call(this,t):e.error('The scene "'+n+'" does not exist')}};
},{"../core/core.js":22}],28:[function(require,module,exports) {
var e=require("../core/core.js");try{var r="undefined"!=typeof window&&window.localStorage||new require("node-localstorage").LocalStorage("./localStorage")}catch(e){r=null}var o=function(o,t){var a=t;if(!r)return e.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)"),!1;if(1===arguments.length)try{return JSON.parse(r.getItem(o))}catch(e){return r.getItem(o)}else"object"==typeof t&&(a=JSON.stringify(t)),r.setItem(o,a)};o.remove=function(o){r?r.removeItem(o):e.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)")},module.exports=o;
},{"../core/core.js":22}],29:[function(require,module,exports) {
module.exports={init:function(){this._delays=[],this._delaysPaused=!1,this.bind("EnterFrame",function(a){if(!this._delaysPaused)for(var e=this._delays.length;--e>=0;){var l=this._delays[e];if(!1===l)this._delays.splice(e,1);else{for(l.accumulator+=a.dt;l.accumulator>=l.delay&&l.repeat>=0;)l.accumulator-=l.delay,l.repeat--,l.callback.call(this);l.repeat<0&&(this._delays.splice(e,1),"function"==typeof l.callbackOff&&l.callbackOff.call(this))}}})},delay:function(a,e,l,s){return this._delays.push({accumulator:0,callback:a,callbackOff:s,delay:e,repeat:(l<0?1/0:l)||0}),this},cancelDelay:function(a){for(var e=this._delays.length;--e>=0;){var l=this._delays[e];l&&l.callback===a&&(this._delays[e]=!1)}return this},pauseDelays:function(){this._delaysPaused=!0},resumeDelays:function(){this._delaysPaused=!1}};
},{}],30:[function(require,module,exports) {
var e=require("../core/core.js");module.exports={init:function(){this.tweenGroup={},this.tweenStart={},this.tweens=[],this.uniqueBind("EnterFrame",this._tweenTick)},_tweenTick:function(e){var t,n,i;for(i=this.tweens.length-1;i>=0;i--)(t=this.tweens[i]).easing.tick(e.dt),n=t.easing.value(),this._doTween(t.props,n),t.easing.complete&&(this.tweens.splice(i,1),this._endTween(t.props))},_doTween:function(e,t){for(var n in e)this[n]=(1-t)*this.tweenStart[n]+t*e[n]},tween:function(t,n,i){var s={props:t,easing:new e.easing(n,i)};for(var r in t)void 0!==this.tweenGroup[r]&&this.cancelTween(r),this.tweenStart[r]=this[r],this.tweenGroup[r]=t;return this.tweens.push(s),this},cancelTween:function(e){if("string"==typeof e)"object"==typeof this.tweenGroup[e]&&delete this.tweenGroup[e][e];else if("object"==typeof e)for(var t in e)this.cancelTween(t);return this},pauseTweens:function(){this.tweens.map(function(e){e.easing.pause()})},resumeTweens:function(){this.tweens.map(function(e){e.easing.resume()})},_endTween:function(e){for(var t in e)delete this.tweenGroup[t];this.trigger("TweenEnd",e)}};
},{"../core/core.js":22}],31:[function(require,module,exports) {
function t(t,e){var n={};for(var i in e)n[i]=e[i];for(i in t)i in e||(n[i]=t[i]);return n}var e=require("../core/core.js");e._systems={},e.s=function(t,n,i,s){if(!n)return e._systems[t];"boolean"==typeof i&&(s=i,i=null),!1===s?(e._systems[t]=new e.CraftySystem(t,n,i),e.trigger("SystemLoaded",t)):e._registerLazySystem(t,n,i)},e._registerLazySystem=function(t,n,i){Object.defineProperty(e._systems,t,{get:function(){return Object.defineProperty(e._systems,t,{value:new e.CraftySystem(t,n,i),writable:!0,enumerable:!0,configurable:!0}),e.trigger("SystemLoaded",t),e._systems[t]},configurable:!0})},e.CraftySystem=function(){var n=1;return function(i,s,r){if(this.name=i,!s)return this;if(this._systemTemplate=s,this.extend(s),this.options=t(this.options,r),e._addCallbackMethods(this),this[0]="system"+n++,"function"==typeof this.init&&this.init(i),"events"in s){var o=s.events;for(var u in o){var a="function"==typeof o[u]?o[u]:s[o[u]];this.bind(u,a)}}}}(),e.CraftySystem.prototype={extend:function(t){for(var e in t)void 0===this[e]&&(this[e]=t[e])},bind:function(t,e){return this._bindCallback(t,e),this},trigger:function(t,e){return this._runCallbacks(t,e),this},unbind:function(t,e){return this._unbindCallbacks(t,e),this},one:function(t,e){var n=this,i=function(s){e.call(n,s),n.unbind(t,i)};return n.bind(t,i)},uniqueBind:function(t,e){return this.unbind(t,e),this.bind(t,e)},destroy:function(){e.trigger("SystemDestroyed",this),"function"==typeof this.remove&&this.remove(),this._unbindAll(),delete e._systems[this.name]}};
},{"../core/core.js":22}],36:[function(require,module,exports) {
function i(i,t,r){this.keys=i,this.map=r,this.obj=t}var t,r=function(i){t=i||64,this.map={},this.boundsDirty=!1,this.boundsHash={max:{x:-1/0,y:-1/0},min:{x:1/0,y:1/0}},this.boundsCoords={max:{x:-1/0,y:-1/0},min:{x:1/0,y:1/0}}},s=" ",n={};r.prototype={insert:function(t){var s,n,o=r.key(t),a=new i(o,t,this),h=0;for(h=o.x1;h<=o.x2;h++)for(s=o.y1;s<=o.y2;s++)n=h<<16^s,this.map[n]||(this.map[n]=[]),this.map[n].push(t);return this.boundsDirty=!0,a},search:function(i,t){var s,o,a,h,e,y=r.key(i,n),x=[];for(void 0===t&&(t=!0),s=y.x1;s<=y.x2;s++)for(o=y.y1;o<=y.y2;o++)if(e=this.map[s<<16^o])for(a=0;a<e.length;a++)x.push(e[a]);if(t){var m,f,u=[],p={};for(s=0,h=x.length;s<h;s++)(m=x[s])&&(f=m[0],m=m._cbr||m._mbr||m,!p[f]&&m._x<i._x+i._w&&m._x+m._w>i._x&&m._y<i._y+i._h&&m._y+m._h>i._y&&(p[f]=x[s]));for(m in p)u.push(p[m]);return u}return x},remove:function(i){var t,r,s=i.keys,n=i.obj,o=0;for(o=s.x1;o<=s.x2;o++)for(t=s.y1;t<=s.y2;t++)if(r=o<<16^t,this.map[r]){var a,h=this.map[r],e=h.length;for(a=0;a<e;a++)h[a]&&h[a][0]===n[0]&&h.splice(a,1)}this.boundsDirty=!0},refresh:function(i){var t,s,n,o,a,h=i.keys,e=i.obj;for(s=h.x1;s<=h.x2;s++)for(n=h.y1;n<=h.y2;n++)if(t=this.map[s<<16^n])for(a=t.length,o=0;o<a;o++)t[o]&&t[o][0]===e[0]&&t.splice(o,1);for(r.key(e,h),s=h.x1;s<=h.x2;s++)for(n=h.y1;n<=h.y2;n++)(t=this.map[s<<16^n])||(t=this.map[s<<16^n]=[]),t.push(e);return this.boundsDirty=!0,i},boundaries:function(){return this._updateBoundaries(),this.boundsCoords},_keyBoundaries:function(){return this._updateBoundaries(),this.boundsHash},_updateBoundaries:function(){if(this.boundsDirty){var i=this.boundsHash;i.max.x=-1/0,i.max.y=-1/0,i.min.x=1/0,i.min.y=1/0;var t=this.boundsCoords;t.max.x=-1/0,t.max.y=-1/0,t.min.x=1/0,t.min.y=1/0;var r,s;for(var n in this.map)if(this.map[n].length){var o=n>>16,a=n<<16>>16;if(a<0&&(o^=-1),o>=i.max.x){i.max.x=o;for(r in this.map[n])"object"==typeof(s=this.map[n][r])&&"requires"in s&&(t.max.x=Math.max(t.max.x,s.x+s.w))}if(o<=i.min.x){i.min.x=o;for(r in this.map[n])"object"==typeof(s=this.map[n][r])&&"requires"in s&&(t.min.x=Math.min(t.min.x,s.x))}if(a>=i.max.y){i.max.y=a;for(r in this.map[n])"object"==typeof(s=this.map[n][r])&&"requires"in s&&(t.max.y=Math.max(t.max.y,s.y+s.h))}if(a<=i.min.y){i.min.y=a;for(r in this.map[n])"object"==typeof(s=this.map[n][r])&&"requires"in s&&(t.min.y=Math.min(t.min.y,s.y))}}this.boundsDirty=!1}},traverseRay:function(i,s,o){var a=s.x,h=s.y;i={_x:i._x,_y:i._y,_w:0,_h:0};var e,y=this._keyBoundaries(),x=r.key(i,n),m=x.x1,f=x.y1,u=y.min.x,p=y.min.y,_=y.max.x,d=y.max.y,b=a>0?1:a<0?-1:0,c=h>0?1:h<0?-1:0,v=h>=0?(f+1)*t:f*t,l=-1/0,k=0,M=0,j=1/0,g=1/0;for(0!==a&&(e=1/a,j=((a>=0?(m+1)*t:m*t)-i._x)*e,k=t*b*e),0!==h&&(e=1/h,g=(v-i._y)*e,M=t*c*e);1===b&&m<u&&u!==1/0||-1===b&&m>_&&_!==-1/0||1===c&&f<p&&p!==1/0||-1===c&&f>d&&d!==-1/0;)j<g?(l=j,m+=b,j+=k):(l=g,f+=c,g+=M);for(var w;u<=m&&m<=_&&p<=f&&f<=d;){if(w=this.map[m<<16^f])for(var D=0;D<w.length;D++)if(o(w[D],l))return;j<g?(l=j,m+=b,j+=k):(l=g,f+=c,g+=M)}}},r.key=function(i,r){return i=i._cbr||i._mbr||i,r=r||{},r.x1=Math.floor(i._x/t),r.y1=Math.floor(i._y/t),r.x2=Math.floor((i._w+i._x)/t),r.y2=Math.floor((i._h+i._y)/t),r},r.hash=function(i){return i.x1+s+i.y1+s+i.x2+s+i.y2},i.prototype={update:function(i){r.hash(r.key(i,n))!==r.hash(this.keys)&&this.map.refresh(this)}},module.exports=r;
},{}],32:[function(require,module,exports) {
var t=require("../core/core.js"),i=require("./spatial-grid.js");t.map=new i;var h=Math,s=h.PI,n=s/180;t.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_globalZ:null,_rotation:0,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_2D_property_definitions:{x:{set:function(t){this._setter2d("_x",t)},get:function(){return this._x},configurable:!0,enumerable:!0},_x:{enumerable:!1},y:{set:function(t){this._setter2d("_y",t)},get:function(){return this._y},configurable:!0,enumerable:!0},_y:{enumerable:!1},w:{set:function(t){this._setter2d("_w",t)},get:function(){return this._w},configurable:!0,enumerable:!0},_w:{enumerable:!1},h:{set:function(t){this._setter2d("_h",t)},get:function(){return this._h},configurable:!0,enumerable:!0},_h:{enumerable:!1},z:{set:function(t){this._setter2d("_z",t)},get:function(){return this._z},configurable:!0,enumerable:!0},_z:{enumerable:!1},rotation:{set:function(t){this._setter2d("_rotation",t)},get:function(){return this._rotation},configurable:!0,enumerable:!0},_rotation:{enumerable:!1}},_define2DProperties:function(){for(var t in this._2D_property_definitions)Object.defineProperty(this,t,this._2D_property_definitions[t])},init:function(){this._globalZ=this[0],this._origin={x:0,y:0},this._bx1=0,this._bx2=0,this._by1=0,this._by2=0,this._children=[],this._define2DProperties(),this._entry=t.map.insert(this),this.bind("Move",function(t){var i=this._cbr||this._mbr||this;this._entry.update(i),this._children.length>0&&this._cascade(t)}),this.bind("Rotate",function(t){var i=this._cbr||this._mbr||this;this._entry.update(i),this._children.length>0&&this._cascade(t)}),this.bind("Remove",function(){if(this._children){for(var i=0;i<this._children.length;i++)delete this._children[i]._parent,this._children[i].destroy&&this._children[i].destroy();this._children=[]}this._parent&&this._parent.detach(this),t.map.remove(this._entry),this.detach()})},offsetBoundary:function(t,i,h,s){return 1===arguments.length&&(i=h=s=t),this._bx1=t,this._bx2=h,this._by1=i,this._by2=s,this.trigger("BoundaryOffset"),this._calculateMBR(),this},_calculateMBR:function(){var t=this._origin.x+this._x,i=this._origin.y+this._y,h=-this._rotation*n,s=this._x-this._bx1-t,r=this._x+this._w+this._bx2-t,e=this._y-this._by1-i,_=this._y+this._h+this._by2-i,o=Math.cos(h),a=Math.sin(h),c=s*(o=o<1e-10&&o>-1e-10?0:o)+e*(a=a<1e-10&&a>-1e-10?0:a),u=-s*a+e*o,l=r*o+e*a,f=-r*a+e*o,y=r*o+_*a,x=-r*a+_*o,g=s*o+_*a,b=-s*a+_*o,d=Math.floor(Math.min(c,l,y,g)+t),m=Math.floor(Math.min(u,f,x,b)+i),p=Math.ceil(Math.max(c,l,y,g)+t),w=Math.ceil(Math.max(u,f,x,b)+i);if(this._mbr?(this._mbr._x=d,this._mbr._y=m,this._mbr._w=p-d,this._mbr._h=w-m):this._mbr={_x:d,_y:m,_w:p-d,_h:w-m},this._cbr){var v=this._cbr,M=v.cx,R=v.cy,P=v.r,z=t+(M+this._x-t)*o+(R+this._y-i)*a,A=i-(M+this._x-t)*a+(R+this._y-i)*o;v._x=Math.min(z-P,d),v._y=Math.min(A-P,m),v._w=Math.max(z+P,p)-v._x,v._h=Math.max(A+P,w)-v._y}},_rotate:function(t){var i=this._rotation-t;if(0!==i){this._rotation=t;var h={x:this._origin.x+this._x,y:this._origin.y+this._y};this._calculateMBR();var s=i*n,r=Math.cos(s),e=Math.sin(s);this.trigger("Rotate",{cos:-1e-10<r&&r<1e-10?0:r,sin:-1e-10<e&&e<1e-10?0:e,deg:i,rad:s,o:h})}},area:function(){return this._w*this._h},intersect:function(t,i,h,s){var n,r=this._mbr||this;return n="object"==typeof t?t:{_x:t,_y:i,_w:h,_h:s},r._x<n._x+n._w&&r._x+r._w>n._x&&r._y<n._y+n._h&&r._y+r._h>n._y},within:function(t,i,h,s){var n,r=this._mbr||this;return(n="object"==typeof t?t:{_x:t,_y:i,_w:h,_h:s})._x<=r._x&&n._x+n._w>=r._x+r._w&&n._y<=r._y&&n._y+n._h>=r._y+r._h},contains:function(t,i,h,s){var n,r=this._mbr||this;return(n="object"==typeof t?t:{_x:t,_y:i,_w:h,_h:s})._x>=r._x&&n._x+n._w<=r._x+r._w&&n._y>=r._y&&n._y+n._h<=r._y+r._h},pos:function(t){return t=t||{},t._x=this._x,t._y=this._y,t._w=this._w,t._h=this._h,t},mbr:function(t){return t=t||{},this._mbr?(t._x=this._mbr._x,t._y=this._mbr._y,t._w=this._mbr._w,t._h=this._mbr._h,t):this.pos(t)},isAt:function(t,i){if(this.mapArea)return this.mapArea.containsPoint(t,i);if(this.map)return this.map.containsPoint(t,i);var h=this._mbr||this;return h._x<=t&&h._x+h._w>=t&&h._y<=i&&h._y+h._h>=i},move:function(t,i){return"n"===t.charAt(0)&&(this.y-=i),"s"===t.charAt(0)&&(this.y+=i),"e"!==t&&"e"!==t.charAt(1)||(this.x+=i),"w"!==t&&"w"!==t.charAt(1)||(this.x-=i),this},shift:function(t,i,h,s){return t&&(this.x+=t),i&&(this.y+=i),h&&(this.w+=h),s&&(this.h+=s),this},_cascade:function(t){if(t){var i,h=0,s=this._children,n=s.length;if("cos"in t||"sin"in t)for(;h<n;++h)"rotate"in(i=s[h])&&i.rotate(t);else for(var r=this._x-t._x,e=this._y-t._y,_=this._w-t._w,o=this._h-t._h;h<n;++h)(i=s[h]).shift(r,e,_,o)}},attach:function(){for(var t,i=0,h=arguments,s=arguments.length;i<s;++i)(t=h[i])._parent&&t._parent.detach(t),t._parent=this,this._children.push(t);return this},detach:function(t){var i;if(!t){for(i=0;i<this._children.length;i++)this._children[i]._parent=null;return this._children=[],this}for(i=0;i<this._children.length;i++)this._children[i]===t&&this._children.splice(i,1);return t._parent=null,this},origin:function(t,i){if("string"==typeof t)if("centre"===t||"center"===t||-1===t.indexOf(" "))t=this._w/2,i=this._h/2;else{var h=t.split(" ");"top"===h[0]?i=0:"bottom"===h[0]?i=this._h:"middle"!==h[0]&&"center"!==h[1]&&"centre"!==h[1]||(i=this._h/2),"center"===h[1]||"centre"===h[1]||"middle"===h[1]?t=this._w/2:"left"===h[1]?t=0:"right"===h[1]&&(t=this._w)}return this._origin.x=t,this._origin.y=i,this},rotate:function(t){var i,h;i=(this._x+this._origin.x-t.o.x)*t.cos+(this._y+this._origin.y-t.o.y)*t.sin+(t.o.x-this._origin.x),h=(this._y+this._origin.y-t.o.y)*t.cos-(this._x+this._origin.x-t.o.x)*t.sin+(t.o.y-this._origin.y),this._setter2d("_rotation",this._rotation-t.deg),this._setter2d("_x",i),this._setter2d("_y",h)},_setter2d:function(i,h){if(this[i]!==h){var s,n=t.rectManager._pool.copy(this);if("_rotation"===i)this._rotate(h);else if("_x"===i||"_y"===i)(s=this._mbr)&&(s[i]-=this[i]-h,this._cbr&&(this._cbr[i]-=this[i]-h)),this[i]=h,this.trigger("Move",n);else if("_h"===i||"_w"===i){s=this._mbr;var r=this[i];this[i]=h,s&&this._calculateMBR(),"_w"===i?this.trigger("Resize",{axis:"w",amount:h-r}):"_h"===i&&this.trigger("Resize",{axis:"h",amount:h-r}),this.trigger("Move",n)}else if("_z"===i){var e=h<<0;h=h===e?e:e+1,this._globalZ=1e5*h+this[0],this[i]=h,this.trigger("Reorder")}this[i]=h,this.trigger("Invalidate"),t.rectManager._pool.recycle(n)}}}),t.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0)),this.points=t},t.polygon.prototype={containsPoint:function(t,i){var h,s,n=this.points,r=n.length/2,e=!1;for(h=0,s=r-1;h<r;s=h++)n[2*h+1]>i!=n[2*s+1]>i&&t<(n[2*s]-n[2*h])*(i-n[2*h+1])/(n[2*s+1]-n[2*h+1])+n[2*h]&&(e=!e);return e},shift:function(t,i){for(var h=0,s=this.points,n=s.length;h<n;h+=2)s[h]+=t,s[h+1]+=i},clone:function(){return new t.polygon(this.points.slice(0))},rotate:function(t){for(var i,h,s=0,n=this.points,r=n.length;s<r;s+=2)i=t.o.x+(n[s]-t.o.x)*t.cos+(n[s+1]-t.o.y)*t.sin,h=t.o.y-(n[s]-t.o.x)*t.sin+(n[s+1]-t.o.y)*t.cos,n[s]=i,n[s+1]=h},intersectRay:function(t,i){for(var h,s,n,r,e,_,o,a,c,u=this.points,l=1/0,f=t._x,y=i.x,x=t._y,g=i.y,b=0,d=u.length,m=u[d-2],p=u[d-1];b<d;b+=2)_=u[b],s=(m-f)*(c=(a=u[b+1])-p)-(p-x)*(o=_-m),r=(m-f)*g-(p-x)*y,0!==(e=y*c-g*o)?(h=s/e,(n=r/e)>=0&&n<=1&&h>=0&&h<l&&(l=h)):0!==s&&0!==r||((h=(m-f)*y+(p-x)*g)>=0&&h<l&&(l=h),(h=(_-f)*y+(a-x)*g)>=0&&h<l&&(l=h)),m=_,p=a;return l}},t.circle=function(t,i,h){this.x=t,this.y=i,this.radius=h,this.points=[];for(var s,n=0;n<16;n+=2)s=n*Math.PI/8,this.points[n]=this.x+Math.sin(s)*h,this.points[n+1]=this.y+Math.cos(s)*h},t.circle.prototype={containsPoint:function(t,i){var h=this.radius,s=this.x-t,n=this.y-i;return s*s+n*n<h*h},shift:function(t,i){this.x+=t,this.y+=i;for(var h=0,s=this.points,n=s.length;h<n;h+=2)s[h]+=t,s[h+1]+=i},rotate:function(){}},t.matrix=function(t){this.mtx=t,this.width=t[0].length,this.height=t.length},t.matrix.prototype={x:function(i){if(this.width===i.height){for(var h=[],s=0;s<this.height;s++){h[s]=[];for(var n=0;n<i.width;n++){for(var r=0,e=0;e<this.width;e++)r+=this.mtx[s][e]*i.mtx[e][n];h[s][n]=r}}return new t.matrix(h)}},e:function(t,i){return t<1||t>this.mtx.length||i<1||i>this.mtx[0].length?null:this.mtx[t-1][i-1]}};
},{"../core/core.js":22,"./spatial-grid.js":36}],33:[function(require,module,exports) {
var t=require("../core/core.js"),i=function(i,n,o,e){var r=n+o,s="_"+r,h={key:"",oldValue:0};e?t.defineField(i,r,function(){return this[s]},function(t){var i=this[s];t!==i&&(this[s]=t,h.key=r,h.oldValue=i,this.trigger("MotionChange",h))}):t.defineField(i,r,function(){return this[s]},function(t){}),Object.defineProperty(i,s,{value:0,writable:!0,enumerable:!1,configurable:!1})},n=function(i,n,o,e){var r=n+"x",s=n+"y",h="_"+r,a="_"+s;return o?(t.defineField(e,"x",function(){return i[h]},function(t){i[r]=t}),t.defineField(e,"y",function(){return i[a]},function(t){i[s]=t})):(t.defineField(e,"x",function(){return i[h]},function(t){}),t.defineField(e,"y",function(){return i[a]},function(t){})),Object.seal&&Object.seal(e),e};t.c("AngularMotion",{_vrotation:0,_arotation:0,_drotation:0,init:function(){this.requires("2D"),i(this,"v","rotation",!0),i(this,"a","rotation",!0),i(this,"d","rotation",!1),this.__oldRotationDirection=0,this.bind("EnterFrame",this._angularMotionTick)},remove:function(t){this.unbind("EnterFrame",this._angularMotionTick)},resetAngularMotion:function(){return this._drotation=0,this.vrotation=0,this.arotation=0,this},_angularMotionTick:function(t){var i=t.dt/1e3,n=this._rotation,o=this._vrotation,e=this._arotation,r=n+o*i+.5*e*i*i;this.vrotation=o+e*i;var s=this._vrotation,h=s?s<0?-1:1:0;this.__oldRotationDirection!==h&&(this.__oldRotationDirection=h,this.trigger("NewRotationDirection",h)),this._drotation=r-n,0!==this._drotation&&(this.rotation=r,this.trigger("Rotated",n))}}),t.c("Motion",{_vx:0,_vy:0,_ax:0,_ay:0,_dx:0,_dy:0,init:function(){this.requires("2D"),i(this,"v","x",!0),i(this,"v","y",!0),this._velocity=n(this,"v",!0,new t.math.Vector2D),i(this,"a","x",!0),i(this,"a","y",!0),this._acceleration=n(this,"a",!0,new t.math.Vector2D),i(this,"d","x",!1),i(this,"d","y",!1),this._motionDelta=n(this,"d",!1,new t.math.Vector2D),this.__movedEvent={axis:"",oldValue:0},this.__oldDirection={x:0,y:0},this.bind("EnterFrame",this._linearMotionTick)},remove:function(t){this.unbind("EnterFrame",this._linearMotionTick)},resetMotion:function(){return this.vx=0,this.vy=0,this.ax=0,this.ay=0,this._dx=0,this._dy=0,this},motionDelta:function(){return this._motionDelta},velocity:function(){return this._velocity},acceleration:function(){return this._acceleration},ccdbr:function(t){var i=this._cbr||this._mbr||this,n=this._dx,o=this._dy,e=0,r=0,s=n>0?e=n:-n,h=o>0?r=o:-o;return t=t||{},t._x=i._x-e,t._y=i._y-r,t._w=i._w+s,t._h=i._h+h,t},_linearMotionTick:function(t){var i=t.dt/1e3,n=this._x,o=this._vx,e=this._ax,r=this._y,s=this._vy,h=this._ay,a=n+o*i+.5*e*i*i,_=r+s*i+.5*h*i*i;this.vx=o+e*i,this.vy=s+h*i;var c=this.__oldDirection,u=this._vx,d=u?u<0?-1:1:0,l=this._vy,v=l?l<0?-1:1:0;c.x===d&&c.y===v||(c.x=d,c.y=v,this.trigger("NewDirection",c));var f=this.__movedEvent;this._dx=a-n,this._dy=_-r,0!==this._dx&&(this.x=a,f.axis="x",f.oldValue=n,this.trigger("Moved",f)),0!==this._dy&&(this.y=_,f.axis="y",f.oldValue=r,this.trigger("Moved",f))}});
},{"../core/core.js":22}],34:[function(require,module,exports) {
var t=require("../core/core.js");t.c("Supportable",{_ground:null,_groundComp:null,_preventGroundTunneling:!1,canLand:!0,init:function(){this.requires("2D"),this.__area={_x:0,_y:0,_w:0,_h:0},this.defineField("ground",function(){return this._ground},function(t){})},remove:function(t){this.unbind("EnterFrame",this._detectGroundTick)},startGroundDetection:function(t){return t&&(this._groundComp=t),this.uniqueBind("EnterFrame",this._detectGroundTick),this},stopGroundDetection:function(){return this.unbind("EnterFrame",this._detectGroundTick),this},preventGroundTunneling:function(t){return void 0===t&&(t=!0),t&&this.requires("Motion"),this._preventGroundTunneling=t,this},_detectGroundTick:function(){var i,n=this._groundComp,r=this._ground,s=t.rectManager.overlap;if(this._preventGroundTunneling)i=this.ccdbr(this.__area);else{var h=this._cbr||this._mbr||this;(i=this.__area)._x=h._x,i._y=h._y,i._w=h._w,i._h=h._h}if(i._h++,r){var e=r._cbr||r._mbr||r;r.__c[n]&&t(r[0])===r&&s(e,i)||(this._ground=null,this.trigger("LiftedOffGround",r),r=null)}if(!r)for(var u,o,a=t.map.search(i,!1),d=0,_=a.length;d<_;++d)if(u=a[d],o=u._cbr||u._mbr||u,u!==this&&u.__c[n]&&s(o,i)&&(this.canLand=!0,this.trigger("CheckLanding",u),this.canLand)){this._ground=r=u,this.y=r._y-this._h,this._x>r._x+r._w?this.x=r._x+r._w-1:this._x+this._w<r._x&&(this.x=r._x-this._w+1),this.trigger("LandedOnGround",r);break}}}),t.c("GroundAttacher",{_groundAttach:function(t){t.attach(this)},_groundDetach:function(t){t.detach(this)},init:function(){this.requires("Supportable"),this.bind("LandedOnGround",this._groundAttach),this.bind("LiftedOffGround",this._groundDetach)},remove:function(t){this.unbind("LandedOnGround",this._groundAttach),this.unbind("LiftedOffGround",this._groundDetach)}}),t.c("Gravity",{_gravityConst:500,_gravityActive:!1,init:function(){this.requires("2D, Supportable, Motion"),this.bind("LiftedOffGround",this._startGravity),this.bind("LandedOnGround",this._stopGravity)},remove:function(t){this.unbind("LiftedOffGround",this._startGravity),this.unbind("LandedOnGround",this._stopGravity)},_gravityCheckLanding:function(t){this._dy<0&&(this.canLand=!1)},gravity:function(t){return this.uniqueBind("CheckLanding",this._gravityCheckLanding),this.startGroundDetection(t),this._startGravity(),this},antigravity:function(){return this._stopGravity(),this.stopGroundDetection(),this.unbind("CheckLanding",this._gravityCheckLanding),this},gravityConst:function(t){return this._gravityActive&&(this.ay-=this._gravityConst,this.ay+=t),this._gravityConst=t,this},_startGravity:function(){this._gravityActive||(this._gravityActive=!0,this.ay+=this._gravityConst)},_stopGravity:function(){this._gravityActive&&(this._gravityActive=!1,this.ay=0,this.vy=0)}});
},{"../core/core.js":22}],35:[function(require,module,exports) {
var i=require("../core/core.js"),t=Math.PI/180,n=1e-6;i.extend({raycast:function(t,s){for(var r,e,h="obj",o=1/0,a=!0,c=2,l=arguments.length;c<l;++c)"number"===(e=typeof(r=arguments[c]))?o=r+n:"string"===e?h=r:"boolean"===e&&(a=r);var u=t._x,_=t._y,f=s.x,p=s.y,b={},d=[];if(o<0){var g=null,m=1/0;i.map.traverseRay(t,s,function(i,n){if(g&&m<n)return d.push({obj:g,distance:m,x:u+m*f,y:_+m*p}),g=null,m=1/0,!0;if(i.map&&i.__c[h]&&!b[i[0]]){b[i[0]]=!0;var r=i.map.intersectRay(t,s);r<m&&(g=i,m=r)}}),g&&d.push({obj:g,distance:m,x:u+m*f,y:_+m*p})}else i.map.traverseRay(t,s,function(i,n){if(n>o)return!0;if(i.map&&i.__c[h]&&!b[i[0]]){b[i[0]]=!0;var r=i.map.intersectRay(t,s);r<o&&d.push({obj:i,distance:r,x:u+r*f,y:_+r*p})}});return a&&d.sort(function(i,t){return i.distance-t.distance}),d}}),i.c("Collision",{init:function(){this.requires("2D"),this._collisionData={},this.collision()},remove:function(){this._cbr=null,this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds)},collision:function(n){if(this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds),n){if(arguments.length>1){var s=Array.prototype.slice.call(arguments,0);n=new i.polygon(s)}else n=n.constructor===Array?new i.polygon(n.slice()):n.clone();this._findBounds(n.points)}else n=new i.polygon([0,0,this._w,0,this._w,this._h,0,this._h]),this.bind("Resize",this._resizeMap),this._cbr=null;return this.rotation&&n.rotate({cos:Math.cos(-this.rotation*t),sin:Math.sin(-this.rotation*t),o:{x:this._origin.x,y:this._origin.y}}),this.map=n,this.attach(this.map),this.map.shift(this._x,this._y),this.trigger("NewHitbox",n),this},cbr:function(i){return i=i||{},this._cbr?(i._x=this._cbr._x,i._y=this._cbr._y,i._w=this._cbr._w,i._h=this._cbr._h,i):this.mbr(i)},_findBounds:function(i){for(var t=1/0,n=-1/0,s=1/0,r=-1/0,e=i.length,h=0;h<e;h+=2)i[h]<t&&(t=i[h]),i[h]>n&&(n=i[h]),i[h+1]<s&&(s=i[h+1]),i[h+1]>r&&(r=i[h+1]);var o={cx:(t+n)/2,cy:(s+r)/2,r:Math.sqrt((n-t)*(n-t)+(r-s)*(r-s))/2};return t>=0&&s>=0&&(this._checkBounds=function(){null===this._cbr&&this._w<n||this._h<r?(this._cbr=o,this._calculateMBR()):this._cbr&&(this._cbr=null,this._calculateMBR())},this.bind("Resize",this._checkBounds)),t>=0&&s>=0&&n<=this._w&&r<=this._h?(this._cbr=null,!1):(this._cbr=o,this._calculateMBR(),!0)},_resizeMap:function(i){var n,s,r=this.rotation*t,e=this.map.points;"w"===i.axis?(r?(n=i.amount*Math.cos(r),s=i.amount*Math.sin(r)):(n=i.amount,s=0),e[2]+=n,e[3]+=s):(r?(s=i.amount*Math.cos(r),n=-i.amount*Math.sin(r)):(n=0,s=i.amount),e[6]+=n,e[7]+=s),e[4]+=n,e[5]+=s},hit:function(t){var n,s,r,e,h=this._cbr||this._mbr||this,o=i.map.search(h,!1),a=0,c=o.length,l={},u=i.rectManager.overlap,_="map"in this&&"containsPoint"in this.map,f=[];if(!c)return null;for(;a<c;++a)r=(s=o[a])._cbr||s._mbr||s,s&&!l[n=s[0]]&&this[0]!==n&&s.__c[t]&&u(r,h)&&(l[n]=s);for(e in l)if(s=l[e],_&&"map"in s){var p=this._SAT(this.map,s.map);p.obj=s,p.type="SAT",p&&f.push(p)}else f.push({obj:s,type:"MBR"});return f.length?f:null},onHit:function(i,t,n){var s=!1;return this.bind("EnterFrame",function(){var r=this.hit(i);r?(t.call(this,r,!s),s=!0):s&&("function"==typeof n&&n.call(this),s=!1)}),this},_createCollisionHandler:function(i,t){return function(){var n=this.hit(i);if(!0===t.occurring){if(null!==n)return;t.occurring=!1,this.trigger("HitOff",i)}else null!==n&&(t.occurring=!0,this.trigger("HitOn",n))}},checkHits:function(){var i=arguments,t=0;for(1===i.length&&(i=i[0].split(/\s*,\s*/));t<i.length;++t){var n=i[t],s=this._collisionData[n];void 0===s&&(this._collisionData[n]=s={occurring:!1,handler:null},s.handler=this._createCollisionHandler(n,s),this.bind("EnterFrame",s.handler))}return this},ignoreHits:function(){var i,t=arguments,n=0;if(0===t.length){for(i in this._collisionData)this.unbind("EnterFrame",i.handler);this._collisionData={}}for(1===t.length&&(t=t[0].split(/\s*,\s*/));n<t.length;++n){var s=t[n];void 0!==(i=this._collisionData[s])&&(this.unbind("EnterFrame",i.handler),delete this._collisionData[s])}return this},resetHitChecks:function(){var i,t=arguments,n=0;if(0===t.length)for(i in this._collisionData)this._collisionData[i].occurring=!1;for(1===t.length&&(t=t[0].split(/\s*,\s*/));n<t.length;++n){var s=t[n];void 0!==(i=this._collisionData[s])&&(i.occurring=!1)}return this},_SAT:function(i,t){for(var n,s,r,e,h,o,a,c,l,u=0,_=i.points,f=t.points,p=_.length/2,b=f.length/2,d=0,g=0,m=-1/0,v=null,y=null;u<p;u++){for(l=u===p-1?0:u+1,d=-(_[2*u+1]-_[2*l+1]),g=_[2*u]-_[2*l],d/=s=Math.sqrt(d*d+g*g),g/=s,r=e=1/0,h=o=-1/0,n=0;n<p;++n)(c=_[2*n]*d+_[2*n+1]*g)>h&&(h=c),c<r&&(r=c);for(n=0;n<b;++n)(c=f[2*n]*d+f[2*n+1]*g)>o&&(o=c),c<e&&(e=c);if(r<e?(a=e-h,d=-d,g=-g):a=r-o,a>=0)return!1;a>m&&(m=a,v=d,y=g)}for(u=0;u<b;u++){for(l=u===b-1?0:u+1,d=-(f[2*u+1]-f[2*l+1]),g=f[2*u]-f[2*l],d/=s=Math.sqrt(d*d+g*g),g/=s,r=e=1/0,h=o=-1/0,n=0;n<p;++n)(c=_[2*n]*d+_[2*n+1]*g)>h&&(h=c),c<r&&(r=c);for(n=0;n<b;++n)(c=f[2*n]*d+f[2*n+1]*g)>o&&(o=c),c<e&&(e=c);if(r<e?(a=e-h,d=-d,g=-g):a=r-o,a>=0)return!1;a>m&&(m=a,v=d,y=g)}return{overlap:m,normal:{x:v,y:y}}}});
},{"../core/core.js":22}],37:[function(require,module,exports) {
var _=require("../core/core.js");_.extend({rectManager:{merge:function(_,n,e){return void 0===e&&(e={}),e._h=Math.max(_._y+_._h,n._y+n._h),e._w=Math.max(_._x+_._w,n._x+n._w),e._x=Math.min(_._x,n._x),e._y=Math.min(_._y,n._y),e._w-=e._x,e._h-=e._y,e},overlap:function(_,n){return _._x<n._x+n._w&&_._x+_._w>n._x&&_._y<n._y+n._h&&_._y+_._h>n._y},integerBounds:function(_){return _._w=_._x+_._w,_._h=_._y+_._h,_._x=_._x>0?0|_._x:(0|_._x)-1,_._y=_._y>0?0|_._y:(0|_._y)-1,_._w-=_._x,_._h-=_._y,_._w=_._w===(0|_._w)?_._w:1+(0|_._w),_._h=_._h===(0|_._h)?_._h:1+(0|_._h),_},mergeSet:function(_){for(var n=0;n<_.length-1;)this.overlap(_[n],_[n+1])?(this.merge(_[n],_[n+1],_[n]),_.splice(n+1,1),n>0&&n--):n++;return _},boundingRect:function(_){if(_&&_.length){var n,e,r=1,t=_.length,h=_[0];for(h=[h._x,h._y,h._x+h._w,h._y+h._h];r<t;)(e=[(n=_[r])._x,n._y,n._x+n._w,n._y+n._h])[0]<h[0]&&(h[0]=e[0]),e[1]<h[1]&&(h[1]=e[1]),e[2]>h[2]&&(h[2]=e[2]),e[3]>h[3]&&(h[3]=e[3]),r++;return e=h,h={_x:e[0],_y:e[1],_w:e[2]-e[0],_h:e[3]-e[1]}}},_pool:function(){var _=[],n=0;return{get:function(e,r,t,h){_.length<=n&&_.push({});var x=_[n++];return x._x=e,x._y=r,x._w=t,x._h=h,x},copy:function(e){_.length<=n&&_.push({});var r=_[n++];return r._x=e._x,r._y=e._y,r._w=e._w,r._h=e._h,r},recycle:function(_){n--}}}()}});
},{"../core/core.js":22}],38:[function(require,module,exports) {
var t=require("../core/core.js");t.math={abs:function(t){return t<0?-t:t},amountOf:function(t,i,s){return i<s?(t-i)/(s-i):(t-s)/(i-s)},clamp:function(t,i,s){return t>s?s:t<i?i:t},degToRad:function(t){return t*Math.PI/180},distance:function(i,s,h,n){var e=t.math.squaredDistance(i,s,h,n);return Math.sqrt(parseFloat(e))},lerp:function(t,i,s){return t+(i-t)*s},negate:function(t){return Math.random()<t?-1:1},radToDeg:function(t){return 180*t/Math.PI},randomElementOfArray:function(t){return t[Math.floor(t.length*Math.random())]},randomInt:function(t,i){return t+Math.floor((1+i-t)*Math.random())},randomNumber:function(t,i){return t+(i-t)*Math.random()},squaredDistance:function(t,i,s,h){return(t-s)*(t-s)+(i-h)*(i-h)},withinRange:function(t,i,s){return t>=i&&t<=s}},t.math.Vector2D=function(){function i(t,s){if(t instanceof i)this.x=t.x,this.y=t.y;else if(2===arguments.length)this.x=t,this.y=s;else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}return i.prototype.x=0,i.prototype.y=0,i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.angleBetween=function(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)},i.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},i.prototype.clone=function(){return new i(this)},i.prototype.distance=function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},i.prototype.distanceSq=function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)},i.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},i.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},i.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},i.prototype.equals=function(t){return t instanceof i&&this.x===t.x&&this.y===t.y},i.prototype.perpendicular=function(t){return(t=t||new i).setValues(-this.y,this.x)},i.prototype.getNormal=function(t,s){return(s=s||new i).setValues(t.y-this.y,this.x-t.x).normalize()},i.prototype.isZero=function(){return 0===this.x&&0===this.y},i.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y},i.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},i.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return 0===t?(this.x=1,this.y=0):(this.x/=t,this.y/=t),this},i.prototype.scale=function(t,i){return void 0===i&&(i=t),this.x*=t,this.y*=i,this},i.prototype.scaleToMagnitude=function(t){var i=t/this.magnitude();return this.x*=i,this.y*=i,this},i.prototype.setValues=function(t,s){return t instanceof i?(this.x=t.x,this.y=t.y):(this.x=t,this.y=s),this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"},i.prototype.translate=function(t,i){return void 0===i&&(i=t),this.x+=t,this.y+=i,this},i.tripleProduct=function(i,s,h,n){n=n||new t.math.Vector2D;var e=i.dotProduct(h),r=s.dotProduct(h);return n.setValues(s.x*e-i.x*r,s.y*e-i.y*r)},i}(),t.math.Matrix2D=function(){function t(i,s,h,n,e,r){if(i instanceof t)this.a=i.a,this.b=i.b,this.c=i.c,this.d=i.d,this.e=i.e,this.f=i.f;else if(6===arguments.length)this.a=i,this.b=s,this.c=h,this.d=n,this.e=e,this.f=r;else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"}return t.prototype.a=1,t.prototype.b=0,t.prototype.c=0,t.prototype.d=1,t.prototype.e=0,t.prototype.f=0,t.prototype.apply=function(t){var i=t.x;return t.x=i*this.a+t.y*this.c+this.e,t.y=i*this.b+t.y*this.d+this.f,t},t.prototype.clone=function(){return new t(this)},t.prototype.combine=function(t){var i=this.a;return this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,i=this.c,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,i=this.e,this.e=i*t.a+this.f*t.c+t.e,this.f=i*t.b+this.f*t.d+t.f,this},t.prototype.equals=function(i){return i instanceof t&&this.a===i.a&&this.b===i.b&&this.c===i.c&&this.d===i.d&&this.e===i.e&&this.f===i.f},t.prototype.determinant=function(){return this.a*this.d-this.b*this.c},t.prototype.invert=function(){var t=this.determinant();if(0!==t){var i={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=i.d/t,this.b=-i.b/t,this.c=-i.c/t,this.d=i.a/t,this.e=(i.c*i.f-i.e*i.d)/t,this.f=(i.e*i.b-i.a*i.f)/t}return this},t.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},t.prototype.isInvertible=function(){return 0!==this.determinant()},t.prototype.preRotate=function(t){var i=Math.cos(t),s=Math.sin(t),h=this.a;return this.a=i*h-s*this.b,this.b=s*h+i*this.b,h=this.c,this.c=i*h-s*this.d,this.d=s*h+i*this.d,this},t.prototype.preScale=function(t,i){return void 0===i&&(i=t),this.a*=t,this.b*=i,this.c*=t,this.d*=i,this},t.prototype.preTranslate=function(t,i){return"number"==typeof t?(this.e+=t,this.f+=i):(this.e+=t.x,this.f+=t.y),this},t.prototype.rotate=function(t){var i=Math.cos(t),s=Math.sin(t),h=this.a;return this.a=i*h-s*this.b,this.b=s*h+i*this.b,h=this.c,this.c=i*h-s*this.d,this.d=s*h+i*this.d,h=this.e,this.e=i*h-s*this.f,this.f=s*h+i*this.f,this},t.prototype.scale=function(t,i){return void 0===i&&(i=t),this.a*=t,this.b*=i,this.c*=t,this.d*=i,this.e*=t,this.f*=i,this},t.prototype.setValues=function(i,s,h,n,e,r){return i instanceof t?(this.a=i.a,this.b=i.b,this.c=i.c,this.d=i.d,this.e=i.e,this.f=i.f):(this.a=i,this.b=s,this.c=h,this.d=n,this.e=e,this.f=r),this},t.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"},t.prototype.translate=function(t,i){return"number"==typeof t?(this.e+=this.a*t+this.c*i,this.f+=this.b*t+this.d*i):(this.e+=this.a*t.x+this.c*t.y,this.f+=this.b*t.x+this.d*t.y),this},t}();
},{"../core/core.js":22}],39:[function(require,module,exports) {
var e=require("../core/core.js");e.extend({_drawLayerTemplates:{},_drawLayers:[],_addDrawLayerInstance:function(r){e._drawLayers.push(r),this._drawLayers.sort(function(e,r){return e.options.z-r.options.z})},_removeDrawLayerInstance:function(e){var r=this._drawLayers.indexOf(e);r>=0&&this._drawLayers.splice(r,1),this._drawLayers.sort(function(e,r){return e.options.z-r.options.z})},_registerLayerTemplate:function(e,r){this._drawLayerTemplates[e]=r;var t=this._commonLayerProperties;for(var s in t)r[s]||(r[s]=t[s]);r._viewportRectHolder={}},_commonLayerProperties:{_viewportRect:function(){var r=this.options,t=this._viewportRectHolder,s=Math.pow(e.viewport._scale,r.scaleResponse),a=e.viewport;return t._scale=s,t._w=a._width/s,t._h=a._height/s,t._x=r.xResponse*-a._x-.5*(r.xResponse-1)*(1-1/s)*a._width,t._y=r.yResponse*-a._y-.5*(r.yResponse-1)*(1-1/s)*a._height,t},_pointerEntities:0},createLayer:function(r,t,s){var a=this._drawLayerTemplates[t];e.s(r,a,s),e.c(r,{init:function(){this.requires("Renderable"),this._customLayer=!0,this.requires(a.type),this._attachToLayer(e.s(r))},remove:function(){this._detachFromLayer()}})}});
},{"../core/core.js":22}],40:[function(require,module,exports) {
var t=require("../core/core.js");t.c("Canvas",{init:function(){this.requires("Renderable"),this.currentRect={},this._customLayer||this._attachToLayer(t.s("DefaultCanvasLayer"))},remove:function(){this._detachFromLayer()},drawVars:{type:"canvas",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,i,s,h,a){if(this.ready){4===arguments.length&&(a=h,h=s,s=i,i=t,t=this._drawContext);var r=this.drawVars.pos;r._x=this._x+(i||0),r._y=this._y+(s||0),r._w=h||this._w,r._h=a||this._h;var _=t||this._drawContext,o=this.__coord||[0,0,0,0],e=this.drawVars.co;e.x=o[0]+(i||0),e.y=o[1]+(s||0),e.w=h||o[2],e.h=a||o[3],(this._flipX||this._flipY||this._rotation)&&_.save(),0!==this._rotation&&(_.translate(this._origin.x+this._x,this._origin.y+this._y),r._x=-this._origin.x,r._y=-this._origin.y,_.rotate(this._rotation%360*(Math.PI/180))),(this._flipX||this._flipY)&&(_.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(r._x=-(r._x+r._w)),this._flipY&&(r._y=-(r._y+r._h)));var l;return this._alpha<1&&(l=_.globalAlpha,_.globalAlpha=this._alpha),this.drawVars.ctx=_,this.trigger("Draw",this.drawVars),(0!==this._rotation||this._flipX||this._flipY)&&_.restore(),l&&(_.globalAlpha=l),this}}});
},{"../core/core.js":22}],41:[function(require,module,exports) {
var t=require("../core/core.js");t._registerLayerTemplate("Canvas",{type:"Canvas",options:{xResponse:1,yResponse:1,scaleResponse:1,z:0},_dirtyRects:[],_changedObjs:[],layerCount:0,_dirtyViewport:!1,_sort:function(t,e){return t._globalZ-e._globalZ},dirty:function(t){this._changedObjs.push(t)},attach:function(t){t._drawContext=this.context,this.layerCount++},detach:function(t){this.dirty(t),t._drawContext=null,this.layerCount--},context:null,_canvas:null,init:function(){if(!t.support.canvas)return t.trigger("NoCanvas"),void t.stop();this._dirtyRects=[],this._changedObjs=[];var e;(e=document.createElement("canvas")).width=t.viewport.width,e.height=t.viewport.height,e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex=this.options.z,t.stage.elem.appendChild(e),this.context=e.getContext("2d"),this._canvas=e;var i=t.viewport._scale;1!==i&&this.context.scale(i,i),this._setPixelart(t._pixelartEnabled),this.uniqueBind("PixelartSet",this._setPixelart),this.uniqueBind("RenderScene",this._render),this.uniqueBind("ViewportResize",this._resize),this.bind("InvalidateViewport",function(){this._dirtyViewport=!0}),t._addDrawLayerInstance(this)},remove:function(){this._canvas.parentNode.removeChild(this._canvas),t._removeDrawLayerInstance(this)},_render:function(){var t=this._dirtyViewport,e=this._changedObjs.length,i=this.context;if(e||t){var r=this.options;if(t&&r){var n=this._viewportRect(),s=n._scale,a=-n._x*s,h=-n._y*s;i.setTransform(s,0,0,s,Math.round(a),Math.round(h))}e/this.layerCount>.6||t?this._drawAll():this._drawDirty(),this._clean()}},_drawDirty:function(e){e=e||this._viewportRect();var i,r,n,s,a,h,o=this._changedObjs,c=o.length,_=this._dirtyRects,l=t.rectManager,d=l.overlap,g=this.context,u=[],p=[];for(e=l.integerBounds(e),i=0;i<c;i++)this._createDirty(o[i]);for(l.mergeSet(_),c=_.length,i=0;i<c;++i)if(s=_[i],u.length=0,p.length=0,s&&(s=l.integerBounds(s),d(s,e))){for(n=t.map.search(s,!1),g.clearRect(s._x,s._y,s._w,s._h),g.save(),g.beginPath(),g.rect(s._x,s._y,s._w,s._h),g.clip(),r=0,a=n.length;r<a;++r)!u[(h=n[r])[0]]&&h._visible&&h._drawLayer===this&&(u[h[0]]=!0,p.push(h));for(p.sort(this._sort),r=0,a=p.length;r<a;++r){d((h=p[r])._mbr||h,s)&&h.draw(),h._changed=!1}g.closePath(),g.restore()}if(!0===this.debugDirty)for(g.strokeStyle="red",i=0,c=_.length;i<c;++i)s=_[i],g.strokeRect(s._x,s._y,s._w,s._h)},_drawAll:function(e){e=e||this._viewportRect(),e=t.rectManager.integerBounds(e);var i,r=t.map.search(e),n=0,s=r.length;for(this.context.clearRect(e._x,e._y,e._w,e._h),r.sort(this._sort);n<s;n++)(i=r[n])._visible&&i._drawContext===this.context&&(i.draw(this.context),i._changed=!1)},debug:function(){t.log(this._changedObjs)},_clean:function(){var t,e,i,r,n=this._changedObjs;for(i=0,r=n.length;i<r;i++)t=(e=n[i])._mbr||e,void 0===e.staleRect&&(e.staleRect={}),e.staleRect._x=t._x,e.staleRect._y=t._y,e.staleRect._w=t._w,e.staleRect._h=t._h,e._changed=!1;n.length=0,this._dirtyRects.length=0,this._dirtyViewport=!1},_createDirty:function(e){var i=e._mbr||e,r=this._dirtyRects,n=t.rectManager;if(e.staleRect){if(n.overlap(e.staleRect,i))return n.merge(e.staleRect,i,e.staleRect),void r.push(e.staleRect);r.push(e.staleRect)}e.currentRect._x=i._x,e.currentRect._y=i._y,e.currentRect._w=i._w,e.currentRect._h=i._h,r.push(e.currentRect)},_resize:function(){var e=this._canvas;e.width=t.viewport.width,e.height=t.viewport.height},_setPixelart:function(t){var e=this.context;e.imageSmoothingEnabled=!t,e.mozImageSmoothingEnabled=!t,e.webkitImageSmoothingEnabled=!t,e.oImageSmoothingEnabled=!t,e.msImageSmoothingEnabled=!t}});
},{"../core/core.js":22}],42:[function(require,module,exports) {
var t=require("../core/core.js");t.extend({WebGLShader:function(t,i,r,s){this.vertexCode=t,this.fragmentCode=i,this.attributeList=r,this.drawCallback=s},defaultShader:function(t,i){if(this._defaultShaders=this._defaultShaders||{},1===arguments.length)return this._defaultShaders[t];this._defaultShaders[t]=i}}),t.c("WebGL",{init:function(){this.requires("Renderable"),this._customLayer||this._attachToLayer(t.s("DefaultWebGLLayer"))},remove:function(){this._detachFromLayer()},drawVars:{type:"webgl",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,i,r,s,h){if(this.ready){4===arguments.length&&(h=s,s=r,r=i,i=t,t=this._drawLayer.context);var e=this.drawVars.pos;e._x=this._x+(i||0),e._y=this._y+(r||0),e._w=s||this._w,e._h=h||this._h;var a=this.__coord||[0,0,0,0],_=this.drawVars.co;_.x=a[0]+(i||0),_.y=a[1]+(r||0),_.w=s||a[2],_.h=h||a[3],this._flipX&&(_.x=_.x+_.w,_.w=-_.w),this._flipY&&(_.y=_.y+_.h,_.h=-_.h);var o=this._drawContext;this.drawVars.gl=o;var d=this.drawVars.program=this.program;return d.setCurrentEntity(this),d.writeVector("aPosition",this._x,this._y,this._x,this._y+this._h,this._x+this._w,this._y,this._x+this._w,this._y+this._h),d.writeVector("aOrientation",this._origin.x+this._x,this._origin.y+this._y,this._rotation*Math.PI/180),d.writeVector("aLayer",this._globalZ,this._alpha),this.trigger("Draw",this.drawVars),d.addIndices(d.ent_offset),this}},_establishShader:function(t,i){this.program=this._drawLayer.getProgramWrapper(t,i),this.program.registerEntity(this),this.ready=!0}});
},{"../core/core.js":22}],43:[function(require,module,exports) {
function t(t,e){this.shader=e,this.layer=t,this.context=t.context,this.draw=function(){},this.array_size=16,this.max_size=1024,this._indexArray=new Uint16Array(6*this.array_size),this._indexBuffer=t.context.createBuffer()}var e=require("../core/core.js"),i=window.document;t.prototype={initAttributes:function(t){this.attributes=t,this._attribute_table={};for(var e=0,i=0;i<t.length;i++){var r=t[i];this._attribute_table[r.name]=r,r.bytes=r.bytes||Float32Array.BYTES_PER_ELEMENT,r.type=r.type||this.context.FLOAT,r.offset=e,r.location=this.context.getAttribLocation(this.shader,r.name),this.context.enableVertexAttribArray(r.location),e+=r.width}this.stride=e,this._attributeArray=new Float32Array(4*this.array_size*this.stride),this._attributeBuffer=this.context.createBuffer(),this._registryHoles=[],this._registrySize=0},growArrays:function(t){if(!(this.array_size>=this.max_size)){var e=Math.min(t,this.max_size),i=new Float32Array(4*e*this.stride),r=new Uint16Array(6*e);i.set(this._attributeArray),r.set(this._indexArray),this._attributeArray=i,this._indexArray=r,this.array_size=e}},registerEntity:function(t){if(0===this._registryHoles.length){if(this._registrySize>=this.max_size)throw"Number of entities exceeds maximum limit.";this._registrySize>=this.array_size&&this.growArrays(2*this.array_size),t._glBufferIndex=this._registrySize,this._registrySize++}else t._glBufferIndex=this._registryHoles.pop()},unregisterEntity:function(t){"number"==typeof t._glBufferIndex&&this._registryHoles.push(t._glBufferIndex),t._glBufferIndex=null},resetRegistry:function(){this._maxElement=0,this._registryHoles.length=0},setCurrentEntity:function(t){this.ent_offset=4*t._glBufferIndex,this.ent=t},switchTo:function(){var t=this.context;t.useProgram(this.shader),t.bindBuffer(t.ARRAY_BUFFER,this._attributeBuffer);for(var e,i=this.attributes,r=0;r<i.length;r++)e=i[r],t.vertexAttribPointer(e.location,e.width,e.type,!1,this.stride*e.bytes,e.offset*e.bytes);var s=this.texture_obj;s&&null===s.unit&&this.layer.texture_manager.bindTexture(s),this.index_pointer=0},setTexture:function(t){void 0===this.texture_obj&&(t.setToProgram(this.shader,"uSampler","uTextureDimensions"),this.texture_obj=t)},addIndices:function(t){var e=this._indexArray,i=this.index_pointer;e[0+i]=0+t,e[1+i]=1+t,e[2+i]=2+t,e[3+i]=1+t,e[4+i]=2+t,e[5+i]=3+t,this.index_pointer+=6},renderBatch:function(){var t=this.context;t.bindBuffer(t.ARRAY_BUFFER,this._attributeBuffer),t.bufferData(t.ARRAY_BUFFER,this._attributeArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indexArray,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,this.index_pointer,t.UNSIGNED_SHORT,0)},setViewportUniforms:function(t,e){var i=this.context;i.useProgram(this.shader),i.uniform4f(this.shader.viewport,-t._x,-t._y,t._w,t._h)},writeVector:function(t,e,i){for(var r=this._attribute_table[t],s=this.stride,a=r.offset+this.ent_offset*s,n=r.width,o=arguments.length-1,h=this._attributeArray,_=0;_<4;_++)for(var u=0;u<n;u++)h[a+s*_+u]=arguments[(n*_+u)%o+1]}},e._registerLayerTemplate("WebGL",{type:"WebGL",options:{xResponse:1,yResponse:1,scaleResponse:1,z:0},context:null,changed_objects:[],_compileShader:function(t,e){var i=this.context,r=i.createShader(e);if(i.shaderSource(r,t),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS))throw i.getShaderInfoLog(r);return r},_makeProgram:function(t){var e=this.context,i=this._compileShader(t.fragmentCode,e.FRAGMENT_SHADER),r=this._compileShader(t.vertexCode,e.VERTEX_SHADER),s=e.createProgram();if(e.attachShader(s,r),e.attachShader(s,i),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw"Could not initialise shaders";return s.viewport=e.getUniformLocation(s,"uViewport"),s},getProgramWrapper:function(e,i){if(void 0===this.programs[e]){var r=new t(this,this._makeProgram(i));r.name=e,r.initAttributes(i.attributeList),r.draw=i.drawCallback,r.setViewportUniforms(this._viewportRect(),this.options),this.programs[e]=r}return this.programs[e]},makeTexture:function(t,e,i){return this.texture_manager.makeTexture(t,e,i)},init:function(){if(!e.support.webgl)return e.trigger("NoWebGL"),void e.stop();this.changed_objects=[],this.programs={};var t;(t=i.createElement("canvas")).width=e.viewport.width,t.height=e.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.zIndex=this.options.z,e.stage.elem.appendChild(t);var r;try{(r=t.getContext("webgl",{premultipliedalpha:!0})||t.getContext("experimental-webgl",{premultipliedalpha:!0})).viewportWidth=t.width,r.viewportHeight=t.height}catch(t){return e.trigger("NoWebGL"),void e.stop()}this.context=r,this._canvas=t,r.clearColor(0,0,0,0),r.disable(r.DEPTH_TEST),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.enable(r.BLEND),this.uniqueBind("RenderScene",this.render),this.uniqueBind("ViewportResize",this._resize),this.uniqueBind("InvalidateViewport",function(){this.dirtyViewport=!0}),this.uniqueBind("PixelartSet",this._setPixelart),this._setPixelart(e._pixelartEnabled),this.dirtyViewport=!0,this.texture_manager=new e.TextureManager(r,this),e._addDrawLayerInstance(this)},remove:function(){this._canvas.parentNode.removeChild(this._canvas),e._removeDrawLayerInstance(this)},_resize:function(){var t=this._canvas;t.width=e.viewport.width,t.height=e.viewport.height;var i=this.context;i.viewportWidth=t.width,i.viewportHeight=t.height},_setPixelart:function(t){var e=this.context;this.texture_filter=t?e.NEAREST:e.LINEAR},zsort:function(t,e){return t._globalZ-e._globalZ},visible_gl:[],render:function(t){t=t||this._viewportRect();var i=this.context;i.viewport(0,0,i.viewportWidth,i.viewportHeight),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);var r=this.programs;if(this.dirtyViewport){var s=this._viewportRect();for(var a in r)r[a].setViewportUniforms(s,this.options);this.dirtyViewport=!1}var n,o=e.map.search(t),h=0,_=o.length,u=this.visible_gl;for(u.length=0,h=0;h<_;h++)(n=o[h])._visible&&n.program&&n._drawLayer===this&&u.push(n);u.sort(this.zsort),_=u.length;var d=null;for(h=0;h<_;h++)d!==(n=u[h]).program&&(null!==d&&d.renderBatch(),(d=n.program).index_pointer=0,d.switchTo()),n.draw(),n._changed=!1;null!==d&&d.renderBatch()},dirty:function(t){},attach:function(t){t._drawContext=this.context},detach:function(t){t.program&&t.program.unregisterEntity(t)}});
},{"../core/core.js":22}],69:[function(require,module,exports) {

},{}],44:[function(require,module,exports) {
var t=require("../core/core.js"),e=window.document;t.extend({assignColor:function(){function t(t){return t._red=t._blue=t._green=0,t}function r(t){var e=t.toString(16);return 1===e.length&&(e="0"+e),e}function n(e,r){var n,o,i,a=e.length;if(7===a)n=e.substr(1,2),o=e.substr(3,2),i=e.substr(5,2);else{if(4!==a)return t(r);n=e.substr(1,1),n+=n,o=e.substr(2,1),o+=o,i=e.substr(3,1),i+=i}return r._red=parseInt(n,16),r._green=parseInt(o,16),r._blue=parseInt(i,16),r}function o(e,r){var n=u.exec(e);return null===n||4!==n.length&&5!==n.length?t(r):(r._red=Math.round(parseFloat(n[1])),r._green=Math.round(parseFloat(n[2])),r._blue=Math.round(parseFloat(n[3])),n[4]&&(r._strength=parseFloat(n[4])),r)}function i(t,e){if(void 0===l[t]){!1===s&&(window.document.body.appendChild(a),s=!0),a.style.color=t;o(window.getComputedStyle(a).color,e),l[t]=function(t,e,n){return"#"+r(t)+r(e)+r(n)}(e._red,e._green,e._blue)}else n(l[t],e);return e}var a=e.createElement("div");a.style.display="none";var s=!1,l={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#00ff00",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},u=/rgba?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,?\s*([0-9.]+)?\)/;return function(t,e){e=e||{};"#"===(t=t.trim().toLowerCase())[0]?n(t,e):"r"===t[0]&&"g"===t[1]&&"b"===t[2]?o(t,e):i(t,e),e._strength=e._strength||1,e._color=function(t){return"rgba("+t._red+", "+t._green+", "+t._blue+", "+t._strength+")"}(e)}}()});var r=require("fs");t.defaultShader("Color",new t.WebGLShader("attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\n\nvarying lowp vec4 vColor;\n\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vColor = vec4(aColor.rgb*aColor.a*aLayer.y, aColor.a*aLayer.y);\n}","precision mediump float;\nvarying lowp vec4 vColor;\nvoid main(void) {\n\tgl_FragColor = vColor;\n}",[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4}],function(t,e){t.program.writeVector("aColor",e._red/255,e._green/255,e._blue/255,e._strength)})),t.c("Color",{_red:0,_green:0,_blue:0,_strength:1,_color:"",ready:!0,init:function(){this.bind("Draw",this._drawColor),this._drawLayer&&this._setupColor(this._drawLayer),this.trigger("Invalidate")},events:{LayerAttached:"_setupColor"},remove:function(){this.unbind("Draw",this._drawColor),this.has("DOM")&&(this._element.style.backgroundColor="transparent"),this.trigger("Invalidate")},_setupColor:function(e){"WebGL"===e.type&&this._establishShader("Color",t.defaultShader("Color"))},_drawColor:function(t){this._color&&("DOM"===t.type?(t.style.backgroundColor=this._color,t.style.lineHeight=0):"canvas"===t.type?(t.ctx.fillStyle=this._color,t.ctx.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h)):"webgl"===t.type&&t.program.draw(t,this))},color:function(e){return 0===arguments.length?this._color:(arguments.length>=3?(this._red=arguments[0],this._green=arguments[1],this._blue=arguments[2],"number"==typeof arguments[3]&&(this._strength=arguments[3])):(t.assignColor(e,this),"number"==typeof arguments[1]&&(this._strength=arguments[1])),this._color="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this)}});
},{"fs":69,"../core/core.js":22}],45:[function(require,module,exports) {
var s=require("../core/core.js"),t=window.document;s.c("DOM",{_element:null,_cssStyles:null,avoidCss3dTransforms:!1,init:function(){this.requires("Renderable"),this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""},this._element=t.createElement("div"),this._customLayer||this._attachToLayer(s.s("DefaultDOMLayer")),this.bind("NewComponent",this._updateClass),this.bind("RemoveComponent",this._removeClass)},remove:function(){this._detachFromLayer(),this.unbind("NewComponent",this._updateClass),this.unbind("RemoveComponent",this._removeClass)},getDomId:function(){return this._element.id},_removeClass:function(s){var t,i=this.__c,e="";for(t in i)t!==s&&(e+=" "+t);e=e.substr(1),this._element.className=e},_updateClass:function(){var s,t=this.__c,i="";for(s in t)i+=" "+s;i=i.substr(1),this._element.className=i},DOM:function(s){if(s&&s.nodeType){var t=this._drawLayer;this._detachFromLayer(),this._element=s,this._attachToLayer(t)}return this},draw:function(){var t=this._element.style,i=this.__coord||[0,0,0,0],e={x:i[0],y:i[1],w:i[2],h:i[3]},h=s.support.prefix,r=[];if(this._cssStyles.visibility!==this._visible&&(this._cssStyles.visibility=this._visible,this._visible?t.visibility="visible":t.visibility="hidden"),s.support.css3dtransform&&!this.avoidCss3dTransforms?r.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(this._cssStyles.left!==this._x&&(this._cssStyles.left=this._x,t.left=~~this._x+"px"),this._cssStyles.top!==this._y&&(this._cssStyles.top=this._y,t.top=~~this._y+"px")),this._cssStyles.width!==this._w&&(this._cssStyles.width=this._w,t.width=~~this._w+"px"),this._cssStyles.height!==this._h&&(this._cssStyles.height=this._h,t.height=~~this._h+"px"),this._cssStyles.zIndex!==this._z&&(this._cssStyles.zIndex=this._z,t.zIndex=this._z),this._cssStyles.opacity!==this._alpha&&(this._cssStyles.opacity=this._alpha,t.opacity=this._alpha,t[h+"Opacity"]=this._alpha),this._mbr){var n=this._origin.x+"px "+this._origin.y+"px";t.transformOrigin=n,t[h+"TransformOrigin"]=n,s.support.css3dtransform?r.push("rotateZ("+this._rotation+"deg)"):r.push("rotate("+this._rotation+"deg)")}return this._flipX&&r.push("scaleX(-1)"),this._flipY&&r.push("scaleY(-1)"),this._cssStyles.transform!==r.join(" ")&&(this._cssStyles.transform=r.join(" "),t.transform=this._cssStyles.transform,t[h+"Transform"]=this._cssStyles.transform),this.trigger("Draw",{style:t,type:"DOM",co:e}),this},css:function(t,i){var e,h,r=this._element,n=r.style;if("object"==typeof t)for(e in t)t.hasOwnProperty(e)&&("number"==typeof(h=t[e])&&(h+="px"),n[s.domHelper.camelize(e)]=h);else{if(!i)return s.domHelper.getStyle(r,t);"number"==typeof i&&(i+="px"),n[s.domHelper.camelize(t)]=i}return this.trigger("Invalidate"),this}});
},{"../core/core.js":22}],46:[function(require,module,exports) {
var e=require("../core/core.js"),i=window.document;e._registerLayerTemplate("DOM",{type:"DOM",options:{xResponse:1,yResponse:1,scaleResponse:1,z:0},_changedObjs:[],_dirtyViewport:!1,_div:null,init:function(){this._changedObjs=[];var t=this._div=i.createElement("div");e.stage.elem.appendChild(t),t.style.position="absolute",t.style.zIndex=this.options.z,t.style.transformStyle="preserve-3d",this.uniqueBind("RenderScene",this._render),this.uniqueBind("PixelartSet",this._setPixelArt),this.uniqueBind("InvalidateViewport",function(){this._dirtyViewport=!0}),e._addDrawLayerInstance(this)},remove:function(){this._div.parentNode.removeChild(this._div),e._removeDrawLayerInstance(this)},_setPixelArt:function(i){var t=this._div.style,n=e.domHelper.camelize;i?(t[n("image-rendering")]="optimizeSpeed",t[n("image-rendering")]="-moz-crisp-edges",t[n("image-rendering")]="-o-crisp-edges",t[n("image-rendering")]="-webkit-optimize-contrast",t[n("-ms-interpolation-mode")]="nearest-neighbor",t[n("image-rendering")]="optimize-contrast",t[n("image-rendering")]="pixelated",t[n("image-rendering")]="crisp-edges"):(t[n("image-rendering")]="optimizeQuality",t[n("-ms-interpolation-mode")]="bicubic",t[n("image-rendering")]="auto")},debug:function(){e.log(this._changedObjs)},_render:function(){var e=this._changedObjs;if(this._dirtyViewport&&(this._setViewport(),this._dirtyViewport=!1),e.length){for(var i=0,t=e.length;i<t;++i)e[i].draw()._changed=!1;e.length=0}},dirty:function(e){this._changedObjs.push(e)},attach:function(e){e._drawContext=this.context,this._div.appendChild(e._element),e._element.style.position="absolute",e._element.id="ent"+e[0]},detach:function(e){this._div.removeChild(e._element)},_setViewport:function(){var i=this._div.style,t=this._viewportRect(),n=t._scale,r=-t._x*n,s=-t._y*n;i.transform=i[e.support.prefix+"Transform"]="scale("+n+", "+n+")",i.left=Math.round(r)+"px",i.top=Math.round(s)+"px",i.zIndex=this.options.z}});
},{"../core/core.js":22}],47:[function(require,module,exports) {
var e=require("../core/core.js"),t=window.document;e.extend({domHelper:{innerPosition:function(e){var r=e.getBoundingClientRect(),o=r.left+(window.pageXOffset?window.pageXOffset:t.body.scrollLeft),l=r.top+(window.pageYOffset?window.pageYOffset:t.body.scrollTop);return o+=parseInt(this.getStyle(e,"border-left-width")||0,10)||parseInt(this.getStyle(e,"borderLeftWidth")||0,10)||0,l+=parseInt(this.getStyle(e,"border-top-width")||0,10)||parseInt(this.getStyle(e,"borderTopWidth")||0,10)||0,{x:o,y:l}},getStyle:function(e,r){var o;return e.currentStyle?o=e.currentStyle[this.camelize(r)]:window.getComputedStyle&&(o=t.defaultView.getComputedStyle(e,null).getPropertyValue(this.csselize(r))),o},camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},csselize:function(e){return e.replace(/[A-Z]/g,function(e){return e?"-"+e.toLowerCase():""})},translate:function(r,o,l){var n,s=t.documentElement,i=t.body;return l?(n=l._viewportRect(),{x:(r-e.stage.x+(s&&s.scrollLeft||i&&i.scrollLeft||0))/n._scale+n._x,y:(o-e.stage.y+(s&&s.scrollTop||i&&i.scrollTop||0))/n._scale+n._y}):(n=e.viewport,{x:(r-e.stage.x+(s&&s.scrollLeft||i&&i.scrollLeft||0))/n._scale-n._x,y:(o-e.stage.y+(s&&s.scrollTop||i&&i.scrollTop||0))/n._scale-n._y})}}});
},{"../core/core.js":22}],48:[function(require,module,exports) {
var e=require("../core/core.js");e.extend({_pixelartEnabled:!1,pixelart:function(r){e._pixelartEnabled=r,e.trigger("PixelartSet",r)}});
},{"../core/core.js":22}],49:[function(require,module,exports) {
var e=require("../core/core.js");e.c("Renderable",{_changed:!1,_alpha:1,_visible:!0,_setterRenderable:function(e,i){this[e]!==i&&(this[e]=i,this.trigger("Invalidate"))},_graphics_property_definitions:{alpha:{set:function(e){this._setterRenderable("_alpha",e)},get:function(){return this._alpha},configurable:!0,enumerable:!0},_alpha:{enumerable:!1},visible:{set:function(e){this._setterRenderable("_visible",e)},get:function(){return this._visible},configurable:!0,enumerable:!0},_visible:{enumerable:!1}},_defineRenderableProperites:function(){for(var e in this._graphics_property_definitions)Object.defineProperty(this,e,this._graphics_property_definitions[e])},init:function(){this._defineRenderableProperites()},_invalidateRenderable:function(){!1===this._changed&&(this._changed=!0,this._drawLayer.dirty(this))},_attachToLayer:function(e){this._drawLayer&&this._detachFromLayer(),this._drawLayer=e,e.attach(this),this.bind("Invalidate",this._invalidateRenderable),this.trigger("LayerAttached",e),this.trigger("Invalidate")},_detachFromLayer:function(){this._drawLayer&&(this._drawLayer.detach(this),this.unbind("Invalidate",this._invalidateRenderable),this.trigger("LayerDetached",this._drawLayer),delete this._drawLayer)},flip:function(e){return e=e||"X",this["_flip"+e]||(this["_flip"+e]=!0,this.trigger("Invalidate")),this},unflip:function(e){return e=e||"X",this["_flip"+e]&&(this["_flip"+e]=!1,this.trigger("Invalidate")),this}});
},{"../core/core.js":22}],50:[function(require,module,exports) {
var n=require("../core/core.js");n.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(n){return this.inner=n,this._element.innerHTML=n,this},append:function(n){return this.inner+=n,this._element.innerHTML+=n,this},prepend:function(n){return this.inner=n+this.inner,this._element.innerHTML=n+this.inner,this}});
},{"../core/core.js":22}],51:[function(require,module,exports) {
function t(t,e){this.gl=t,this.webgl=e,this.max_units=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.bound_textures=[],this.registered_textures={},this.active=null}function e(t,e){this.manager=t,this.gl=t.gl,this.glTexture=this.gl.createTexture(),this.id=e,this.active=!1,this.unit=null,this.powerOfTwo=!1}var i=require("../core/core.js");i.TextureManager=t,t.prototype={reset:function(){for(var t=0;t<this.bound_textures.length;t++)this.bound_textures[t].unbind();this.bound_textures=[],this.active=null},makeTexture:function(t,i,r){var s=this.webgl,n="texture-(r:"+r+")-"+t;if(void 0!==this.registered_textures[n])return this.registered_textures[n];var h=new e(this,n);return this.registered_textures[n]=h,this.bindTexture(h),h.setImage(i),h.setFilter(s.texture_filter),h.setRepeat(r),h},smallest:function(){for(var t=1/0,e=null,i=0;i<this.bound_textures.length;i++){var r=this.bound_textures[i];r.size<t&&(t=r.size,e=i)}return e},getAvailableUnit:function(){return this.bound_textures.length<this.max_units?this.bound_textures.length:this.smallest()},bindTexture:function(t){if(null===t.unit){var e=this.getAvailableUnit();this.bound_textures[e]&&this.unbindTexture(this.bound_textures[e]),this.bound_textures[e]=t,t.bind(e)}},unbindTexture:function(t){t.unbind()},setActiveTexture:function(t){this.active!==t.id&&(this.gl.activeTexture(this.gl[t.name]),this.active=t.unit)}},i.TextureWrapper=e,e.prototype={bind:function(t){var e=this.gl;this.unit=t,this.name="TEXTURE"+t,this.manager.setActiveTexture(this),e.bindTexture(e.TEXTURE_2D,this.glTexture)},isActive:function(){return this.manager.active===this.unit},unbind:function(){this.unit=null,this.name=null,this.isActive()&&(this.manager.active=null)},setImage:function(t){if(!this.isActive())throw"Trying to set image of texture that isn't active";this.width=t.width,this.height=t.height,this.size=t.width*t.height,this.powerOfTwo=!(Math.log(t.width)/Math.LN2!==Math.floor(Math.log(t.width)/Math.LN2)||Math.log(t.height)/Math.LN2!==Math.floor(Math.log(t.height)/Math.LN2));var e=this.gl;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)},setFilter:function(t){if(!this.isActive())throw"Trying to set filter of texture that isn't active";var e=this.gl;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t)},setRepeat:function(t){if(!this.isActive())throw"Trying to set repeat property of texture that isn't active";if(t&&!this.powerOfTwo)throw"Can't create a repeating image whose dimensions aren't a power of 2 in WebGL contexts";var e=this.gl;this.repeatMode=t?e.REPEAT:e.CLAMP_TO_EDGE,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.repeatMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.repeatMode)},setToProgram:function(t,e,i){if(null===this.unit)throw"Trying to use texture not set to a texture unit.";var r=this.gl;r.useProgram(t),r.uniform1i(r.getUniformLocation(t,e),this.unit),r.uniform2f(r.getUniformLocation(t,i),this.width,this.height)}};
},{"../core/core.js":22}],52:[function(require,module,exports) {
var e=require("../core/core.js"),t=require("fs");e.defaultShader("Image",new e.WebGLShader("attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}","varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}",[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}],function(e,t){var i=e.pos;e.program.writeVector("aTextureCoord",0,0,0,i._h,i._w,0,i._w,i._h)})),e.c("Image",{_repeat:"repeat",ready:!1,init:function(){this.bind("Draw",this._drawImage),this.bind("LayerAttached",this._setupImage)},remove:function(){this.unbind("LayerAttached",this._setupImage),this.unbind("Draw",this._drawImage)},image:function(t,i){if(this.__image=t,this._repeat=i||"no-repeat",this.img=e.asset(t),this.img)this._setupImage(this._drawLayer);else{this.img=new Image,e.asset(t,this.img),this.img.src=t;var a=this;this.img.onload=function(){a._setupImage(a._drawLayer)}}return this.trigger("Invalidate"),this},_setupImage:function(t){this.img&&t&&("Canvas"===t.type?this._pattern=this._drawContext.createPattern(this.img,this._repeat):"WebGL"===t.type&&(this._establishShader("image:"+this.__image,e.defaultShader("Image")),this.program.setTexture(this._drawLayer.makeTexture(this.__image,this.img,"no-repeat"!==this._repeat))),"no-repeat"===this._repeat&&(this.w=this.w||this.img.width,this.h=this.h||this.img.height),this.ready=!0,this.trigger("Invalidate"))},_drawImage:function(e){if("canvas"===e.type){if(!this.ready||!this._pattern)return;var t=e.ctx;t.fillStyle=this._pattern,t.save(),t.translate(e.pos._x,e.pos._y),t.fillRect(0,0,e.pos._w,e.pos._h),t.restore()}else"DOM"===e.type?this.__image&&(e.style.backgroundImage="url("+this.__image+")",e.style.backgroundRepeat=this._repeat):"webgl"===e.type&&e.program.draw(e,this)}});
},{"fs":69,"../core/core.js":22}],53:[function(require,module,exports) {
var t=require("../core/core.js"),i=window.document;t.c("Particles",{init:function(){this._Particles=t.clone(this._Particles),this._Particles.parentEntity=this,this._particlesPaused=!1},particles:function(e){if(!t.support.canvas||t.deactivateParticles)return this;var s,o,r,a,n;(s=i.createElement("canvas")).width=t.viewport.width,s.height=t.viewport.height,s.style.position="absolute",s.style.left="0px",s.style.top="0px",t.stage.elem.appendChild(s),o=s.getContext("2d"),this._Particles.init(e),this.bind("Remove",function(){t.stage.elem.removeChild(s)}).bind("RemoveComponent",function(i){"particles"===i&&t.stage.elem.removeChild(s)}),r=this.x+t.viewport.x,a=this.y+t.viewport.y,this._Particles.position=this._Particles.vectorHelpers.create(r,a);var h={x:t.viewport.x,y:t.viewport.y};return this.bind("EnterFrame",function(){this._particlesPaused||(r=this.x+t.viewport.x,a=this.y+t.viewport.y,this._Particles.viewportDelta={x:t.viewport.x-h.x,y:t.viewport.y-h.y},h={x:t.viewport.x,y:t.viewport.y},this._Particles.position=this._Particles.vectorHelpers.create(r,a),"function"==typeof t.rectManager.boundingRect?(n=t.rectManager.boundingRect(this._Particles.register))&&o.clearRect(n._x,n._y,n._w,n._h):o.clearRect(0,0,t.viewport.width,t.viewport.height),this._Particles.update(),this._Particles.render(o))}),this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,originOffset:{x:0,y:0},particles:[],active:!0,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(t){this.position=this.vectorHelpers.create(0,0),void 0===t&&(t={});for(var i in this.presets)void 0!==t[i]?this[i]=t[i]:this[i]=this.presets[i];this.emissionRate=this.maxParticles/this.lifeSpan,this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount===this.maxParticles)return!1;var t=new this.particle(this.vectorHelpers);return this.initParticle(t),this.particles[this.particleCount]=t,this.particleCount++,!0},RANDM1TO1:function(){return 2*Math.random()-1},initParticle:function(i){i.position.x=t.viewport._scale*(this.position.x+this.originOffset.x+this.positionRandom.x*this.RANDM1TO1()),i.position.y=t.viewport._scale*(this.position.y+this.originOffset.y+this.positionRandom.y*this.RANDM1TO1());var e=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),s=this.vectorHelpers.create(Math.sin(e),-Math.cos(e)),o=this.speed+this.speedRandom*this.RANDM1TO1();i.direction=this.vectorHelpers.multiply(s,o),i.size=t.viewport._scale*(this.size+this.sizeRandom*this.RANDM1TO1()),i.size=i.size<0?0:~~i.size,i.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1(),i.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1(),i.sharpness=i.sharpness>100?100:i.sharpness<0?0:i.sharpness,i.sizeSmall=~~(i.size/200*i.sharpness);var r=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()],a=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];i.colour=r,i.deltaColour[0]=(a[0]-r[0])/i.timeToLive,i.deltaColour[1]=(a[1]-r[1])/i.timeToLive,i.deltaColour[2]=(a[2]-r[2])/i.timeToLive,i.deltaColour[3]=(a[3]-r[3])/i.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var t=1/this.emissionRate;for(this.emitCounter++;this.particleCount<this.maxParticles&&this.emitCounter>t;)this.addParticle(),this.emitCounter-=t;this.elapsedFrames++,-1!==this.duration&&this.duration<this.elapsedFrames&&this.stop()}this.particleIndex=0,this.register=[];for(var i;this.particleIndex<this.particleCount;){var e=this.particles[this.particleIndex];if(e.timeToLive>0){e.direction=this.vectorHelpers.add(e.direction,this.gravity),e.position=this.vectorHelpers.add(e.position,e.direction),e.position=this.vectorHelpers.add(e.position,this.viewportDelta),this.jitter&&(e.position.x+=this.jitter*this.RANDM1TO1(),e.position.y+=this.jitter*this.RANDM1TO1()),e.timeToLive--;var s=e.colour[0]+=e.deltaColour[0],o=e.colour[1]+=e.deltaColour[1],r=e.colour[2]+=e.deltaColour[2],a=e.colour[3]+=e.deltaColour[3];(i=[]).push("rgba("+(s>255?255:s<0?0:~~s)),i.push(o>255?255:o<0?0:~~o),i.push(r>255?255:r<0?0:~~r),i.push((a>1?1:a<0?0:a.toFixed(2))+")"),e.drawColour=i.join(","),this.fastMode||(i[3]="0)",e.drawColourEnd=i.join(",")),this.particleIndex++}else this.particleIndex!==this.particleCount-1&&(this.particles[this.particleIndex]=this.particles[this.particleCount-1]),this.particleCount--;var n={};n._x=~~e.position.x,n._y=~~e.position.y,n._w=e.size,n._h=e.size,this.register.push(n)}},stop:function(){this.active=!1,this.elapsedFrames=0,this.emitCounter=0,this.parentEntity.trigger("ParticleEnd")},render:function(i){for(var e=0,s=this.particleCount;e<s;e++){var o=this.particles[e],r=o.size,a=r>>1;if(!(o.position.x+r<0||o.position.y+r<0||o.position.x-r>t.viewport.width||o.position.y-r>t.viewport.height)){var n=~~o.position.x,h=~~o.position.y;if(this.fastMode)i.fillStyle=o.drawColour;else{var l=i.createRadialGradient(n+a,h+a,o.sizeSmall,n+a,h+a,a);l.addColorStop(0,o.drawColour),l.addColorStop(.9,o.drawColourEnd),i.fillStyle=l}i.fillRect(n,h,r,r)}}},particle:function(t){this.position=t.create(0,0),this.direction=t.create(0,0),this.size=0,this.sizeSmall=0,this.timeToLive=0,this.colour=[],this.drawColour="",this.deltaColour=[],this.sharpness=0},vectorHelpers:{create:function(t,i){return{x:t,y:i}},multiply:function(t,i){return t.x*=i,t.y*=i,t},add:function(t,i){return t.x+=i.x,t.y+=i.y,t}}},pauseParticles:function(){this._particlesPaused=!0},resumeParticles:function(){this._particlesPaused=!1}});
},{"../core/core.js":22}],54:[function(require,module,exports) {
var e=require("../core/core.js");e.c("SpriteAnimation",{_reels:null,_currentReelId:null,_currentReel:null,_isPlaying:!1,animationSpeed:1,init:function(){this._reels={}},reel:function(t,i,r,n,s,a){if(0===arguments.length)return this._currentReelId;if(1===arguments.length&&"string"==typeof t){if(void 0===this._reels[t])throw"The specified reel "+t+" is undefined.";return this.pauseAnimation(),this._currentReelId!==t&&(this._currentReelId=t,this._currentReel=this._reels[t],this._updateSprite(),this.trigger("ReelChange",this._currentReel)),this}var l,h;if(l={id:t,frames:[],currentFrame:0,easing:new e.easing(i),defaultLoops:1},l.duration=l.easing.duration,"number"==typeof r)if(a=a||1/0,s>=0)for(h=0;h<s;++h)l.frames.push([r,n]),++r>=a&&(r=0,n++);else for(h=0;h>s;--h)l.frames.push([r,n]),--r<0&&(r=a-1,n--);else{if(3!==arguments.length||"object"!=typeof r)throw"Unrecognized arguments. Please see the documentation for 'reel(...)'.";l.frames=r}return this._reels[t]=l,this},animate:function(e,t){"string"==typeof e&&this.reel(e);var i=this._currentReel;if(void 0===i||null===i)throw"No reel is specified, and there is no currently active reel.";return this.pauseAnimation(),void 0===t&&(t="number"==typeof e?e:1),i.easing.reset(),this.loops(t),this._setFrame(0),this.bind("EnterFrame",this._animationTick),this._isPlaying=!0,this.trigger("StartAnimation",i),this},resumeAnimation:function(){return!1===this._isPlaying&&null!==this._currentReel&&(this.bind("EnterFrame",this._animationTick),this._isPlaying=!0,this._currentReel.easing.resume(),this.trigger("StartAnimation",this._currentReel)),this},pauseAnimation:function(){return!0===this._isPlaying&&(this.unbind("EnterFrame",this._animationTick),this._isPlaying=!1,this._reels[this._currentReelId].easing.pause()),this},resetAnimation:function(){var e=this._currentReel;if(null===e)throw"No active reel to reset.";return this.reelPosition(0),e.easing.repeat(e.defaultLoops),this},loops:function(e){return 0===arguments.length?null!==this._currentReel?this._currentReel.easing.loops:0:(null!==this._currentReel&&(e<0&&(e=1/0),this._currentReel.easing.repeat(e),this._currentReel.defaultLoops=e),this)},reelPosition:function(e){if(null===this._currentReel)throw"No active reel.";if(0===arguments.length)return this._currentReel.currentFrame;var t,i=this._currentReel.frames.length;if("end"===e&&(e=i-1),e<1&&e>0)t=e,e=Math.floor(i*t);else{if(e!==Math.floor(e))throw"Position "+e+" is invalid.";e<0&&(e=i-1+e),t=e/i}return e=Math.min(e,i-1),e=Math.max(e,0),this._setProgress(t),this._setFrame(e),this},_animationTick:function(e){var t=this._reels[this._currentReelId];t.easing.tick(e.dt*this.animationSpeed);var i=t.easing.value(),r=Math.min(Math.floor(t.frames.length*i),t.frames.length-1);this._setFrame(r),!0===t.easing.complete&&(this.pauseAnimation(),this.trigger("AnimationEnd",this._currentReel))},_setFrame:function(e){var t=this._currentReel;e!==t.currentFrame&&(t.currentFrame=e,this._updateSprite(),this.trigger("FrameChange",t))},_updateSprite:function(){var e=this._currentReel,t=e.frames[e.currentFrame];this.sprite(t[0],t[1])},_setProgress:function(e,t){this._currentReel.easing.setProgress(e,t)},isPlaying:function(e){return!!this._isPlaying&&(e?this._currentReelId===e:!!this._currentReelId)},getReel:function(e){if(0===arguments.length){if(!this._currentReelId)return null;e=this._currentReelId}return this._reels[e]}});
},{"../core/core.js":22}],55:[function(require,module,exports) {
var i=require("../core/core.js"),t=require("fs");i.defaultShader("Sprite",new i.WebGLShader("attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}","varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}",[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}],function(i,t){var e=i.co;i.program.writeVector("aTextureCoord",e.x,e.y,e.x,e.y+e.h,e.x+e.w,e.y,e.x+e.w,e.y+e.h)})),i.extend({sprite:function(t,e,r,o,s,a,n){var _,h,d;"string"==typeof t&&(a=s,s=o,o=e,r=t,t=1,e=1),"string"==typeof e&&(a=s,s=o,o=r,r=e,e=t),!a&&s&&(a=s),s=parseInt(s||0,10),a=parseInt(a||0,10);var c=function(){this.ready=!0,this.trigger("Invalidate")};(d=i.asset(r))||((d=new Image).src=r,i.asset(r,d),d.onload=function(){for(var t in o)i(t).each(c)});var m=function(){this.requires("2D, Sprite"),this.__trim=[0,0,0,0],this.__image=r,this.__map=o,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=t,this.__tileh=e,this.__padding=[s,a],this.__padBorder=n,this.sprite(this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]),this.img=d,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger("Invalidate")),this.w=this.__coord[2],this.h=this.__coord[3],this._setupSpriteImage(this._drawLayer)};for(_ in o)o.hasOwnProperty(_)&&(h=o[_],i.c(_,{ready:!1,__coord:[h[0],h[1],h[2]||1,h[3]||1],init:m}));return this}}),i.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0],this.bind("Draw",this._drawSprite),this.bind("LayerAttached",this._setupSpriteImage)},remove:function(){this.unbind("Draw",this._drawSprite),this.unbind("LayerAttached",this._setupSpriteImage)},_setupSpriteImage:function(t){this.__image&&this.img&&t&&"WebGL"===t.type&&(this._establishShader(this.__image,i.defaultShader("Sprite")),this.program.setTexture(t.makeTexture(this.__image,this.img,!1)))},_drawSprite:function(i){var t=i.co,e=i.pos,r=i.ctx;if("canvas"===i.type)r.drawImage(this.img,t.x,t.y,t.w,t.h,e._x,e._y,e._w,e._h);else if("DOM"===i.type){var o=this._h/t.h,s=this._w/t.w,a=this._element.style,n=a.backgroundColor;"initial"===n&&(n="");var _=n+" url('"+this.__image+"') no-repeat";_!==a.background&&(a.background=_),a.backgroundPosition="-"+t.x*s+"px -"+t.y*o+"px",1===o&&1===s||(a.backgroundSize=this.img.width*s+"px "+this.img.height*o+"px")}else"webgl"===i.type&&i.program.draw(i,this)},sprite:function(i,t,e,r){if("string"==typeof i){var o=this.__map[i];if(!o)return this;i=o[0],t=o[1],e=o[2]||1,r=o[3]||1}return this.__coord=this.__coord||[0,0,0,0],this.__coord[0]=i*(this.__tile+this.__padding[0])+(this.__padBorder?this.__padding[0]:0)+this.__trim[0],this.__coord[1]=t*(this.__tileh+this.__padding[1])+(this.__padBorder?this.__padding[1]:0)+this.__trim[1],void 0!==e&&void 0!==r&&(this.__coord[2]=this.__trim[2]||e*this.__tile||this.__tile,this.__coord[3]=this.__trim[3]||r*this.__tileh||this.__tileh),this.trigger("Invalidate"),this},crop:function(i,t,e,r){var o=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=i,this.__trim[1]=t,this.__trim[2]=e,this.__trim[3]=r,this.__coord[0]+=i,this.__coord[1]+=t,this.__coord[2]=e,this.__coord[3]=r,this._w=e,this._h=r,this.trigger("Invalidate",o),this}});
},{"fs":69,"../core/core.js":22}],56:[function(require,module,exports) {
var t=require("../core/core.js");t.c("Text",{_text:"",defaultSize:"10px",defaultFamily:"sans-serif",defaultVariant:"normal",defaultLineHeight:"normal",defaultTextAlign:"left",ready:!0,init:function(){this.requires("2D"),this._textFont={type:"",weight:"",size:this.defaultSize,lineHeight:this.defaultLineHeight,family:this.defaultFamily,variant:this.defaultVariant},this._textAlign=this.defaultTextAlign},events:{Draw:function(t){var e=this._fontString();if("DOM"===t.type){var i=this._element,n=i.style;n.color=this._textColor,n.font=e,n.textAlign=this._textAlign,i.innerHTML=this._text}else if("canvas"===t.type){var s=t.ctx;s.save(),s.textBaseline="top",s.fillStyle=this._textColor||"rgb(0,0,0)",s.font=e,s.textAlign=this._textAlign,s.fillText(this._text,t.pos._x,t.pos._y),s.restore()}}},remove:function(){this.unbind(this._textUpdateEvent,this._dynamicTextUpdate)},_getFontHeight:function(){var t=/([a-zA-Z]+)\b/,e={px:1,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,in:96,em:void 0,ex:void 0};return function(i){var n=parseFloat(i),s=t.exec(i),h=s?s[1]:"px";return void 0!==e[h]?Math.ceil(n*e[h]):Math.ceil(n)}}(),_textGenerator:null,text:function(t){return void 0===t||null===t?this._text:("function"==typeof t?(this._text=t.call(this),this._textGenerator=t):(this._text=t,this._textGenerator=null),this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this)},_dynamicTextOn:!1,_textUpdateEvent:null,_dynamicTextUpdate:function(){this._textGenerator&&this.text(this._textGenerator)},dynamicTextGeneration:function(t,e){return this.unbind(this._textUpdateEvent,this._dynamicTextUpdate),t&&(this._textUpdateEvent=e||"EnterFrame",this.bind(this._textUpdateEvent,this._dynamicTextUpdate)),this},_resizeForCanvas:function(){var t=this._drawContext;t.font=this._fontString(),this.w=t.measureText(this._text).width;var e=this._textFont.size||this.defaultSize;this.h=1.1*this._getFontHeight(e),"left"===this._textAlign||"start"===this._textAlign?this.offsetBoundary(0,0,0,0):"center"===this._textAlign?this.offsetBoundary(this.w/2,0,-this.w/2,0):"end"!==this._textAlign&&"right"!==this._textAlign||this.offsetBoundary(this.w,0,-this.w,0)},_fontString:function(){return this._textFont.type+" "+this._textFont.variant+" "+this._textFont.weight+" "+this._textFont.size+" / "+this._textFont.lineHeight+" "+this._textFont.family},textColor:function(e){return t.assignColor(e,this),this._textColor="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this},textAlign:function(t){return this._textAlign=t,this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this},textFont:function(t,e){if(1===arguments.length){if("string"==typeof t)return this._textFont[t];if("object"==typeof t)for(var i in t)this._textFont[i]="family"===i?"'"+t[i]+"'":t[i]}else this._textFont[t]=e;return this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this},unselectable:function(){return this.has("DOM")&&(this.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default"}),this.trigger("Invalidate")),this}});
},{"../core/core.js":22}],57:[function(require,module,exports) {
var t=require("../core/core.js");t.extend({diamondIso:{_tile:{width:0,height:0},getTileDimensions:function(){return{w:this._tile.width,h:this._tile.height}},_map:{width:0,height:0},_origin:{x:0,y:0},_tiles:[],getTile:function(t,i,h){return this._tiles[t][i][h]},init:function(t,i,h,e,s,r){this._tile.width=parseInt(t,10),this._tile.height=parseInt(i,10)||parseInt(t,10)/2,this._tile.r=this._tile.width/this._tile.height,this._map.width=parseInt(h,10),this._map.height=parseInt(e,10)||parseInt(h,10);for(var n=0;n<h;n++){this._tiles[n]=Array();for(var l=0;l<e;l++)this._tiles[n][l]=Array()}return this.x=parseInt(s,10)||0,this.y=parseInt(r,10)||0,this.layerZLevel=h+e+1,this},place:function(t,i,h,e){var s=this.pos2px(i,h),r=t.h/this._tile.height;t.x=s.x,t.y=s.y-(r-2)*this._tile.height-this._tile.height*e,t.z=this.getZAtLoc(i,h,e);for(var n=0;n<=r-2;n++){var l=this._tiles[i][h][e+n];l&&l!==t&&l.destroy(),this._tiles[i][h][e+n]=t}return this},detachTile:function(t){for(var i=0;i<this._map.width;i++)for(var h=0;h<this._map.height;h++)for(var e=this._tiles[i][h].length,s=0;s<e;s++)if(this._tiles[i][h][s]&&t===this._tiles[i][h][s]){for(var r=t.h/this._tile.height,n=0;n<r;n++)this._tiles[i][h][s+n]=void 0;return{x:i,y:h,z:s}}return!1},centerAt:function(i,h){var e=this.pos2px(i,h);t.viewport.x=-e.x+t.viewport.width/2-this._tile.width,t.viewport.y=-e.y+t.viewport.height/2},getZAtLoc:function(t,i,h){return this.layerZLevel*h+t+i},pos2px:function(t,i){return{x:this.x+(t-i-1)*this._tile.width/2,y:this.y+(t+i)*this._tile.height/2}},px2pos:function(t,i){var h=(i-this.y)/this._tile.height,e=(t-this.x)/this._tile.width,s=h+e,r=h-e,n=s>0&&s<this._map.width,l=r>0&&r<this._map.height;if(n&&l)return{x:~~s,y:~~r}},getOverlappingTiles:function(t,i){var h=this.px2pos(t,i),e=[],s=~~h.x,r=~~h.y,n=this._map.width-s,l=this._map.height-r,_=Math.min(n,l),o=this._tiles[s][r][1];o&&e.push(o);for(var a=1;a<_;a++){var p=this._tiles[s+a][r+a][a];p&&e.push(p)}return e},polygon:function(i){i.requires("Collision");var h=[0,i.h-0-this._tile.height/2,0-this._tile.width/2,i.h-0-0,0-this._tile.width,i.h-0-this._tile.height/2,0-this._tile.width/2,i.h-0-this._tile.height];return new t.polygon(h)}}});
},{"../core/core.js":22}],58:[function(require,module,exports) {
var e=require("../core/core.js"),t=window.document;e.extend({viewport:{clampToEntities:!0,_width:0,_height:0,_x:0,_y:0,_scale:1,bounds:null,scroll:function(t,i){this[t]=i,e.trigger("ViewportScroll"),e.trigger("InvalidateViewport")},rect_object:{_x:0,_y:0,_w:0,_h:0},rect:function(e){return e=e||this.rect_object,e._x=-this._x,e._y=-this._y,e._w=this._width/this._scale,e._h=this._height/this._scale,e},pan:function(){function t(t){a.tick(t.dt);var l=a.value();e.viewport.x=(1-l)*o+l*r,e.viewport.y=(1-l)*s+l*n,e.viewport._clamp(),a.complete&&(i(),e.trigger("CameraAnimationDone"))}function i(){e.unbind("EnterFrame",t)}var r,n,o,s,a;return e._preBind("StopCamera",i),function(i,l,p,c){e.trigger("StopCamera"),"reset"!==i&&(o=e.viewport._x,s=e.viewport._y,r=o-i,n=s-l,a=new e.easing(p,c),e.uniqueBind("EnterFrame",t))}}(),follow:function(){function t(){var t=e.viewport._scale;e.viewport.scroll("_x",-(this.x+this.w/2-e.viewport.width/2/t-r*t)),e.viewport.scroll("_y",-(this.y+this.h/2-e.viewport.height/2/t-n*t)),e.viewport._clamp()}var i,r,n;return e._preBind("StopCamera",function(){i&&(i.unbind("Move",t),i.unbind("ViewportScale",t),i.unbind("ViewportResize",t))}),function(o,s,a){o&&o.has("2D")&&(e.trigger("StopCamera"),i=o,r=void 0!==s?s:0,n=void 0!==a?a:0,o.bind("Move",t),o.bind("ViewportScale",t),o.bind("ViewportResize",t),t.call(o))}}(),centerOn:function(t,i){var r=t.x+e.viewport.x,n=t.y+e.viewport.y,o=t.w/2,s=t.h/2,a=r+o-e.viewport.width/2/e.viewport._scale,l=n+s-e.viewport.height/2/e.viewport._scale;e.viewport.pan(a,l,i)},zoom:function(){function t(){e.unbind("EnterFrame",i)}function i(i){var n,h;c.tick(i.dt),n=Math.pow(o,c.value()),h=1===o?c.value():(1/n-1)/(1/o-1),e.viewport.scale(n*r),e.viewport.scroll("_x",s*(1-h)+a*h),e.viewport.scroll("_y",l*(1-h)+p*h),e.viewport._clamp(),c.complete&&(t(),e.trigger("CameraAnimationDone"))}e._preBind("StopCamera",t);var r,n,o,s,a,l,p,c;return function(t,h,w,u,g){t?(arguments.length<=2&&(u=h,h=e.viewport.x-e.viewport.width,w=e.viewport.y-e.viewport.height),e.trigger("StopCamera"),r=e.viewport._scale,n=r*(o=t),s=e.viewport.x,l=e.viewport.y,a=-(h-e.viewport.width/(2*n)),p=-(w-e.viewport.height/(2*n)),c=new e.easing(u,g),e.uniqueBind("EnterFrame",i)):e.viewport.scale(1)}}(),scale:function(t){this._scale=t||1,e.trigger("InvalidateViewport"),e.trigger("ViewportScale")},mouselook:function(){var t=!1,i=!1,r={};return function(n,o){if("boolean"!=typeof n){if(t)switch(n){case"move":case"drag":if(!i)return;var s={x:o.clientX-r.x,y:o.clientY-r.y};r.x=o.clientX,r.y=o.clientY,e.viewport.x+=s.x,e.viewport.y+=s.y,e.viewport._clamp();break;case"start":e.trigger("StopCamera"),r.x=o.clientX,r.y=o.clientY,i=!0;break;case"stop":i=!1}}else(t=n)?e.mouseObjs++:e.mouseObjs=Math.max(0,e.mouseObjs-1)}}(),_clamp:function(){if(this.clampToEntities){var t=e.clone(this.bounds)||e.clone(e.map.boundaries());t.max.x*=this._scale,t.min.x*=this._scale,t.max.y*=this._scale,t.min.y*=this._scale,t.max.x-t.min.x>e.viewport.width?e.viewport.x<(-t.max.x+e.viewport.width)/this._scale?e.viewport.x=(-t.max.x+e.viewport.width)/this._scale:e.viewport.x>-t.min.x&&(e.viewport.x=-t.min.x):e.viewport.x=-1*(t.min.x+(t.max.x-t.min.x)/2-e.viewport.width/2),t.max.y-t.min.y>e.viewport.height?e.viewport.y<(-t.max.y+e.viewport.height)/this._scale?e.viewport.y=(-t.max.y+e.viewport.height)/this._scale:e.viewport.y>-t.min.y&&(e.viewport.y=-t.min.y):e.viewport.y=-1*(t.min.y+(t.max.y-t.min.y)/2-e.viewport.height/2)}},init:function(i,r,n){e.createLayer("DefaultCanvasLayer","Canvas",{z:20}),e.createLayer("DefaultDOMLayer","DOM",{z:30}),e.createLayer("DefaultWebGLLayer","WebGL",{z:10}),this._defineViewportProperties(),this._x=0,this._y=0,this._scale=1,this.bounds=null,this._width=i||window.innerWidth,this._height=r||window.innerHeight,void 0===n&&(n="cr-stage");var o;if("string"==typeof n)o=t.getElementById(n);else{if(!("undefined"!=typeof HTMLElement?n instanceof HTMLElement:n instanceof Element))throw new TypeError("stage_elem must be a string or an HTMLElement");o=n}e.stage={x:0,y:0,fullscreen:!1,elem:o||t.createElement("div")},i||r||(t.body.style.overflow="hidden",e.stage.fullscreen=!0),e.addEvent(this,window,"resize",e.viewport.reload),e.addEvent(this,window,"blur",function(){e.settings.get("autoPause")&&(e._paused||e.pause())}),e.addEvent(this,window,"focus",function(){e._paused&&e.settings.get("autoPause")&&e.pause()}),e.settings.register("stageSelectable",function(t){e.stage.elem.onselectstart=t?function(){return!0}:function(){return!1}}),e.settings.modify("stageSelectable",!1),e.settings.register("stageContextMenu",function(t){e.stage.elem.oncontextmenu=t?function(){return!0}:function(){return!1}}),e.settings.modify("stageContextMenu",!1),e.settings.register("autoPause",function(){}),e.settings.modify("autoPause",!1),o||(t.body.appendChild(e.stage.elem),e.stage.elem.id=n);var s,a=e.stage.elem.style;if(a.width=this.width+"px",a.height=this.height+"px",a.overflow="hidden",e.bind("ViewportResize",function(){e.trigger("InvalidateViewport")}),e.mobile){void 0!==typeof a.webkitTapHighlightColor&&(a.webkitTapHighlightColor="rgba(0,0,0,0)");var l=t.createElement("meta"),p=t.getElementsByTagName("head")[0];(l=t.createElement("meta")).setAttribute("name","apple-mobile-web-app-capable"),l.setAttribute("content","yes"),p.appendChild(l),e.addEvent(this,e.stage.elem,"touchmove",function(e){e.preventDefault()})}a.position="relative",s=e.domHelper.innerPosition(e.stage.elem),e.stage.x=s.x,e.stage.y=s.y,e.uniqueBind("ViewportResize",this._resize)},_resize:function(){e.stage.elem.style.width=e.viewport.width+"px",e.stage.elem.style.height=e.viewport.height+"px"},_defineViewportProperties:function(){Object.defineProperty(this,"x",{set:function(e){this.scroll("_x",e)},get:function(){return this._x},configurable:!0}),Object.defineProperty(this,"y",{set:function(e){this.scroll("_y",e)},get:function(){return this._y},configurable:!0}),Object.defineProperty(this,"width",{set:function(t){this._width=t,e.trigger("ViewportResize")},get:function(){return this._width},configurable:!0}),Object.defineProperty(this,"height",{set:function(t){this._height=t,e.trigger("ViewportResize")},get:function(){return this._height},configurable:!0})},reload:function(){var t,i=window.innerWidth,r=window.innerHeight;e.stage.fullscreen&&(this._width=i,this._height=r,e.trigger("ViewportResize")),t=e.domHelper.innerPosition(e.stage.elem),e.stage.x=t.x,e.stage.y=t.y},reset:function(){e.viewport.mouselook("stop"),e.trigger("StopCamera"),e.viewport.scroll("_x",0),e.viewport.scroll("_y",0),e.viewport.scale(1)},onScreen:function(t){return e.viewport._x+t._x+t._w>0&&e.viewport._y+t._y+t._h>0&&e.viewport._x+t._x<e.viewport.width&&e.viewport._y+t._y<e.viewport.height}}});
},{"../core/core.js":22}],59:[function(require,module,exports) {
var t=require("../core/core.js");t.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(t,i){return this._tile.width=t,this._tile.height=i>0?i:t/2,this},place:function(i,e,h,r){var o=this.pos2px(i,e);return o.top-=h*(this._tile.height/2),r.x=o.left+t.viewport._x,r.y=o.top+t.viewport._y,r.z+=h,this},pos2px:function(t,i){return{left:t*this._tile.width+(1&i)*(this._tile.width/2),top:i*this._tile.height/2}},px2pos:function(t,i){return{x:-Math.ceil(-t/this._tile.width-.5*(1&i)),y:i/this._tile.height*2}},centerAt:function(i,e){if("number"==typeof i&&"number"==typeof e){var h=this.pos2px(i,e);return t.viewport._x=-h.left+t.viewport.width/2-this._tile.width/2,t.viewport._y=-h.top+t.viewport.height/2-this._tile.height/2,this}return{top:-t.viewport._y+t.viewport.height/2-this._tile.height/2,left:-t.viewport._x+t.viewport.width/2-this._tile.width/2}},area:function(){var i=this.centerAt(),e=this.px2pos(-i.left+t.viewport.width/2,-i.top+t.viewport.height/2),h=this.px2pos(-i.left-t.viewport.width/2,-i.top-t.viewport.height/2);return{x:{start:e.x,end:h.x},y:{start:e.y,end:h.y}}}}});
},{"../core/core.js":22}],60:[function(require,module,exports) {
var e=require("../core/core.js"),t=window.document;e.extend({over:null,mouseObjs:0,mousePos:{},touchObjs:0,lastEvent:null,keydown:{},selected:!1,detectBlur:function(t){var o=t.clientX>e.stage.x&&t.clientX<e.stage.x+e.viewport.width&&t.clientY>e.stage.y&&t.clientY<e.stage.y+e.viewport.height;!e.selected&&o&&e.trigger("CraftyFocus"),e.selected&&!o&&e.trigger("CraftyBlur"),e.selected=o},multitouch:function(e){if("boolean"!=typeof e)return this._touchHandler.multitouch;this._touchHandler.multitouch=e},resetKeyDown:function(){for(var t in e.keys)e.keydown[e.keys[t]]&&this.trigger("KeyUp",{key:e.keys[t]});e.keydown={}},mouseButtonsDown:{},mouseDispatch:function(t){if(e.mouseObjs){e.lastEvent=t;var o,s=t.target?t.target:t.srcElement,n=e.domHelper.translate(t.clientX,t.clientY),i=t.type;void 0===t.which?t.mouseButton=t.button<2?e.mouseButtons.LEFT:4===t.button?e.mouseButtons.MIDDLE:e.mouseButtons.RIGHT:t.mouseButton=t.which<2?e.mouseButtons.LEFT:2===t.which?e.mouseButtons.MIDDLE:e.mouseButtons.RIGHT,e.mousePos.x=n.x,e.mousePos.y=n.y,"mousedown"===i&&(this.mouseButtonsDown[t.mouseButton]=!0),"mouseup"===i&&delete this.mouseButtonsDown[t.mouseButton],(o=e.findPointerEventTargetByComponent("Mouse",t,s))?"mousedown"===i?o.trigger("MouseDown",t):"mouseup"===i?o.trigger("MouseUp",t):"dblclick"===i?o.trigger("DoubleClick",t):"click"===i?o.trigger("Click",t):"mousemove"===i?(o.trigger("MouseMove",t),this.over!==o&&(this.over&&(this.over.trigger("MouseOut",t),this.over=null),this.over=o,o.trigger("MouseOver",t))):o.trigger(i,t):("mousemove"===i&&this.over&&(this.over.trigger("MouseOut",t),this.over=null),"mousedown"===i?e.viewport.mouselook("start",t):"mousemove"===i?e.viewport.mouselook("drag",t):"mouseup"===i&&e.viewport.mouselook("stop"),"mousedown"===i?e.s("Controls").trigger("MouseDown",t):"mouseup"===i?e.s("Controls").trigger("MouseUp",t):"dblclick"===i?e.s("Controls").trigger("DoubleClick",t):"click"===i&&e.s("Controls").trigger("Click",t)),"mousemove"===i&&(this.lastEvent=t)}},touchDispatch:function(t){if(e.touchObjs||e.mouseObjs){if(this._touchHandler.multitouch)switch(t.type){case"touchstart":this._touchHandler.handleStart(t);break;case"touchmove":this._touchHandler.handleMove(t);break;case"touchleave":case"touchcancel":case"touchend":this._touchHandler.handleEnd(t)}else this._touchHandler.mimicMouse(t);t.target&&"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}},_touchHandler:{fingers:[],multitouch:!1,handleStart:function(e){for(var t=e.changedTouches,o=0,s=t.length;o<s;o++){var n,i=!1,r=e.target?e.target:e.srcElement;(n=this.findClosestTouchEntity(t[o],r))&&(n.trigger("TouchStart",t[o]),i=this.fingerDownIndexByEntity(n));var a=this.setTouch(t[o],n);!1!==i&&i>=0?this.fingers[i]=a:this.fingers.push(a)}},handleMove:function(e){for(var t=e.changedTouches,o=0,s=t.length;o<s;o++){var n=this.fingerDownIndexById(t[o].identifier),i=e.target?e.target:e.srcElement,r=this.findClosestTouchEntity(t[o],i);if(n>=0){var a=this.fingers[n];void 0!==a.entity&&(a.entity===r?a.entity.trigger("TouchMove",t[o]):("object"==typeof r&&r.trigger("TouchStart",t[o]),a.entity.trigger("TouchEnd"))),a.entity=r,a.realX=t[o].realX,a.realY=t[o].realY}}},handleEnd:function(e){for(var t=e.changedTouches,o="touchcancel"===e.type?"TouchCancel":"TouchEnd",s=0,n=t.length;s<n;s++){var i=this.fingerDownIndexById(t[s].identifier);i>=0&&(this.fingers[i].entity&&this.fingers[i].entity.trigger(o),this.fingers.splice(i,1))}},setTouch:function(e,t){return{identifier:e.identifier,realX:e.realX,realY:e.realY,entity:t}},findClosestTouchEntity:function(t,o){return e.findPointerEventTargetByComponent("Touch",t,o)},fingerDownIndexById:function(e){for(var t=0,o=this.fingers.length;t<o;t++){if(this.fingers[t].identifier===e)return t}return-1},fingerDownIndexByEntity:function(e){for(var t=0,o=this.fingers.length;t<o;t++){if(this.fingers[t].entity===e)return t}return-1},mimicMouse:function(o){var s,n,i=e.lastEvent;"touchstart"===o.type?s="mousedown":"touchmove"===o.type?s="mousemove":"touchend"===o.type?s="mouseup":"touchcancel"===o.type?s="mouseup":"touchleave"===o.type&&(s="mouseup"),o.touches&&o.touches.length?n=o.touches[0]:o.changedTouches&&o.changedTouches.length&&(n=o.changedTouches[0]);var r=t.createEvent("MouseEvent");r.initMouseEvent(s,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,o.relatedTarget),n.target.dispatchEvent(r),null!==i&&"mousedown"===i.type&&"mouseup"===s&&(s="click",(r=t.createEvent("MouseEvent")).initMouseEvent(s,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,o.relatedTarget),n.target.dispatchEvent(r))}},findPointerEventTargetByComponent:function(t,o,s){var n,i,r,a,u,h,c,l=s||e.stage.elem,d=-1/0,g=o.clientX,m=o.clientY;if("CANVAS"!==l.nodeName){for(;"string"!=typeof l.id&&-1===l.id.indexOf("ent");)l=l.parentNode;var v=e(parseInt(l.id.replace("ent",""),10));h=e.domHelper.translate(g,m,v._drawLayer),v.__c[t]&&v.isAt(h.x,h.y)&&(n=v,c=h)}if(!n)for(var p in e._drawLayers){var y=e._drawLayers[p];if(!(y._pointerEntities<=0))for(h=e.domHelper.translate(g,m,y),u=0,a=(r=e.map.search({_x:h.x,_y:h.y,_w:1,_h:1},!1)).length;u<a;++u)(i=r[u])._visible&&i._drawLayer===y&&i._globalZ>d&&i.__c[t]&&i.isAt(h.x,h.y)&&(d=i._globalZ,n=i,c=h)}return c||(c=e.domHelper.translate(g,m)),o.realX=c.x,o.realY=c.y,n},mouseWheelDispatch:function(t){t.direction=t.detail<0||t.wheelDelta>0?1:-1,e.trigger("MouseWheelScroll",t)},keyboardDispatch:function(t){for(var o=t,s={},n="char charCode keyCode type shiftKey ctrlKey metaKey timestamp".split(" "),i=n.length;i;){var r=n[--i];s[r]=o[r]}if(s.which=null!==o.charCode?o.charCode:o.keyCode,s.key=o.keyCode||o.which,s.originalEvent=o,"keydown"===(t=s).type?!0!==e.keydown[t.key]&&(e.keydown[t.key]=!0,e.trigger("KeyDown",t)):"keyup"===t.type&&(delete e.keydown[t.key],e.trigger("KeyUp",t)),e.selected&&!(8===t.key||t.key>=112&&t.key<=135))return o.stopPropagation?o.stopPropagation():o.cancelBubble=!0,o.target&&"INPUT"!==o.target.nodeName&&"TEXTAREA"!==o.target.nodeName&&(o.preventDefault?o.preventDefault():o.returnValue=!1),!1}}),e._preBind("Load",function(){e.addEvent(this,"keydown",e.keyboardDispatch),e.addEvent(this,"keyup",e.keyboardDispatch),e.addEvent(this,e.stage.elem,"mousedown",e.mouseDispatch),e.addEvent(this,e.stage.elem,"mouseup",e.mouseDispatch),e.addEvent(this,t.body,"mouseup",e.detectBlur),e.addEvent(this,window,"blur",e.resetKeyDown),e.addEvent(this,e.stage.elem,"mousemove",e.mouseDispatch),e.addEvent(this,e.stage.elem,"click",e.mouseDispatch),e.addEvent(this,e.stage.elem,"dblclick",e.mouseDispatch),e.addEvent(this,e.stage.elem,"touchstart",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchmove",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchend",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchcancel",e.touchDispatch),e.addEvent(this,e.stage.elem,"touchleave",e.touchDispatch),"Moz"===e.support.prefix?e.addEvent(this,e.stage.elem,"DOMMouseScroll",e.mouseWheelDispatch):e.addEvent(this,e.stage.elem,"mousewheel",e.mouseWheelDispatch)}),e._preBind("CraftyStop",function(){e.removeEvent(this,"keydown",e.keyboardDispatch),e.removeEvent(this,"keyup",e.keyboardDispatch),e.stage&&(e.removeEvent(this,e.stage.elem,"mousedown",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"mouseup",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"mousemove",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"click",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"dblclick",e.mouseDispatch),e.removeEvent(this,e.stage.elem,"touchstart",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchmove",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchend",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchcancel",e.touchDispatch),e.removeEvent(this,e.stage.elem,"touchleave",e.touchDispatch),"Moz"===e.support.prefix?e.removeEvent(this,e.stage.elem,"DOMMouseScroll",e.mouseWheelDispatch):e.removeEvent(this,e.stage.elem,"mousewheel",e.mouseWheelDispatch)),e.removeEvent(this,t.body,"mouseup",e.detectBlur),e.removeEvent(this,window,"blur",e.resetKeyDown)}),e.c("Mouse",{init:function(){e.mouseObjs++,this.requires("AreaMap").bind("Remove",function(){e.mouseObjs--})}}),e.c("Touch",{init:function(){e.touchObjs++,this.requires("AreaMap").bind("Remove",function(){e.touchObjs--})}}),e.c("AreaMap",{init:function(){this.has("Renderable")&&this._drawLayer&&this._drawLayer._pointerEntities++},remove:function(){this.has("Renderable")&&this._drawLayer&&this._drawLayer._pointerEntities--},events:{LayerAttached:function(e){e._pointerEntities++},LayerDetached:function(e){e._pointerEntities--}},areaMap:function(t){if(arguments.length>1){var o=Array.prototype.slice.call(arguments,0);t=new e.polygon(o)}else t=t.constructor===Array?new e.polygon(t.slice()):t.clone();return t.shift(this._x,this._y),this.mapArea=t,this.attach(this.mapArea),this.trigger("NewAreaMap",t),this}}),e.c("Button",{init:function(){var t=!e.mobile||e.mobile&&!e.multitouch()?"Mouse":"Touch";this.requires(t)}}),e.c("MouseDrag",{_dragging:!1,init:function(){this.requires("Mouse"),this.bind("MouseDown",this._ondown)},remove:function(){this.unbind("MouseDown",this._ondown)},_ondown:function(t){t.mouseButton===e.mouseButtons.LEFT&&this.startDrag(t)},_ondrag:function(e){if(!this._dragging||0===e.realX||0===e.realY)return!1;this.trigger("Dragging",e)},_onup:function(t){t.mouseButton===e.mouseButtons.LEFT&&this.stopDrag(t)},startDrag:function(t){if(!this._dragging)return this._dragging=!0,e.addEvent(this,e.stage.elem,"mousemove",this._ondrag),e.addEvent(this,e.stage.elem,"mouseup",this._onup),this.trigger("StartDrag",t||e.lastEvent),this},stopDrag:function(t){if(this._dragging)return this._dragging=!1,e.removeEvent(this,e.stage.elem,"mousemove",this._ondrag),e.removeEvent(this,e.stage.elem,"mouseup",this._onup),this.trigger("StopDrag",t||e.lastEvent),this}}),e.c("Keyboard",{isDown:function(t){return"string"==typeof t&&(t=e.keys[t]),!!e.keydown[t]}});
},{"../core/core.js":22}],61:[function(require,module,exports) {
function i(i){e.mouseObjs++,this.button=i}function t(i){this.key=i}function n(i){this.inputs=i}var e=require("../core/core.js");i.prototype={isDown:function(){return e.mouseButtonsDown[this.button]},destroy:function(){e.mouseObjs--}},t.prototype={isDown:function(){return e.keydown[this.key]}},n.prototype={timeDown:null,isActive:function(){for(var i in this.inputs){if(this.inputs[i].isDown())return this.timeDown||(this.timeDown=Date.now()),!0}return delete this.timeDown,!1},destroy:function(){for(var i in this.inputs)"function"==typeof this.inputs[i].destroy&&this.inputs[i].destroy()}},e.s("Controls",{init:function(){this._dpads={},this._triggers={}},events:{EnterFrameInput:function(){this.runEvents()},KeyDown:function(){this.updateTriggers()},KeyUp:function(){this.updateTriggers()},MouseDown:function(i){this.updateTriggers()},MouseUp:function(i){this.updateTriggers()}},updateTriggers:function(i){for(var t in this._triggers){var n=this._triggers[t];this.updateTriggerInput(n)}},runEvents:function(){for(var i in this._dpads){var t=this._dpads[i];t.oldX=t.x,t.oldY=t.y,this.updateDpadInput(t,t.multipleDirectionBehavior),this.updateActiveDirection(t,t.normalize),t.event.x=t.x,t.event.y=t.y,t.x===t.oldX&&t.y===t.oldY||e.trigger("DirectionalInput",t.event)}},getDpad:function(i){return this._dpads[i]},isTriggerDown:function(i){return this._triggers[i].active},defineTriggerGroup:function(e,r){var o;if(Array.isArray(r))o=r;else{if(o=[],r.mouseButtons)for(var s in r.mouseButtons)o.push(new i(r.mouseButtons[s]));if(r.keys)for(var u in r.keys)o.push(new t(r.keys[u]))}this._triggers[e]&&this._triggers[e].input.destroy(),this._triggers[e]={name:e,input:new n(o),downFor:0,active:!1}},defineDpad:function(i,r,o){var s={};for(var u in r){var a=r[u],p=e.keys[u]||u;s[a]||(s[a]=[]),s[a].push(new t(p))}var d={};for(var c in s)d[c]={input:new n(s[c]),active:!1,n:this.parseDirection(c)};if(void 0===o&&(o={}),void 0===o.normalize&&(o.normalize=!1),void 0===o.multipleDirectionBehavior&&(o.multipleDirectionBehavior="all"),this._dpads[i]){for(c in this._dpads[i].parsedDefinition)this._dpads[i].parsedDefinition[c].input.destroy();delete this._dpads[i]}this._dpads[i]={name:i,directions:d,x:0,y:0,oldX:0,oldY:0,event:{x:0,y:0,name:i},normalize:o.normalize,multipleDirectionBehavior:o.multipleDirectionBehavior}},parseDirection:function(i){return{x:Math.round(1e3*Math.cos(i*(Math.PI/180)))/1e3,y:Math.round(1e3*Math.sin(i*(Math.PI/180)))/1e3}},updateActiveDirection:function(i,t){i.x=0,i.y=0;for(var n in i.directions){var e=i.directions[n];e.active&&(i.x+=e.n.x,i.y+=e.n.y)}if(t){var r=Math.sqrt(i.x*i.x+i.y*i.y);r>0&&(i.x=i.x/r,i.y=i.y/r)}},updateTriggerInput:function(i){i.active?i.input.isActive()||(i.active=!1,e.trigger("TriggerInputUp",i),i.downFor=0):i.input.isActive()&&(i.downFor=Date.now()-i.input.timeDown,i.active=!0,e.trigger("TriggerInputDown",i))},updateDpadInput:function(i,t){var n,e,r;for(n in i.directions)(e=i.directions[n]).active=!1,e.input.isActive()&&("all"===t?e.active=!0:r?("first"===t&&r.input.timeDown>e.input.timeDown&&(r=e),"last"===t&&r.input.timeDown<e.input.timeDown&&(r=e)):r=e);r&&(r.active=!0)}});
},{"../core/core.js":22}],62:[function(require,module,exports) {
var i=require("../core/core.js");i.c("Draggable",{_origX:null,_origY:null,_oldX:null,_oldY:null,_dir:null,init:function(){this.requires("MouseDrag"),this.bind("StartDrag",this._startDrag).bind("Dragging",this._drag)},remove:function(){this.unbind("StartDrag",this._startDrag).unbind("Dragging",this._drag)},enableDrag:function(){return this.uniqueBind("Dragging",this._drag),this},disableDrag:function(){return this.unbind("Dragging",this._drag),this},dragDirection:function(i){if(void 0===i)this._dir=null;else if(+i===i)this._dir={x:Math.cos(i/180*Math.PI),y:Math.sin(i/180*Math.PI)};else if(0===i.x&&0===i.y)this._dir={x:0,y:0};else{var t=Math.sqrt(i.x*i.x+i.y*i.y);this._dir={x:i.x/t,y:i.y/t}}return this},_startDrag:function(i){this._origX=i.realX,this._origY=i.realY,this._oldX=this._x,this._oldY=this._y},_drag:function(i){if(this._dir){if(0!==this._dir.x||0!==this._dir.y){var t=(i.realX-this._origX)*this._dir.x+(i.realY-this._origY)*this._dir.y;this.x=this._oldX+t*this._dir.x,this.y=this._oldY+t*this._dir.y}}else this.x=this._oldX+(i.realX-this._origX),this.y=this._oldY+(i.realY-this._origY)}}),i.c("Controllable",{init:function(){this._inputBindings={DirectionalInput:{},TriggerInputDown:{},TriggerInputUp:{}}},events:{DirectionalInput:function(i){this._inputBindings.DirectionalInput[i.name]&&this._inputBindings.DirectionalInput[i.name].call(this,i)},TriggerInputDown:function(i){this._inputBindings.TriggerInputDown[i.name]&&this._inputBindings.TriggerInputDown[i.name].call(this,i)},TriggerInputUp:function(i){this._inputBindings.TriggerInputUp[i.name]&&this._inputBindings.TriggerInputUp[i.name].call(this,i)}},linkInput:function(i,t,n){this._inputBindings[i][t]=n},unlinkInput:function(i,t){delete this._inputBindings[i][t]},disableControls:!1,enableControl:function(){return this.disableControls=!1,this},disableControl:function(){return this.disableControls=!0,this}}),i.c("Multiway",{_speed:null,init:function(){this.requires("Motion, Controllable"),this._dpadName="MultiwayDpad"+this[0],this._speed={x:150,y:150},this._direction={x:0,y:0}},remove:function(){this.disableControls||(this.vx=this.vy=0)},events:{EnterFrame:function(){this.disableControls||(void 0!==this._speed.x&&null!==this._speed.x&&(this.vx=this._speed.x*this._direction.x),void 0!==this._speed.y&&null!==this._speed.y&&(this.vy=this._speed.y*this._direction.y))}},_updateDirection:function(i){this._direction.x=i.x,this._direction.y=i.y},multiway:function(t,n,s){var e=i.s("Controls");return n?this.speed(t):n=t,e.defineDpad(this._dpadName,n,s),this.linkInput("DirectionalInput",this._dpadName,this._updateDirection),this},speed:function(i){return"object"==typeof i?(this._speed.x=i.x,this._speed.y=i.y):(this._speed.x=i,this._speed.y=i),this}}),i.c("Jumper",{_jumpSpeed:300,canJump:!0,init:function(){this.requires("Supportable, Motion, Controllable")},remove:function(){this.unlinkInput("TriggerInputDown",this._jumpTriggerName)},_keydown_jumper:function(i){this.disableControls||this.jump()},jump:function(){var i=this.ground;return this.canJump=!!i,this.trigger("CheckJumping",i),this.canJump&&(this.vy=-this._jumpSpeed),this},jumper:function(t,n){if(n?this._jumpSpeed=t:n=t,this._jumpTriggerName="JumpTrigger"+this[0],Array.isArray(n)){for(var s=[],e=0;e<n.length;++e){var r=n[e],u=i.keys[r]||r;s.push(u)}i.s("Controls").defineTriggerGroup(this._jumpTriggerName,{keys:s})}else i.s("Controls").defineTriggerGroup(this._jumpTriggerName,n);return this.linkInput("TriggerInputDown",this._jumpTriggerName,this._keydown_jumper),this},jumpSpeed:function(i){return this._jumpSpeed=i,this}}),i.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(i){return this.multiway(i||this._speed,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180}),this}}),i.c("Twoway",{init:function(){this.requires("Multiway, Jumper")},twoway:function(t,n){var s=t||this._speed;return this.multiway({x:s},{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180}),this.jumper(n||2*t||this._jumpSpeed,[i.keys.UP_ARROW,i.keys.W,i.keys.Z]),this}});
},{"../core/core.js":22}],63:[function(require,module,exports) {
var i=require("../core/core.js");i.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(e){var t;window.DeviceOrientationEvent?t={tiltLR:e.gamma,tiltFB:e.beta,dir:e.alpha,motUD:null}:window.OrientationEvent&&(t={tiltLR:90*e.x,tiltFB:-90*e.y,dir:null,motUD:e.z}),i.device._deviceOrientationCallback(t)},_normalizeDeviceMotion:function(e){var t=e.accelerationIncludingGravity,n=t.z>0?1:-1,o={acceleration:t,rawAcceleration:"["+Math.round(t.x)+", "+Math.round(t.y)+", "+Math.round(t.z)+"]",facingUp:n,tiltLR:Math.round(t.x/9.81*-90),tiltFB:Math.round((t.y+9.81)/9.81*90*n)};i.device._deviceMotionCallback(o)},deviceOrientation:function(e){this._deviceOrientationCallback=e,i.support.deviceorientation&&(window.DeviceOrientationEvent?i.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation):window.OrientationEvent&&i.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(e){this._deviceMotionCallback=e,i.support.devicemotion&&window.DeviceMotionEvent&&i.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}});
},{"../core/core.js":22}],64:[function(require,module,exports) {
var A=require("../core/core.js");A.extend({keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}});
},{"../core/core.js":22}],65:[function(require,module,exports) {
var e=require("../core/core.js"),s=window.document;e.extend({audio:{sounds:{},supported:null,codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,playCheck:null,_canPlay:function(){if(this.supported={},e.support.audio){var s,t=this.audioElement();for(var i in this.codecs)s=t.canPlayType(this.codecs[i]),this.supported[i]=""!==s&&"no"!==s}},supports:function(e){return null===this.supported&&this._canPlay(),!!this.supported[e]},audioElement:function(){return"undefined"!=typeof Audio?new Audio(""):s.createElement("audio")},create:function(s,t){var i=t.substr(t.lastIndexOf(".")+1).toLowerCase();if(!this.supports(i))return!1;var n=this.audioElement();return n.id=s,n.preload="auto",n.volume=e.audio.volume,n.src=t,e.asset(t,n),this.sounds[s]={obj:n,played:0,volume:e.audio.volume},this.sounds[s]},add:function(s,t){if(e.support.audio){var i,n;if(1===arguments.length&&"object"==typeof s)for(var o in s)for(i in s[o])if(n=e.audio.create(o,s[o][i]))break;if("string"==typeof s&&("string"==typeof t&&(n=e.audio.create(s,t)),"object"==typeof t))for(i in t)if(n=e.audio.create(s,t[i]))break;return n}},play:function(s,t,i){if(0!==t&&e.support.audio&&this.sounds[s]){var n=this.sounds[s],o=this.getOpenChannel();if(!o)return null;o.id=s,o.repeat=t;var u=o.obj;return o.volume=n.volume=n.obj.volume=i||e.audio.volume,u.volume=n.volume,u.src=n.obj.src,this.muted&&(u.volume=0),u.play(),n.played++,o.onEnd=function(){n.played<o.repeat||-1===o.repeat?(this.currentTime&&(this.currentTime=0),this.play(),n.played++):(o.active=!1,this.pause(),this.removeEventListener("ended",o.onEnd,!0),this.currentTime=0,e.trigger("SoundComplete",{id:o.id}))},u.addEventListener("ended",o.onEnd,!0),u}},maxChannels:7,setChannels:function(e){this.maxChannels=e,e<this.channels.length&&(this.channels.length=e)},channels:[],getOpenChannel:function(){for(var e=0;e<this.channels.length;e++){var s=this.channels[e];if(!1===s.active||s.obj.ended&&s.repeat<=this.sounds[s.id].played)return s.active=!0,s}if(e<this.maxChannels){var t={obj:this.audioElement(),active:!0,_is:function(e){return this.id===e&&this.active}};return this.channels.push(t),t}return null},remove:function(s){if(e.support.audio){var t,i,n=e.paths().audio;if(s)this.sounds[s]&&(i=(t=this.sounds[s]).obj.src.split("/").pop(),e.audio.stop(s),delete e.assets[n+i],delete e.assets[t.obj.src],delete e.audio.sounds[s]);else for(var o in this.sounds)i=(t=this.sounds[o]).obj.src.split("/").pop(),e.audio.stop(s),delete e.assets[n+i],delete e.assets[t.obj.src],delete e.audio.sounds[s]}},stop:function(s){if(e.support.audio){var t;for(var i in this.channels)t=this.channels[i],(!s&&t.active||t._is(s))&&(t.active=!1,t.obj.pause())}},_mute:function(s){if(e.support.audio){var t;for(var i in this.channels)(t=this.channels[i]).obj.volume=s?0:t.volume;this.muted=s}},toggleMute:function(){this.muted?this._mute(!1):this._mute(!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(s){if(e.support.audio&&s&&this.sounds[s]){var t;for(var i in this.channels)(t=this.channels[i])._is(s)&&!t.obj.paused&&t.obj.pause()}},unpause:function(s){if(e.support.audio&&s&&this.sounds[s]){var t;for(var i in this.channels)(t=this.channels[i])._is(s)&&t.obj.paused&&t.obj.play()}},togglePause:function(s){if(e.support.audio&&s&&this.sounds[s]){var t;for(var i in this.channels)(t=this.channels[i])._is(s)&&(t.obj.paused?t.obj.play():t.obj.pause())}},isPlaying:function(s){if(!e.support.audio)return!1;for(var t in this.channels)if(this.channels[t]._is(s))return!0;return!1}}});
},{"../core/core.js":22}],66:[function(require,module,exports) {
var e=require("../core/core.js"),t=window.document;e.c("DebugCanvas",{init:function(){this.requires("2D"),e.DebugCanvas.context||e.DebugCanvas.init(),e.DebugCanvas.add(this),this._debug={alpha:1,lineWidth:1},this.bind("RemoveComponent",this.onDebugRemove),this.bind("Remove",this.onDebugDestroy)},onDebugRemove:function(t){"DebugCanvas"===t&&e.DebugCanvas.remove(this)},onDebugDestroy:function(t){e.DebugCanvas.remove(this)},debugAlpha:function(e){return this._debug.alpha=e,this},debugFill:function(e){return void 0===e&&(e="red"),this._debug.fillStyle=e,this},debugStroke:function(e){return void 0===e&&(e="red"),this._debug.strokeStyle=e,this},debugDraw:function(e){var t=e.globalAlpha,i=this._debug;i.alpha&&(e.globalAlpha=this._debug.alpha),i.strokeStyle&&(e.strokeStyle=i.strokeStyle),i.lineWidth&&(e.lineWidth=i.lineWidth),i.fillStyle&&(e.fillStyle=i.fillStyle),this.trigger("DebugDraw",e),e.globalAlpha=t}}),e.c("DebugRectangle",{init:function(){this.requires("2D, DebugCanvas")},debugRectangle:function(e){return this.debugRect=e,this.unbind("DebugDraw",this.drawDebugRect),this.bind("DebugDraw",this.drawDebugRect),this},drawDebugRect:function(e){var t=this.debugRect;null!==t&&void 0!==t&&t._h&&t._w&&(this._debug.fillStyle&&e.fillRect(t._x,t._y,t._w,t._h),this._debug.strokeStyle&&e.strokeRect(t._x,t._y,t._w,t._h))}}),e.c("VisibleMBR",{init:function(){this.requires("DebugRectangle").debugFill("purple").bind("EnterFrame",this._assignRect)},_assignRect:function(){this._mbr?this.debugRectangle(this._mbr):this.debugRectangle(this)}}),e.c("DebugPolygon",{init:function(){this.requires("2D, DebugCanvas")},debugPolygon:function(e){return this.polygon=e,this.unbind("DebugDraw",this.drawDebugPolygon),this.bind("DebugDraw",this.drawDebugPolygon),this},drawDebugPolygon:function(e){if(void 0!==this.polygon){e.beginPath();for(var t=this.polygon.points,i=t.length,n=0;n<i;n+=2)e.lineTo(t[n],t[n+1]);e.closePath(),this._debug.fillStyle&&e.fill(),this._debug.strokeStyle&&e.stroke()}}}),e.c("WiredHitBox",{init:function(){this.requires("DebugPolygon").debugStroke("red").matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),e.c("SolidHitBox",{init:function(){this.requires("Collision, DebugPolygon").debugFill("orange").debugAlpha(.7).matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),e.c("WiredAreaMap",{init:function(){this.requires("DebugPolygon").debugStroke("green").matchAreaMap(),this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}}),e.c("SolidAreaMap",{init:function(){this.requires("DebugPolygon").debugFill("lime").debugAlpha(.7).matchAreaMap(),this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}}),e.DebugCanvas={context:null,entities:[],onetimeEntities:[],add:function(e){this.entities.push(e)},remove:function(e){for(var t=this.entities,i=t.length-1;i>=0;i--)t[i]===e&&t.splice(i,1)},init:function(){if(!e.DebugCanvas.context){if(!e.support.canvas)return e.trigger("NoCanvas"),void e.stop();var i;(i=t.createElement("canvas")).width=e.viewport.width,i.height=e.viewport.height,i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.id="debug-canvas",i.style.zIndex=1e5,e.stage.elem.appendChild(i),e.DebugCanvas.context=i.getContext("2d"),e.DebugCanvas._canvas=i}e.unbind("RenderScene",e.DebugCanvas.renderScene),e.bind("RenderScene",e.DebugCanvas.renderScene)},renderScene:function(t){t=t||e.viewport.rect();var i,n=e.DebugCanvas.entities,a=0,s=n.length,o=e.DebugCanvas.context,r=e.viewport;o.setTransform(r._scale,0,0,r._scale,Math.round(r._x*r._scale),Math.round(r._y*r._scale)),o.clearRect(t._x,t._y,t._w,t._h);for(var u=null;a<s;a++)u!==(i=n[a])._drawlayer&&(r=i._drawLayer._viewportRect(),o.setTransform(r._scale,0,0,r._scale,Math.round(-r._x*r._scale),Math.round(-r._y*r._scale)),u=i._drawLayer),i.debugDraw(o)}};
},{"../core/core.js":22}],67:[function(require,module,exports) {
var o=require("../core/core.js");o.extend({loggingEnabled:!0,log:function(){o.loggingEnabled&&("undefined"!=typeof window?window.console:console)&&console.log},error:function(){o.loggingEnabled&&("undefined"!=typeof window?window.console:console)&&console.error}});
},{"../core/core.js":22}],20:[function(require,module,exports) {
var e=require("./core/core");e.easing=require("./core/animation"),e.extend(require("./core/extensions")),e.extend(require("./core/loader")),e.c("Model",require("./core/model")),e.extend(require("./core/scenes")),e.storage=require("./core/storage"),e.c("Delay",require("./core/time")),e.c("Tween",require("./core/tween")),require("./core/systems"),require("./spatial/2d"),require("./spatial/motion"),require("./spatial/platform"),require("./spatial/collision"),require("./spatial/spatial-grid"),require("./spatial/rect-manager"),require("./spatial/math"),require("./graphics/layers"),require("./graphics/canvas"),require("./graphics/canvas-layer"),require("./graphics/webgl"),require("./graphics/webgl-layer"),require("./graphics/color"),require("./graphics/dom"),require("./graphics/dom-helper"),require("./graphics/dom-layer"),require("./graphics/drawing"),require("./graphics/gl-textures"),require("./graphics/renderable"),require("./graphics/html"),require("./graphics/image"),require("./graphics/particles"),require("./graphics/sprite-animation"),require("./graphics/sprite"),require("./graphics/text"),require("./graphics/viewport"),require("./isometric/diamond-iso"),require("./isometric/isometric"),require("./controls/inputs"),require("./controls/controls-system"),require("./controls/controls"),require("./controls/device"),require("./controls/keycodes"),require("./sound/sound"),require("./debug/debug-layer"),require("./debug/logging"),require("./aliases").defineAliases(e),window&&(window.Crafty=e),module.exports=e;
},{"./aliases":21,"./core/core":22,"./core/animation":23,"./core/extensions":24,"./core/loader":25,"./core/model":26,"./core/scenes":27,"./core/storage":28,"./core/time":29,"./core/tween":30,"./core/systems":31,"./spatial/2d":32,"./spatial/motion":33,"./spatial/platform":34,"./spatial/collision":35,"./spatial/spatial-grid":36,"./spatial/rect-manager":37,"./spatial/math":38,"./graphics/layers":39,"./graphics/canvas":40,"./graphics/canvas-layer":41,"./graphics/webgl":42,"./graphics/webgl-layer":43,"./graphics/color":44,"./graphics/dom":45,"./graphics/dom-layer":46,"./graphics/dom-helper":47,"./graphics/drawing":48,"./graphics/renderable":49,"./graphics/html":50,"./graphics/gl-textures":51,"./graphics/image":52,"./graphics/particles":53,"./graphics/sprite-animation":54,"./graphics/sprite":55,"./graphics/text":56,"./isometric/diamond-iso":57,"./graphics/viewport":58,"./isometric/isometric":59,"./controls/inputs":60,"./controls/controls-system":61,"./controls/controls":62,"./controls/device":63,"./controls/keycodes":64,"./sound/sound":65,"./debug/debug-layer":66,"./debug/logging":67}],2:[function(require,module,exports) {
"use strict";function e(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&(r[u]=e[u]);return r.default=e,r}function r(e){return e&&e.__esModule?e:{default:e}}var u=require("craftyjs"),i=r(u);require("./bounded-object"),require("./paddles"),require("./ball"),require("./cpu-paddle"),require("./main-menu"),require("./main-game"),require("./winner");var t=require("./utilities"),a=require("./setup"),n=e(a),l=require("./score"),d=require("./assets");i.default.init(n.width,n.height,n.gameEl),i.default.timer.FPS(60),i.default.background("#001f3f"),(0,d.startGame)();
},{"./bounded-object":4,"./paddles":5,"./ball":6,"./main-menu":7,"./cpu-paddle":8,"./main-game":9,"./winner":10,"./setup":11,"./utilities":12,"./assets":13,"./score":14,"craftyjs":20}]},{},[2])