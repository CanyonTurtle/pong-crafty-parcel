{"dependencies":[{"name":"../core/core.js","loc":{"line":1,"column":21}}],"generated":{"js":"var Crafty = require('../core/core.js');\n\nmodule.exports = {\n    /**@\n     * #Crafty.assets\n     * @category Assets\n     * @kind Property\n     * \n     * An object containing every asset used in the current Crafty game.\n     * The key is the URL and the value is the `Audio` or `Image` object.\n     *\n     * If loading an asset, check that it is in this object first to avoid loading twice.\n     *\n     * @example\n     * ~~~\n     * var isLoaded = !!Crafty.assets[\"images/sprite.png\"];\n     * ~~~\n     * @see Crafty.load\n     */\n    assets: {},\n    __paths: { audio: \"\", images: \"\" },\n    /**@\n     * #Crafty.paths\n     * @category Assets\n     * @kind Method\n     * \n     * @sign public void Crafty.paths([Object paths])\n     * @param paths - Object containing paths for audio and images folders\n     *\n     * Function to define custom folder for audio and images. You should use\n     * this function to avoid typing the same paths again and again when\n     * loading assets with the Crafty.load() function.\n     *\n     * If you do not give a object you get the current paths for both audio\n     * and images back.\n     *\n     * You do not have to define paths.\n     *\n     * @example\n     *\n     *\n     * Setting folders:\n     * ~~~\n     * Crafty.paths({ audio: \"custom/audio/path/\", images: \"custom/images/path/\" });\n     *\n     * Crafty.load({\n     *   \"audio\": {\n     *     \"ray\": ['ray.mp3'] // This loads ray.mp3 from custom/audio/path/ray.mp3\n     *   }\n     * }, function() {\n     *   Crafty.log('loaded');\n     * });\n     * ~~~\n     *\n     * @see Crafty.load\n     */\n    paths: function(p) {\n        if (typeof p === \"undefined\") {\n            return this.__paths;\n        } else {\n            if(p.audio)\n                this.__paths.audio = p.audio;\n            if(p.images)\n                this.__paths.images = p.images;\n        }\n    },\n\n    /**@\n     * #Crafty.asset\n     * @category Assets\n     * @kind Method\n     * \n     * @trigger NewAsset - After setting new asset - Object - key and value of new added asset.\n     * @sign public void Crafty.asset(String key, Object asset)\n     * @param key - asset url.\n     * @param asset - `Audio` or `Image` object.\n     *\n     * Add new asset to assets object.\n     *\n     * @sign public void Crafty.asset(String key)\n     * @param key - asset url.\n     *\n     *\n     * Get asset from assets object.\n     *\n     * @example\n     * ~~~\n     * Crafty.asset(key, value);\n     * var asset = Crafty.asset(key); //object with key and value fields\n     * ~~~\n     *\n     * @see Crafty.assets\n     */\n    asset: function (key, value) {\n        if (arguments.length === 1) {\n            return Crafty.assets[key];\n        }\n\n        if (!Crafty.assets[key]) {\n            Crafty.assets[key] = value;\n            this.trigger(\"NewAsset\", {\n                key: key,\n                value: value\n            });\n            return value;\n        }\n    },\n    /**@\n     * #Crafty.imageWhitelist\n     * @category Assets\n     * @kind Method\n     *\n     * A list of file extensions that can be loaded as images by Crafty.load\n     *\n     * @example\n     * ~~~\n     * // add tif extension to list of supported image files\n     * Crafty.imageWhitelist.push(\"tif\");\n     *\n     * var assets = {\n     *     \"sprites\": {\n     *         \"sprite.tif\": {   //set a tif sprite\n     *            \"tile\": 64,\n     *            \"tileh\": 32,\n     *            \"map\": { \"sprite_car\": [0, 0] }\n     *         }\n     *     },\n     *     \"audio\": {\n     *         \"jump\": \"jump.mp3\";\n     *     }\n     * };\n     *\n     * Crafty.load( assets, // preload the assets\n     *     function() {     //when loaded\n     *         Crafty.audio.play(\"jump\"); //Play the audio file\n     *         Crafty.e('2D, DOM, sprite_car'); // create entity with sprite\n     *     },\n     *\n     *     function(e) { //progress\n     *     },\n     *\n     *     function(e) { //uh oh, error loading\n     *     }\n     * );\n     * ~~~\n     *\n     * @see Crafty.asset\n     * @see Crafty.load\n     */\n    imageWhitelist: [\"jpg\", \"jpeg\", \"gif\", \"png\", \"svg\"],\n    /**@\n     * #Crafty.load\n     * @category Assets\n     * @kind Method\n     * \n     * @sign public void Crafty.load(Object assets, Function onLoad[, Function onProgress[, Function onError]])\n     * @param assets - Object JSON formatted (or JSON string), with assets to load (accepts sounds, images and sprites)\n     * @param onLoad - Callback when the assets are loaded\n     * @param onProgress - Callback when an asset is loaded. Contains information about assets loaded\n     * @param onError - Callback when an asset fails to load\n     *\n     * Preloader for all assets. Takes a JSON formatted object (or JSON string) of files and adds them to the\n     * `Crafty.assets` object, as well as setting sprites accordingly.\n     *\n     * Format must follow the pattern shown in the example below, but it's not required to pass all \"audio\",\n     * \"images\" and \"sprites\" properties, only those you'll need. For example, if you don't need to preload\n     * sprites, you can omit that property.\n     *\n     * By default, Crafty will assume all files are in the current path.  For changing these,\n     * use the function `Crafty.paths`.\n     *\n     * Files with suffixes in `imageWhitelist` (case insensitive) will be loaded.\n     *\n     * It's possible to pass the full file path(including protocol), instead of just the filename.ext, in case\n     * you want some asset to be loaded from another domain.\n     *\n     * If `Crafty.support.audio` is `true`, files with the following suffixes `mp3`, `wav`, `ogg` and\n     * `mp4` (case insensitive) can be loaded.\n     *\n     * The `onProgress` function will be passed on object with information about\n     * the progress including how many assets loaded, total of all the assets to\n     * load and a percentage of the progress.\n     * ~~~\n     * { loaded: j, total: total, percent: (j / total * 100), src:src }\n     * ~~~\n     *\n     * `onError` will be passed with the asset that couldn't load.\n     *\n     * When `onError` is not provided, the onLoad is loaded even when some assets are not successfully loaded.\n     * Otherwise, onLoad will be called no matter whether there are errors or not.\n     *\n     * @example\n     * ~~~\n     * var assetsObj = {\n     *     \"audio\": {\n     *         \"beep\": [\"beep.wav\", \"beep.mp3\", \"beep.ogg\"],\n     *         \"boop\": \"boop.wav\",\n     *         \"slash\": \"slash.wav\"\n     *     },\n     *     \"images\": [\"badguy.bmp\", \"goodguy.png\"],\n     *     \"sprites\": {\n     *         \"animals.png\": {\n     *             \"tile\": 50,\n     *             \"tileh\": 40,\n     *             \"map\": { \"ladybug\": [0,0], \"lazycat\": [0,1], \"ferociousdog\": [0,2] }\n     *             \"paddingX\": 5,\n     *             \"paddingY\": 5,\n     *             \"paddingAroundBorder\": 10\n     *         },\n     *         \"vehicles.png\": {\n     *             \"tile\": 150,\n     *             \"tileh\": 75,\n     *             \"map\": { \"car\": [0,0], \"truck\": [0,1] }\n     *         }\n     *     },\n     * };\n     *\n     * Crafty.load(assetsObj, // preload assets\n     *     function() { //when loaded\n     *         Crafty.scene(\"main\"); //go to main scene\n     *         Crafty.audio.play(\"boop\"); //Play the audio file\n     *         Crafty.e('2D, DOM, lazycat'); // create entity with sprite\n     *     },\n     *\n     *     function(e) { //progress\n     *     },\n     *\n     *     function(e) { //uh oh, error loading\n     *     }\n     * );\n     * ~~~\n     *\n     * @see Crafty.paths\n     * @see Crafty.assets\n     * @see Crafty.imageWhitelist\n     * @see Crafty.removeAssets\n     */\n    load: function (data, oncomplete, onprogress, onerror) {\n\n        if (Array.isArray(data)) {\n            Crafty.log(\"Calling Crafty.load with an array of assets no longer works; see the docs for more details.\");\n            return;\n        }\n\n        data = (typeof data === \"string\" ? JSON.parse(data) : data);\n\n        var j = 0,\n            total = (data.audio ? Object.keys(data.audio).length : 0) +\n                (data.images ? Object.keys(data.images).length : 0) +\n                (data.sprites ? Object.keys(data.sprites).length : 0),\n            current, fileUrl, obj, type, asset,\n            paths = Crafty.paths(),\n            getExt = function(f) {\n                return f.substr(f.lastIndexOf('.') + 1).toLowerCase();\n            },\n            getFilePath = function(type,f) {\n                return (f.search(\"://\") === -1 ? (type === \"audio\" ? paths.audio + f : paths.images + f) : f);\n            },\n            // returns null if 'a' is not already a loaded asset, obj otherwise\n            isAsset = function(a) {\n                return Crafty.asset(a) || null;\n            },\n            isSupportedAudio = function(f) {\n                return Crafty.support.audio && Crafty.audio.supports(getExt(f));\n            },\n            isValidImage = function(f) {\n                return Crafty.imageWhitelist.indexOf(getExt(f)) !== -1;\n            },\n            onImgLoad = function(obj,url) {\n                obj.onload = pro;\n                if (Crafty.support.prefix === 'webkit')\n                    obj.src = \"\"; // workaround for webkit bug\n                obj.src = url;\n            };\n\n        //Progress function\n\n        function pro() {\n            var src = this.src;\n\n            //Remove events cause audio trigger this event more than once(depends on browser)\n            if (this.removeEventListener)\n                this.removeEventListener('canplaythrough', pro, false);\n\n            j++;\n            //if progress callback, give information of assets loaded, total and percent\n            if (onprogress)\n                onprogress({\n                    loaded: j,\n                    total: total,\n                    percent: (j / total * 100),\n                    src: src\n                });\n\n            if (j === total && oncomplete) oncomplete();\n        }\n        //Error function\n\n        function err() {\n            var src = this.src;\n            if (onerror)\n                onerror({\n                    loaded: j,\n                    total: total,\n                    percent: (j / total * 100),\n                    src: src\n                });\n\n            j++;\n            if (j === total && oncomplete) oncomplete();\n        }\n\n        for (type in data) {\n            for(asset in data[type]) {\n                if (!data[type].hasOwnProperty(asset))\n                    continue; // maintain compatibility to other frameworks while iterating array\n\n                current = data[type][asset];\n                obj = null;\n\n                if (type === \"audio\") {\n                    if (typeof current === \"object\") {\n                        var files = [];\n                        for (var i in current) {\n                            fileUrl = getFilePath(type, current[i]);\n                            if (!isAsset(fileUrl) && isSupportedAudio(current[i]) && !Crafty.audio.sounds[asset])\n                                files.push(fileUrl);\n                        }\n                        if (files.length > 0)\n                            obj = Crafty.audio.add(asset, files);\n                    } else if (typeof current === \"string\") {\n                        fileUrl = getFilePath(type, current);\n                        if (!isAsset(fileUrl) && isSupportedAudio(current) && !Crafty.audio.sounds[asset])\n                            obj = Crafty.audio.add(asset, fileUrl);\n                    }\n                    //extract actual audio obj if audio creation was successfull\n                    if (obj)\n                        obj = obj.obj;\n\n                    //addEventListener is supported on IE9 , Audio as well\n                    if (obj && obj.addEventListener)\n                        obj.addEventListener('canplaythrough', pro, false);\n                } else {\n                    asset = (type === \"sprites\" ? asset : current);\n                    fileUrl = getFilePath(type, asset);\n                    if (!isAsset(fileUrl) && isValidImage(asset)) {\n                        obj = new Image();\n                        if (type === \"sprites\")\n                            Crafty.sprite(current.tile, current.tileh, fileUrl, current.map,\n                              current.paddingX, current.paddingY, current.paddingAroundBorder);\n                        Crafty.asset(fileUrl, obj);\n                        onImgLoad(obj, fileUrl);\n                    }\n                }\n\n                if (obj) {\n                    obj.onerror = err;\n                } else {\n                    err.call({src: fileUrl});\n                }\n            }\n        }\n\n        // If we aren't trying to handle *any* of the files, that's as complete as it gets!\n        if (total === 0 && oncomplete) oncomplete();\n\n    },\n    /**@\n     * #Crafty.removeAssets\n     * @category Assets\n     * @kind Method\n     *\n     * @sign public void Crafty.removeAssets(Object assets)\n     * @param data - Object JSON formatted (or JSON string), with assets to remove (accepts sounds, images and sprites)\n     *\n     * Removes assets (audio, images, sprites - and related sprite components) in order to allow the browser\n     * to free memory.\n     *\n     * Recieves a JSON fomatted object (or JSON string) containing 'audio', 'images' and/or 'sprites'\n     * properties with assets to be deleted. Follows a similar format as Crafty.load 'data' argument. If\n     * you pass the exact same object passed to Crafty.load, that will delete everything loaded that way.\n     * For sprites, if you want to keep some specific component, just don't pass that component's name in\n     * the sprite 'map'.\n     *\n     * Note that in order to remove the sprite components related to a given sprite, it's required to\n     * pass the 'map' property of that sprite, and although its own properties's values (the properties refer\n     * to sprite components) are not used in the removing process, omitting them will cause an error (since\n     * 'map' is an object, thus it's properties can NOT omitted - however, they can be null, or undefined).\n     * It will work as long as the 'map' objects' properties have any value. Or if you define 'map' itself\n     * as an array, like:\n     * \"map\": [ \"car\", \"truck\" ] instead of \"map\": { \"car\": [0,0], \"truck\": [0,1] }.\n     * This is examplified below (\"animals.png\" VS. \"vehicles.png\" sprites).\n     *\n     * @example\n     * ~~~\n     * var assetsToRemoveObj = {\n     *     \"audio\": {\n     *         \"beep\": [\"beep.wav\", \"beep.mp3\", \"beep.ogg\"],\n     *         \"boop\": \"boop.wav\"\n     *     },\n     *     \"images\": [\"badguy.bmp\", \"goodguy.png\"],\n     *     \"sprites\": {\n     *         \"animals.png\": {\n     *             \"map\": { \"ladybug\": [0,0], \"lazycat\": [0,1] },\n     *         },\n     *         \"vehicles.png\": {\n     *             \"map\": [ \"car\", \"truck\" ]\n     *         }\n     *     }\n     * }\n     *\n     * Crafty.removeAssets(assetsToRemoveObj);\n     * ~~~\n     *\n     * @see Crafty.load\n     */\n    removeAssets: function(data) {\n\n        data = (typeof data === \"string\" ? JSON.parse(data) : data);\n\n        var current, fileUrl, type, asset,\n            paths = Crafty.paths(),\n            getFilePath = function(type,f) {\n                return (f.search(\"://\") === -1 ? (type === \"audio\" ? paths.audio + f : paths.images + f) : f);\n            };\n\n        for (type in data) {\n            for (asset in data[type]) {\n                if (!data[type].hasOwnProperty(asset))\n                    continue; // maintain compatibility to other frameworks while iterating array\n\n                current = data[type][asset];\n\n                if (type === \"audio\") {\n                    if (typeof current === \"object\") {\n                        for (var i in current) {\n                            fileUrl = getFilePath(type, current[i]);\n                            if (Crafty.asset(fileUrl))\n                                Crafty.audio.remove(asset);\n                        }\n                    }\n                    else if (typeof current === \"string\") {\n                        fileUrl = getFilePath(type, current);\n                        if (Crafty.asset(fileUrl))\n                            Crafty.audio.remove(asset);\n                    }\n                } else {\n                    asset = (type === \"sprites\" ? asset : current);\n                    fileUrl = getFilePath(type, asset);\n                    if (Crafty.asset(fileUrl)) {\n                        if (type === \"sprites\")\n                            for (var comp in current.map)\n                                delete Crafty.components()[comp];\n                        delete Crafty.assets[fileUrl];\n                    }\n                }\n            }\n        }\n    }\n};\n"},"hash":"ab63e6669e08c9bcce882e49ba0b741d"}