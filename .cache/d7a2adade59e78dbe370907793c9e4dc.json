{"dependencies":[{"name":"../core/core.js","loc":{"line":1,"column":21}}],"generated":{"js":"var Crafty = require('../core/core.js'),\n    document = window.document;\n\nCrafty.extend({\n    /**@\n     * #Crafty.audio\n     * @category Audio\n     * @kind CoreObject\n     *\n     * Add sound files and play them. Chooses best format for browser support.\n     * Due to the nature of HTML5 audio, three types of audio files will be\n     * required for cross-browser capabilities. These formats are MP3, Ogg and WAV.\n     * When sound was not muted on before pause, sound will be unmuted after unpause.\n     * When sound is muted Crafty.pause() does not have any effect on sound\n     *\n     * The maximum number of sounds that can be played simultaneously is defined by Crafty.audio.maxChannels.  The default value is 7.\n     */\n    audio: {\n\n        sounds: {},\n        supported: null,\n        codecs: { // Chart from jPlayer\n            ogg: 'audio/ogg; codecs=\"vorbis\"', //OGG\n            wav: 'audio/wav; codecs=\"1\"', // PCM\n            webma: 'audio/webm; codecs=\"vorbis\"', // WEBM\n            mp3: 'audio/mpeg; codecs=\"mp3\"', //MP3\n            m4a: 'audio/mp4; codecs=\"mp4a.40.2\"' // AAC / MP4\n        },\n        volume: 1, //Global Volume\n        muted: false,\n        paused: false,\n        playCheck: null,\n        /**\n         * Function to setup supported formats\n         **/\n        _canPlay: function () {\n            this.supported = {};\n            // Without support, no formats are supported\n            if (!Crafty.support.audio)\n                return;\n            var audio = this.audioElement(),\n                canplay;\n            for (var i in this.codecs) {\n                canplay = audio.canPlayType(this.codecs[i]);\n                if (canplay !== \"\" && canplay !== \"no\") {\n                    this.supported[i] = true;\n                } else {\n                    this.supported[i] = false;\n                }\n            }\n\n        },\n\n        /**@\n         * #Crafty.audio.supports\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.supports(String extension)\n         * @param extension - A file extension to check audio support for\n         *\n         * Return true if the browser thinks it can play the given file type, otherwise false\n         */\n        supports: function (extension) {\n            // Build cache of supported formats, if necessary\n            if (this.supported === null)\n                this._canPlay();\n\n            if (this.supported[extension])\n                return true;\n            else\n                return false;\n        },\n\n        /**\n         * Function to get an Audio Element\n         **/\n        audioElement: function () {\n            //IE does not support Audio Object\n            return typeof Audio !== 'undefined' ? new Audio(\"\") : document.createElement('audio');\n        },\n\n        /**@\n         * #Crafty.audio.create\n         * @comp Crafty.audio\n         * @kind Method\n         * @private\n         * \n         * @sign public this Crafty.audio.create(String id, String url)\n         * @param id - A string to refer to sounds\n         * @param url - A string pointing to the sound file\n         *\n         * Creates an audio asset with the given id and resource.  `Crafty.audio.add` is a more flexible interface that allows cross-browser compatibility.\n         *\n         * If the sound file extension is not supported, returns false; otherwise, returns the audio asset.\n         */\n        create: function (id, path) {\n            //check extension, return if not supported\n            var ext = path.substr(path.lastIndexOf('.') + 1).toLowerCase();\n            if (!this.supports(ext))\n                return false;\n\n            //initiate the audio element\n            var audio = this.audioElement();\n            audio.id = id;\n            audio.preload = \"auto\";\n            audio.volume = Crafty.audio.volume;\n            audio.src = path;\n\n            //create an asset and metadata for the audio element\n            Crafty.asset(path, audio);\n            this.sounds[id] = {\n                obj: audio,\n                played: 0,\n                volume: Crafty.audio.volume\n            };\n            return this.sounds[id];\n\n        },\n\n        /**@\n         * #Crafty.audio.add\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.add(String id, String url)\n         * @param id - A string to refer to sounds\n         * @param url - A string pointing to the sound file\n         * @sign public this Crafty.audio.add(String id, Array urls)\n         * @param urls - Array of urls pointing to different format of the same sound, selecting the first that is playable\n         * @sign public this Crafty.audio.add(Object map)\n         * @param map - key-value pairs where the key is the `id` and the value is either a `url` or `urls`\n         *\n         * Loads a sound to be played. Due to the nature of HTML5 audio,\n         * three types of audio files will be required for cross-browser capabilities.\n         * These formats are MP3, Ogg and WAV.\n         *\n         * Passing an array of URLs will determine which format the browser can play and select it over any other.\n         *\n         * Accepts an object where the key is the audio name and\n         * either a URL or an Array of URLs (to determine which type to use).\n         *\n         * The ID you use will be how you refer to that sound when using `Crafty.audio.play`.\n         *\n         * @example\n         * ~~~\n         * //adding audio from an object\n         * Crafty.audio.add({\n         *   shoot: [\"sounds/shoot.wav\",\n         *           \"sounds/shoot.mp3\",\n         *           \"sounds/shoot.ogg\"]\n         * });\n         *\n         * //adding a single sound\n         * Crafty.audio.add(\"walk\", [\n         * \"sounds/walk.mp3\",\n         * \"sounds/walk.ogg\",\n         * \"sounds/walk.wav\"\n         * ]);\n         *\n         * //only one format\n         * Crafty.audio.add(\"jump\", \"sounds/jump.mp3\");\n         * ~~~\n         */\n        add: function (id, url) {\n            if (!Crafty.support.audio)\n                return;\n\n            var src,\n                a;\n\n            if (arguments.length === 1 && typeof id === \"object\") {\n                for (var i in id) {\n                    for (src in id[i]) {\n                        a = Crafty.audio.create(i, id[i][src]);\n                        if (a){\n                            break;\n                        }\n                    }\n                }\n            }\n            if (typeof id === \"string\") {\n                if (typeof url === \"string\") {\n                    a = Crafty.audio.create(id, url);\n                }\n\n                if (typeof url === \"object\") {\n                    for (src in url) {\n                        a = Crafty.audio.create(id, url[src]);\n                        if (a)\n                            break;\n                    }\n                }\n\n            }\n            return a;\n        },\n        /**@\n         * #Crafty.audio.play\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.play(String id)\n         * @sign public this Crafty.audio.play(String id, Number repeatCount)\n         * @sign public this Crafty.audio.play(String id, Number repeatCount, Number volume)\n         * @param id - A string to refer to sounds\n         * @param repeatCount - Repeat count for the file, where -1 stands for repeat forever.\n         * @param volume - volume can be a number between 0.0 and 1.0\n         * @returns The audio element used to play the sound.  Null if the call failed due to a lack of open channels.\n         *\n         * Will play a sound previously added by using the ID that was used in `Crafty.audio.add`.\n         * Has a default maximum of 5 channels so that the same sound can play simultaneously unless all of the channels are playing.\n\n         * *Note that the implementation of HTML5 Audio is buggy at best.*\n         *\n         * @example\n         * ~~~\n         * Crafty.audio.play(\"walk\");\n         *\n         * //play and repeat forever\n         * Crafty.audio.play(\"backgroundMusic\", -1);\n         * Crafty.audio.play(\"explosion\",1,0.5); //play sound once with volume of 50%\n         * ~~~\n         */\n        play: function (id, repeat, volume) {\n            if (repeat === 0 || !Crafty.support.audio || !this.sounds[id])\n                return;\n            var s = this.sounds[id];\n            var c = this.getOpenChannel();\n            if (!c)\n                return null;\n            c.id = id;\n            c.repeat = repeat;\n            var a = c.obj;\n\n\n            c.volume = s.volume = s.obj.volume = volume || Crafty.audio.volume;\n\n            a.volume = s.volume;\n            a.src = s.obj.src;\n\n            if (this.muted)\n                a.volume = 0;\n            a.play();\n            s.played++;\n            c.onEnd = function () {\n                if (s.played < c.repeat || c.repeat === -1) {\n                    if (this.currentTime)\n                        this.currentTime = 0;\n                    this.play();\n                    s.played++;\n                } else {\n                    c.active = false;\n                    this.pause();\n                    this.removeEventListener(\"ended\", c.onEnd, true);\n                    this.currentTime = 0;\n                    Crafty.trigger(\"SoundComplete\", {\n                        id: c.id\n                    });\n                }\n\n            };\n            a.addEventListener(\"ended\", c.onEnd, true);\n\n            return a;\n        },\n\n\n\n        /**@\n         * #Crafty.audio.setChannels\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.setChannels(Number n)\n         * @param n - The maximum number of channels\n         */\n        maxChannels: 7,\n        setChannels: function (n) {\n            this.maxChannels = n;\n            if (n < this.channels.length)\n                this.channels.length = n;\n        },\n\n        channels: [],\n        // Finds an unused audio element, marks it as in use, and return it.\n        getOpenChannel: function () {\n            for (var i = 0; i < this.channels.length; i++) {\n                var chan = this.channels[i];\n                  /*\n                   * Second test looks for stuff that's out of use,\n                   * but fallen foul of Chromium bug 280417\n                   */\n                if (chan.active === false ||\n                      chan.obj.ended && chan.repeat <= this.sounds[chan.id].played) {\n                    chan.active = true;\n                    return chan;\n                }\n            }\n            // If necessary, create a new element, unless we've already reached the max limit\n            if (i < this.maxChannels) {\n                var c = {\n                    obj: this.audioElement(),\n                    active: true,\n                    // Checks that the channel is being used to play sound id\n                    _is: function (id) {\n                        return this.id === id && this.active;\n                    }\n                };\n                this.channels.push(c);\n                return c;\n            }\n            // In that case, return null\n            return null;\n        },\n\n        /**@\n         * #Crafty.audio.remove\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.remove([String id])\n         * @param id - A string to refer to sounds\n         *\n         * Will stop the sound and remove all references to the audio object allowing the browser to free the memory.\n         * If no id is given, all sounds will be removed.\n         * \n         * This function uses audio path set in Crafty.path in order to remove sound from the assets object.\n         *\n         * @example\n         * ~~~\n         * Crafty.audio.remove(\"walk\");\n         * ~~~\n         */\n        remove: function (id) {\n            if (!Crafty.support.audio)\n                return;\n\n            var s, filename, audioFolder = Crafty.paths().audio;\n\n            if (!id) {\n                for (var i in this.sounds) {\n                    s = this.sounds[i];\n                    filename = s.obj.src.split('/').pop();\n                    Crafty.audio.stop(id);\n                    delete Crafty.assets[audioFolder + filename];\n                    delete Crafty.assets[s.obj.src];\n                    delete Crafty.audio.sounds[id];\n                }\n                return;\n            }\n            if (!this.sounds[id])\n                return;\n\n            s = this.sounds[id];\n            filename = s.obj.src.split('/').pop();\n            Crafty.audio.stop(id);\n            delete Crafty.assets[audioFolder + filename];\n            delete Crafty.assets[s.obj.src];\n            delete Crafty.audio.sounds[id];\n        },\n        /**@\n         * #Crafty.audio.stop\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.stop([Number ID])\n         *\n         * Stops any playing sound. if id is not set, stop all sounds which are playing\n         *\n         * @example\n         * ~~~\n         * //all sounds stopped playing now\n         * Crafty.audio.stop();\n         *\n         * ~~~\n         */\n        stop: function (id) {\n            if (!Crafty.support.audio)\n                return;\n            var c;\n            for (var i in this.channels) {\n                c = this.channels[i];\n                if ( (!id && c.active) || c._is(id) ) {\n                    c.active = false;\n                    c.obj.pause();\n                }\n            }\n            return;\n        },\n        /**\n         * #Crafty.audio._mute\n         * @comp Crafty.audio\n         * @kind Method\n         * @kind private\n         * \n         * @sign public this Crafty.audio._mute([Boolean mute])\n         *\n         * Mute or unmute every Audio instance that is playing.\n         */\n        _mute: function (mute) {\n            if (!Crafty.support.audio)\n                return;\n            var c;\n            for (var i in this.channels) {\n                c = this.channels[i];\n                c.obj.volume = mute ? 0 : c.volume;\n            }\n            this.muted = mute;\n        },\n        /**@\n         * #Crafty.audio.toggleMute\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.toggleMute()\n         *\n         * Mute or unmute every Audio instance that is playing. Toggles between\n         * pausing or playing depending on the state.\n         *\n         * @example\n         * ~~~\n         * //toggle mute and unmute depending on current state\n         * Crafty.audio.toggleMute();\n         * ~~~\n         */\n        toggleMute: function () {\n            if (!this.muted) {\n                this._mute(true);\n            } else {\n                this._mute(false);\n            }\n\n        },\n        /**@\n         * #Crafty.audio.mute\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.mute()\n         *\n         * Mute every Audio instance that is playing.\n         *\n         * @example\n         * ~~~\n         * Crafty.audio.mute();\n         * ~~~\n         */\n        mute: function () {\n            this._mute(true);\n        },\n        /**@\n         * #Crafty.audio.unmute\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.unmute()\n         *\n         * Unmute every Audio instance that is playing.\n         *\n         * @example\n         * ~~~\n         * Crafty.audio.unmute();\n         * ~~~\n         */\n        unmute: function () {\n            this._mute(false);\n        },\n\n        /**@\n         * #Crafty.audio.pause\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.pause(string ID)\n         * @param {string} id - The id of the audio object to pause\n         *\n         * Pause the Audio instance specified by id param.\n         *\n         * @example\n         * ~~~\n         * Crafty.audio.pause('music');\n         * ~~~\n         *\n         */\n        pause: function (id) {\n            if (!Crafty.support.audio || !id || !this.sounds[id])\n                return;\n            var c;\n            for (var i in this.channels) {\n                c = this.channels[i];\n                if (c._is(id) && !c.obj.paused)\n                    c.obj.pause();\n            }\n\n        },\n\n        /**@\n         * #Crafty.audio.unpause\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.unpause(string ID)\n         * @param {string} id - The id of the audio object to unpause\n         *\n         * Resume playing the Audio instance specified by id param.\n         *\n         * @example\n         * ~~~\n         * Crafty.audio.unpause('music');\n         * ~~~\n         *\n         */\n        unpause: function (id) {\n            if (!Crafty.support.audio || !id || !this.sounds[id])\n                return;\n            var c;\n            for (var i in this.channels) {\n                c = this.channels[i];\n                if (c._is(id) && c.obj.paused)\n                    c.obj.play();\n            }\n        },\n\n        /**@\n         * #Crafty.audio.togglePause\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public this Crafty.audio.togglePause(string ID)\n         * @param {string} id - The id of the audio object to pause/\n         *\n         * Toggle the pause status of the Audio instance specified by id param.\n         *\n         * @example\n         * ~~~\n         * Crafty.audio.togglePause('music');\n         * ~~~\n         *\n         */\n        togglePause: function (id) {\n            if (!Crafty.support.audio || !id || !this.sounds[id])\n                return;\n            var c;\n            for (var i in this.channels) {\n                c = this.channels[i];\n                if (c._is(id)) {\n                    if (c.obj.paused) {\n                        c.obj.play();\n                    } else {\n                        c.obj.pause();\n                    }\n                }\n            }\n        },\n\n        /**@\n         * #Crafty.audio.isPlaying\n         * @comp Crafty.audio\n         * @kind Method\n         * \n         * @sign public Boolean Crafty.audio.isPlaying(string ID)\n         * @param {string} id - The id of the audio object\n         * @return a Boolean indicating whether the audio is playing or not\n         *\n         * Check if audio with the given ID is playing or not (on at least one channel).\n         *\n         * @example\n         * ~~~\n         * var isPlaying = Crafty.audio.isPlaying('music');\n         * ~~~\n         *\n         */\n        isPlaying: function(id) {\n            if (!Crafty.support.audio)\n                return false;\n\n            for (var i in this.channels) {\n                if (this.channels[i]._is(id))\n                    return true;\n            }\n\n            return false;\n        }\n    }\n});\n"},"hash":"21ce4ef2887351224c8bf59897b018bd"}