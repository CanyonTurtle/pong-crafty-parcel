{"dependencies":[{"name":"../core/core.js","loc":{"line":1,"column":21}}],"generated":{"js":"var t=require(\"../core/core.js\");t._registerLayerTemplate(\"Canvas\",{type:\"Canvas\",options:{xResponse:1,yResponse:1,scaleResponse:1,z:0},_dirtyRects:[],_changedObjs:[],layerCount:0,_dirtyViewport:!1,_sort:function(t,e){return t._globalZ-e._globalZ},dirty:function(t){this._changedObjs.push(t)},attach:function(t){t._drawContext=this.context,this.layerCount++},detach:function(t){this.dirty(t),t._drawContext=null,this.layerCount--},context:null,_canvas:null,init:function(){if(!t.support.canvas)return t.trigger(\"NoCanvas\"),void t.stop();this._dirtyRects=[],this._changedObjs=[];var e;(e=document.createElement(\"canvas\")).width=t.viewport.width,e.height=t.viewport.height,e.style.position=\"absolute\",e.style.left=\"0px\",e.style.top=\"0px\",e.style.zIndex=this.options.z,t.stage.elem.appendChild(e),this.context=e.getContext(\"2d\"),this._canvas=e;var i=t.viewport._scale;1!==i&&this.context.scale(i,i),this._setPixelart(t._pixelartEnabled),this.uniqueBind(\"PixelartSet\",this._setPixelart),this.uniqueBind(\"RenderScene\",this._render),this.uniqueBind(\"ViewportResize\",this._resize),this.bind(\"InvalidateViewport\",function(){this._dirtyViewport=!0}),t._addDrawLayerInstance(this)},remove:function(){this._canvas.parentNode.removeChild(this._canvas),t._removeDrawLayerInstance(this)},_render:function(){var t=this._dirtyViewport,e=this._changedObjs.length,i=this.context;if(e||t){var r=this.options;if(t&&r){var n=this._viewportRect(),s=n._scale,a=-n._x*s,h=-n._y*s;i.setTransform(s,0,0,s,Math.round(a),Math.round(h))}e/this.layerCount>.6||t?this._drawAll():this._drawDirty(),this._clean()}},_drawDirty:function(e){e=e||this._viewportRect();var i,r,n,s,a,h,o=this._changedObjs,c=o.length,_=this._dirtyRects,l=t.rectManager,d=l.overlap,g=this.context,u=[],p=[];for(e=l.integerBounds(e),i=0;i<c;i++)this._createDirty(o[i]);for(l.mergeSet(_),c=_.length,i=0;i<c;++i)if(s=_[i],u.length=0,p.length=0,s&&(s=l.integerBounds(s),d(s,e))){for(n=t.map.search(s,!1),g.clearRect(s._x,s._y,s._w,s._h),g.save(),g.beginPath(),g.rect(s._x,s._y,s._w,s._h),g.clip(),r=0,a=n.length;r<a;++r)!u[(h=n[r])[0]]&&h._visible&&h._drawLayer===this&&(u[h[0]]=!0,p.push(h));for(p.sort(this._sort),r=0,a=p.length;r<a;++r){d((h=p[r])._mbr||h,s)&&h.draw(),h._changed=!1}g.closePath(),g.restore()}if(!0===this.debugDirty)for(g.strokeStyle=\"red\",i=0,c=_.length;i<c;++i)s=_[i],g.strokeRect(s._x,s._y,s._w,s._h)},_drawAll:function(e){e=e||this._viewportRect(),e=t.rectManager.integerBounds(e);var i,r=t.map.search(e),n=0,s=r.length;for(this.context.clearRect(e._x,e._y,e._w,e._h),r.sort(this._sort);n<s;n++)(i=r[n])._visible&&i._drawContext===this.context&&(i.draw(this.context),i._changed=!1)},debug:function(){t.log(this._changedObjs)},_clean:function(){var t,e,i,r,n=this._changedObjs;for(i=0,r=n.length;i<r;i++)t=(e=n[i])._mbr||e,void 0===e.staleRect&&(e.staleRect={}),e.staleRect._x=t._x,e.staleRect._y=t._y,e.staleRect._w=t._w,e.staleRect._h=t._h,e._changed=!1;n.length=0,this._dirtyRects.length=0,this._dirtyViewport=!1},_createDirty:function(e){var i=e._mbr||e,r=this._dirtyRects,n=t.rectManager;if(e.staleRect){if(n.overlap(e.staleRect,i))return n.merge(e.staleRect,i,e.staleRect),void r.push(e.staleRect);r.push(e.staleRect)}e.currentRect._x=i._x,e.currentRect._y=i._y,e.currentRect._w=i._w,e.currentRect._h=i._h,r.push(e.currentRect)},_resize:function(){var e=this._canvas;e.width=t.viewport.width,e.height=t.viewport.height},_setPixelart:function(t){var e=this.context;e.imageSmoothingEnabled=!t,e.mozImageSmoothingEnabled=!t,e.webkitImageSmoothingEnabled=!t,e.oImageSmoothingEnabled=!t,e.msImageSmoothingEnabled=!t}});"},"hash":"1b010fa08a113cb2dd045e3b605641a6"}