{"dependencies":[{"name":"../core/core.js","loc":{"line":1,"column":21}},{"name":"fs","loc":{"line":4,"column":17}},{"name":"C:\\Users\\canno\\Documents\\Code\\parcel-crafty\\node_modules\\craftyjs\\src\\graphics\\shaders\\sprite.vert","includedInParent":true},{"name":"C:\\Users\\canno\\Documents\\Code\\parcel-crafty\\node_modules\\craftyjs\\src\\graphics\\shaders\\sprite.frag","includedInParent":true}],"generated":{"js":"var i=require(\"../core/core.js\"),t=require(\"fs\");i.defaultShader(\"Sprite\",new i.WebGLShader(\"attribute vec2 aPosition;\\nattribute vec3 aOrientation;\\nattribute vec2 aLayer;\\nattribute vec2 aTextureCoord;\\n\\nvarying mediump vec3 vTextureCoord;\\n\\nuniform vec4 uViewport;\\nuniform mediump vec2 uTextureDimensions;\\n\\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\\n\\nvoid main() {\\n  vec2 pos = aPosition;\\n  vec2 entityOrigin = aOrientation.xy;\\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\\n  \\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\\n}\",\"varying mediump vec3 vTextureCoord;\\n  \\nuniform sampler2D uSampler;\\nuniform mediump vec2 uTextureDimensions;\\n\\nvoid main(void) {\\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\\n  mediump vec4 base_color = texture2D(uSampler, coord);\\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\\n}\",[{name:\"aPosition\",width:2},{name:\"aOrientation\",width:3},{name:\"aLayer\",width:2},{name:\"aTextureCoord\",width:2}],function(i,t){var e=i.co;i.program.writeVector(\"aTextureCoord\",e.x,e.y,e.x,e.y+e.h,e.x+e.w,e.y,e.x+e.w,e.y+e.h)})),i.extend({sprite:function(t,e,r,o,s,a,n){var _,h,d;\"string\"==typeof t&&(a=s,s=o,o=e,r=t,t=1,e=1),\"string\"==typeof e&&(a=s,s=o,o=r,r=e,e=t),!a&&s&&(a=s),s=parseInt(s||0,10),a=parseInt(a||0,10);var c=function(){this.ready=!0,this.trigger(\"Invalidate\")};(d=i.asset(r))||((d=new Image).src=r,i.asset(r,d),d.onload=function(){for(var t in o)i(t).each(c)});var m=function(){this.requires(\"2D, Sprite\"),this.__trim=[0,0,0,0],this.__image=r,this.__map=o,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=t,this.__tileh=e,this.__padding=[s,a],this.__padBorder=n,this.sprite(this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]),this.img=d,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger(\"Invalidate\")),this.w=this.__coord[2],this.h=this.__coord[3],this._setupSpriteImage(this._drawLayer)};for(_ in o)o.hasOwnProperty(_)&&(h=o[_],i.c(_,{ready:!1,__coord:[h[0],h[1],h[2]||1,h[3]||1],init:m}));return this}}),i.c(\"Sprite\",{__image:\"\",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0],this.bind(\"Draw\",this._drawSprite),this.bind(\"LayerAttached\",this._setupSpriteImage)},remove:function(){this.unbind(\"Draw\",this._drawSprite),this.unbind(\"LayerAttached\",this._setupSpriteImage)},_setupSpriteImage:function(t){this.__image&&this.img&&t&&\"WebGL\"===t.type&&(this._establishShader(this.__image,i.defaultShader(\"Sprite\")),this.program.setTexture(t.makeTexture(this.__image,this.img,!1)))},_drawSprite:function(i){var t=i.co,e=i.pos,r=i.ctx;if(\"canvas\"===i.type)r.drawImage(this.img,t.x,t.y,t.w,t.h,e._x,e._y,e._w,e._h);else if(\"DOM\"===i.type){var o=this._h/t.h,s=this._w/t.w,a=this._element.style,n=a.backgroundColor;\"initial\"===n&&(n=\"\");var _=n+\" url('\"+this.__image+\"') no-repeat\";_!==a.background&&(a.background=_),a.backgroundPosition=\"-\"+t.x*s+\"px -\"+t.y*o+\"px\",1===o&&1===s||(a.backgroundSize=this.img.width*s+\"px \"+this.img.height*o+\"px\")}else\"webgl\"===i.type&&i.program.draw(i,this)},sprite:function(i,t,e,r){if(\"string\"==typeof i){var o=this.__map[i];if(!o)return this;i=o[0],t=o[1],e=o[2]||1,r=o[3]||1}return this.__coord=this.__coord||[0,0,0,0],this.__coord[0]=i*(this.__tile+this.__padding[0])+(this.__padBorder?this.__padding[0]:0)+this.__trim[0],this.__coord[1]=t*(this.__tileh+this.__padding[1])+(this.__padBorder?this.__padding[1]:0)+this.__trim[1],void 0!==e&&void 0!==r&&(this.__coord[2]=this.__trim[2]||e*this.__tile||this.__tile,this.__coord[3]=this.__trim[3]||r*this.__tileh||this.__tileh),this.trigger(\"Invalidate\"),this},crop:function(i,t,e,r){var o=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=i,this.__trim[1]=t,this.__trim[2]=e,this.__trim[3]=r,this.__coord[0]+=i,this.__coord[1]+=t,this.__coord[2]=e,this.__coord[3]=r,this._w=e,this._h=r,this.trigger(\"Invalidate\",o),this}});"},"hash":"fc8227ba1b792a938f192e9c505991ea"}