{"dependencies":[{"name":"../core/core.js","loc":{"line":1,"column":21}}],"generated":{"js":"var i=require(\"../core/core.js\"),t=Math.PI/180,n=1e-6;i.extend({raycast:function(t,s){for(var r,e,h=\"obj\",o=1/0,a=!0,c=2,l=arguments.length;c<l;++c)\"number\"===(e=typeof(r=arguments[c]))?o=r+n:\"string\"===e?h=r:\"boolean\"===e&&(a=r);var u=t._x,_=t._y,f=s.x,p=s.y,b={},d=[];if(o<0){var g=null,m=1/0;i.map.traverseRay(t,s,function(i,n){if(g&&m<n)return d.push({obj:g,distance:m,x:u+m*f,y:_+m*p}),g=null,m=1/0,!0;if(i.map&&i.__c[h]&&!b[i[0]]){b[i[0]]=!0;var r=i.map.intersectRay(t,s);r<m&&(g=i,m=r)}}),g&&d.push({obj:g,distance:m,x:u+m*f,y:_+m*p})}else i.map.traverseRay(t,s,function(i,n){if(n>o)return!0;if(i.map&&i.__c[h]&&!b[i[0]]){b[i[0]]=!0;var r=i.map.intersectRay(t,s);r<o&&d.push({obj:i,distance:r,x:u+r*f,y:_+r*p})}});return a&&d.sort(function(i,t){return i.distance-t.distance}),d}}),i.c(\"Collision\",{init:function(){this.requires(\"2D\"),this._collisionData={},this.collision()},remove:function(){this._cbr=null,this.unbind(\"Resize\",this._resizeMap),this.unbind(\"Resize\",this._checkBounds)},collision:function(n){if(this.unbind(\"Resize\",this._resizeMap),this.unbind(\"Resize\",this._checkBounds),n){if(arguments.length>1){var s=Array.prototype.slice.call(arguments,0);n=new i.polygon(s)}else n=n.constructor===Array?new i.polygon(n.slice()):n.clone();this._findBounds(n.points)}else n=new i.polygon([0,0,this._w,0,this._w,this._h,0,this._h]),this.bind(\"Resize\",this._resizeMap),this._cbr=null;return this.rotation&&n.rotate({cos:Math.cos(-this.rotation*t),sin:Math.sin(-this.rotation*t),o:{x:this._origin.x,y:this._origin.y}}),this.map=n,this.attach(this.map),this.map.shift(this._x,this._y),this.trigger(\"NewHitbox\",n),this},cbr:function(i){return i=i||{},this._cbr?(i._x=this._cbr._x,i._y=this._cbr._y,i._w=this._cbr._w,i._h=this._cbr._h,i):this.mbr(i)},_findBounds:function(i){for(var t=1/0,n=-1/0,s=1/0,r=-1/0,e=i.length,h=0;h<e;h+=2)i[h]<t&&(t=i[h]),i[h]>n&&(n=i[h]),i[h+1]<s&&(s=i[h+1]),i[h+1]>r&&(r=i[h+1]);var o={cx:(t+n)/2,cy:(s+r)/2,r:Math.sqrt((n-t)*(n-t)+(r-s)*(r-s))/2};return t>=0&&s>=0&&(this._checkBounds=function(){null===this._cbr&&this._w<n||this._h<r?(this._cbr=o,this._calculateMBR()):this._cbr&&(this._cbr=null,this._calculateMBR())},this.bind(\"Resize\",this._checkBounds)),t>=0&&s>=0&&n<=this._w&&r<=this._h?(this._cbr=null,!1):(this._cbr=o,this._calculateMBR(),!0)},_resizeMap:function(i){var n,s,r=this.rotation*t,e=this.map.points;\"w\"===i.axis?(r?(n=i.amount*Math.cos(r),s=i.amount*Math.sin(r)):(n=i.amount,s=0),e[2]+=n,e[3]+=s):(r?(s=i.amount*Math.cos(r),n=-i.amount*Math.sin(r)):(n=0,s=i.amount),e[6]+=n,e[7]+=s),e[4]+=n,e[5]+=s},hit:function(t){var n,s,r,e,h=this._cbr||this._mbr||this,o=i.map.search(h,!1),a=0,c=o.length,l={},u=i.rectManager.overlap,_=\"map\"in this&&\"containsPoint\"in this.map,f=[];if(!c)return null;for(;a<c;++a)r=(s=o[a])._cbr||s._mbr||s,s&&!l[n=s[0]]&&this[0]!==n&&s.__c[t]&&u(r,h)&&(l[n]=s);for(e in l)if(s=l[e],_&&\"map\"in s){var p=this._SAT(this.map,s.map);p.obj=s,p.type=\"SAT\",p&&f.push(p)}else f.push({obj:s,type:\"MBR\"});return f.length?f:null},onHit:function(i,t,n){var s=!1;return this.bind(\"EnterFrame\",function(){var r=this.hit(i);r?(t.call(this,r,!s),s=!0):s&&(\"function\"==typeof n&&n.call(this),s=!1)}),this},_createCollisionHandler:function(i,t){return function(){var n=this.hit(i);if(!0===t.occurring){if(null!==n)return;t.occurring=!1,this.trigger(\"HitOff\",i)}else null!==n&&(t.occurring=!0,this.trigger(\"HitOn\",n))}},checkHits:function(){var i=arguments,t=0;for(1===i.length&&(i=i[0].split(/\\s*,\\s*/));t<i.length;++t){var n=i[t],s=this._collisionData[n];void 0===s&&(this._collisionData[n]=s={occurring:!1,handler:null},s.handler=this._createCollisionHandler(n,s),this.bind(\"EnterFrame\",s.handler))}return this},ignoreHits:function(){var i,t=arguments,n=0;if(0===t.length){for(i in this._collisionData)this.unbind(\"EnterFrame\",i.handler);this._collisionData={}}for(1===t.length&&(t=t[0].split(/\\s*,\\s*/));n<t.length;++n){var s=t[n];void 0!==(i=this._collisionData[s])&&(this.unbind(\"EnterFrame\",i.handler),delete this._collisionData[s])}return this},resetHitChecks:function(){var i,t=arguments,n=0;if(0===t.length)for(i in this._collisionData)this._collisionData[i].occurring=!1;for(1===t.length&&(t=t[0].split(/\\s*,\\s*/));n<t.length;++n){var s=t[n];void 0!==(i=this._collisionData[s])&&(i.occurring=!1)}return this},_SAT:function(i,t){for(var n,s,r,e,h,o,a,c,l,u=0,_=i.points,f=t.points,p=_.length/2,b=f.length/2,d=0,g=0,m=-1/0,v=null,y=null;u<p;u++){for(l=u===p-1?0:u+1,d=-(_[2*u+1]-_[2*l+1]),g=_[2*u]-_[2*l],d/=s=Math.sqrt(d*d+g*g),g/=s,r=e=1/0,h=o=-1/0,n=0;n<p;++n)(c=_[2*n]*d+_[2*n+1]*g)>h&&(h=c),c<r&&(r=c);for(n=0;n<b;++n)(c=f[2*n]*d+f[2*n+1]*g)>o&&(o=c),c<e&&(e=c);if(r<e?(a=e-h,d=-d,g=-g):a=r-o,a>=0)return!1;a>m&&(m=a,v=d,y=g)}for(u=0;u<b;u++){for(l=u===b-1?0:u+1,d=-(f[2*u+1]-f[2*l+1]),g=f[2*u]-f[2*l],d/=s=Math.sqrt(d*d+g*g),g/=s,r=e=1/0,h=o=-1/0,n=0;n<p;++n)(c=_[2*n]*d+_[2*n+1]*g)>h&&(h=c),c<r&&(r=c);for(n=0;n<b;++n)(c=f[2*n]*d+f[2*n+1]*g)>o&&(o=c),c<e&&(e=c);if(r<e?(a=e-h,d=-d,g=-g):a=r-o,a>=0)return!1;a>m&&(m=a,v=d,y=g)}return{overlap:m,normal:{x:v,y:y}}}});"},"hash":"7c47df834ecfc884e3477ceb2c88ae5a"}