{"dependencies":[{"name":"../core/core.js","loc":{"line":1,"column":21}}],"generated":{"js":"var Crafty = require('../core/core.js');\n\n\nCrafty.extend({\n    /**@\n     * #Crafty.device\n     * @category Misc\n     * @kind Property\n     *\n     * Methods relating to devices such as tablets or phones\n     */\n    device: {\n        _deviceOrientationCallback: false,\n        _deviceMotionCallback: false,\n\n        /**\n         * The HTML5 DeviceOrientation event returns three pieces of data:\n         *  * alpha the direction the device is facing according to the compass\n         *  * beta the angle in degrees the device is tilted front-to-back\n         *  * gamma the angle in degrees the device is tilted left-to-right.\n         *  * The angles values increase as you tilt the device to the right or towards you.\n         *\n         * Since Firefox uses the MozOrientationEvent which returns similar data but\n         * using different parameters and a different measurement system, we want to\n         * normalize that before we pass it to our _deviceOrientationCallback function.\n         *\n         * @param eventData HTML5 DeviceOrientation event\n         */\n        _normalizeDeviceOrientation: function (eventData) {\n            var data;\n            if (window.DeviceOrientationEvent) {\n                data = {\n                    // gamma is the left-to-right tilt in degrees, where right is positive\n                    'tiltLR': eventData.gamma,\n                    // beta is the front-to-back tilt in degrees, where front is positive\n                    'tiltFB': eventData.beta,\n                    // alpha is the compass direction the device is facing in degrees\n                    'dir': eventData.alpha,\n                    // deviceorientation does not provide this data\n                    'motUD': null\n                };\n            } else if (window.OrientationEvent) {\n                data = {\n                    // x is the left-to-right tilt from -1 to +1, so we need to convert to degrees\n                    'tiltLR': eventData.x * 90,\n                    // y is the front-to-back tilt from -1 to +1, so we need to convert to degrees\n                    // We also need to invert the value so tilting the device towards us (forward)\n                    // results in a positive value.\n                    'tiltFB': eventData.y * -90,\n                    // MozOrientation does not provide this data\n                    'dir': null,\n                    // z is the vertical acceleration of the device\n                    'motUD': eventData.z\n                };\n            }\n\n            Crafty.device._deviceOrientationCallback(data);\n        },\n\n        /**\n         * @param eventData HTML5 DeviceMotion event\n         */\n        _normalizeDeviceMotion: function (eventData) {\n            var acceleration = eventData.accelerationIncludingGravity,\n                facingUp = (acceleration.z > 0) ? +1 : -1;\n\n            var data = {\n                // Grab the acceleration including gravity from the results\n                'acceleration': acceleration,\n                'rawAcceleration': \"[\" + Math.round(acceleration.x) + \", \" + Math.round(acceleration.y) + \", \" + Math.round(acceleration.z) + \"]\",\n                // Z is the acceleration in the Z axis, and if the device is facing up or down\n                'facingUp': facingUp,\n                // Convert the value from acceleration to degrees acceleration.x|y is the\n                // acceleration according to gravity, we'll assume we're on Earth and divide\n                // by 9.81 (earth gravity) to get a percentage value, and then multiply that\n                // by 90 to convert to degrees.\n                'tiltLR': Math.round(((acceleration.x) / 9.81) * -90),\n                'tiltFB': Math.round(((acceleration.y + 9.81) / 9.81) * 90 * facingUp)\n            };\n\n            Crafty.device._deviceMotionCallback(data);\n        },\n\n        /**@\n         * #Crafty.device.deviceOrientation\n         * @comp Crafty.device\n         * @kind Method\n         * \n         * @sign public Crafty.device.deviceOrientation(Function callback)\n         * @param callback - Callback method executed once as soon as device orientation is change\n         *\n         * Do something with normalized device orientation data:\n         * ~~~\n         * {\n         *   tiltLR    :   'gamma -- the angle in degrees the device is tilted left-to-right.',\n         *   tiltFB    :   'beta -- the angle in degrees the device is tilted front-to-back',\n         *   dir       :   'alpha -- the direction the device is facing according to the compass',\n         *   motUD     :   'The angle's values increase as you tilt the device to the right or towards you.'\n         * }\n         * ~~~\n         *\n         * @example\n         * ~~~\n         * // Get DeviceOrientation event normalized data.\n         * Crafty.device.deviceOrientation(function(data){\n         *     Crafty.log('data.tiltLR : '+Math.round(data.tiltLR)+', data.tiltFB : '+Math.round(data.tiltFB)+', data.dir : '+Math.round(data.dir)+', data.motUD : '+data.motUD+'');\n         * });\n         * ~~~\n         *\n         * See browser support at http://caniuse.com/#search=device orientation.\n         */\n        deviceOrientation: function (func) {\n            this._deviceOrientationCallback = func;\n            if (Crafty.support.deviceorientation) {\n                if (window.DeviceOrientationEvent) {\n                    // Listen for the deviceorientation event and handle DeviceOrientationEvent object\n                    Crafty.addEvent(this, window, 'deviceorientation', this._normalizeDeviceOrientation);\n                } else if (window.OrientationEvent) {\n                    // Listen for the MozOrientation event and handle OrientationData object\n                    Crafty.addEvent(this, window, 'MozOrientation', this._normalizeDeviceOrientation);\n                }\n            }\n        },\n\n        /**@\n         * #Crafty.device.deviceMotion\n         * @comp Crafty.device\n         * @kind Method\n         * \n         * @sign public Crafty.device.deviceMotion(Function callback)\n         * @param callback - Callback method executed once as soon as device motion is change\n         *\n         * Do something with normalized device motion data:\n         * ~~~\n         * {\n         *     acceleration : 'Grab the acceleration including gravity from the results',\n         *     rawAcceleration : 'Display the raw acceleration data',\n         *     facingUp : 'Z is the acceleration in the Z axis, and if the device is facing up or down',\n         *     tiltLR : 'Convert the value from acceleration to degrees. acceleration.x is the acceleration according to gravity, we'll assume we're on Earth and divide by 9.81 (earth gravity) to get a percentage value, and then multiply that by 90 to convert to degrees.',\n         *     tiltFB : 'Convert the value from acceleration to degrees.'\n         * }\n         * ~~~\n         *\n         * @example\n         * ~~~\n         * // Get DeviceMotion event normalized data.\n         * Crafty.device.deviceMotion(function(data){\n         *     Crafty.log('data.moAccel : '+data.rawAcceleration+', data.moCalcTiltLR : '+Math.round(data.tiltLR)+', data.moCalcTiltFB : '+Math.round(data.tiltFB)+'');\n         * });\n         * ~~~\n         *\n         * See browser support at http://caniuse.com/#search=motion.\n         */\n        deviceMotion: function (func) {\n            this._deviceMotionCallback = func;\n            if (Crafty.support.devicemotion) {\n                if (window.DeviceMotionEvent) {\n                    // Listen for the devicemotion event and handle DeviceMotionEvent object\n                    Crafty.addEvent(this, window, 'devicemotion', this._normalizeDeviceMotion);\n                }\n            }\n        }\n    }\n});\n"},"hash":"55c751648a25afd0268eb5cdb42e05ec"}