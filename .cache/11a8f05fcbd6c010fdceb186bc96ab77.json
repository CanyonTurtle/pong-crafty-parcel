{"dependencies":[{"name":"../core/core.js","loc":{"line":1,"column":21}}],"generated":{"js":"var e=require(\"../core/core.js\"),t=window.document;e.extend({over:null,mouseObjs:0,mousePos:{},touchObjs:0,lastEvent:null,keydown:{},selected:!1,detectBlur:function(t){var o=t.clientX>e.stage.x&&t.clientX<e.stage.x+e.viewport.width&&t.clientY>e.stage.y&&t.clientY<e.stage.y+e.viewport.height;!e.selected&&o&&e.trigger(\"CraftyFocus\"),e.selected&&!o&&e.trigger(\"CraftyBlur\"),e.selected=o},multitouch:function(e){if(\"boolean\"!=typeof e)return this._touchHandler.multitouch;this._touchHandler.multitouch=e},resetKeyDown:function(){for(var t in e.keys)e.keydown[e.keys[t]]&&this.trigger(\"KeyUp\",{key:e.keys[t]});e.keydown={}},mouseButtonsDown:{},mouseDispatch:function(t){if(e.mouseObjs){e.lastEvent=t;var o,s=t.target?t.target:t.srcElement,n=e.domHelper.translate(t.clientX,t.clientY),i=t.type;void 0===t.which?t.mouseButton=t.button<2?e.mouseButtons.LEFT:4===t.button?e.mouseButtons.MIDDLE:e.mouseButtons.RIGHT:t.mouseButton=t.which<2?e.mouseButtons.LEFT:2===t.which?e.mouseButtons.MIDDLE:e.mouseButtons.RIGHT,e.mousePos.x=n.x,e.mousePos.y=n.y,\"mousedown\"===i&&(this.mouseButtonsDown[t.mouseButton]=!0),\"mouseup\"===i&&delete this.mouseButtonsDown[t.mouseButton],(o=e.findPointerEventTargetByComponent(\"Mouse\",t,s))?\"mousedown\"===i?o.trigger(\"MouseDown\",t):\"mouseup\"===i?o.trigger(\"MouseUp\",t):\"dblclick\"===i?o.trigger(\"DoubleClick\",t):\"click\"===i?o.trigger(\"Click\",t):\"mousemove\"===i?(o.trigger(\"MouseMove\",t),this.over!==o&&(this.over&&(this.over.trigger(\"MouseOut\",t),this.over=null),this.over=o,o.trigger(\"MouseOver\",t))):o.trigger(i,t):(\"mousemove\"===i&&this.over&&(this.over.trigger(\"MouseOut\",t),this.over=null),\"mousedown\"===i?e.viewport.mouselook(\"start\",t):\"mousemove\"===i?e.viewport.mouselook(\"drag\",t):\"mouseup\"===i&&e.viewport.mouselook(\"stop\"),\"mousedown\"===i?e.s(\"Controls\").trigger(\"MouseDown\",t):\"mouseup\"===i?e.s(\"Controls\").trigger(\"MouseUp\",t):\"dblclick\"===i?e.s(\"Controls\").trigger(\"DoubleClick\",t):\"click\"===i&&e.s(\"Controls\").trigger(\"Click\",t)),\"mousemove\"===i&&(this.lastEvent=t)}},touchDispatch:function(t){if(e.touchObjs||e.mouseObjs){if(this._touchHandler.multitouch)switch(t.type){case\"touchstart\":this._touchHandler.handleStart(t);break;case\"touchmove\":this._touchHandler.handleMove(t);break;case\"touchleave\":case\"touchcancel\":case\"touchend\":this._touchHandler.handleEnd(t)}else this._touchHandler.mimicMouse(t);t.target&&\"INPUT\"!==t.target.nodeName&&\"TEXTAREA\"!==t.target.nodeName&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}},_touchHandler:{fingers:[],multitouch:!1,handleStart:function(e){for(var t=e.changedTouches,o=0,s=t.length;o<s;o++){var n,i=!1,r=e.target?e.target:e.srcElement;(n=this.findClosestTouchEntity(t[o],r))&&(n.trigger(\"TouchStart\",t[o]),i=this.fingerDownIndexByEntity(n));var a=this.setTouch(t[o],n);!1!==i&&i>=0?this.fingers[i]=a:this.fingers.push(a)}},handleMove:function(e){for(var t=e.changedTouches,o=0,s=t.length;o<s;o++){var n=this.fingerDownIndexById(t[o].identifier),i=e.target?e.target:e.srcElement,r=this.findClosestTouchEntity(t[o],i);if(n>=0){var a=this.fingers[n];void 0!==a.entity&&(a.entity===r?a.entity.trigger(\"TouchMove\",t[o]):(\"object\"==typeof r&&r.trigger(\"TouchStart\",t[o]),a.entity.trigger(\"TouchEnd\"))),a.entity=r,a.realX=t[o].realX,a.realY=t[o].realY}}},handleEnd:function(e){for(var t=e.changedTouches,o=\"touchcancel\"===e.type?\"TouchCancel\":\"TouchEnd\",s=0,n=t.length;s<n;s++){var i=this.fingerDownIndexById(t[s].identifier);i>=0&&(this.fingers[i].entity&&this.fingers[i].entity.trigger(o),this.fingers.splice(i,1))}},setTouch:function(e,t){return{identifier:e.identifier,realX:e.realX,realY:e.realY,entity:t}},findClosestTouchEntity:function(t,o){return e.findPointerEventTargetByComponent(\"Touch\",t,o)},fingerDownIndexById:function(e){for(var t=0,o=this.fingers.length;t<o;t++){if(this.fingers[t].identifier===e)return t}return-1},fingerDownIndexByEntity:function(e){for(var t=0,o=this.fingers.length;t<o;t++){if(this.fingers[t].entity===e)return t}return-1},mimicMouse:function(o){var s,n,i=e.lastEvent;\"touchstart\"===o.type?s=\"mousedown\":\"touchmove\"===o.type?s=\"mousemove\":\"touchend\"===o.type?s=\"mouseup\":\"touchcancel\"===o.type?s=\"mouseup\":\"touchleave\"===o.type&&(s=\"mouseup\"),o.touches&&o.touches.length?n=o.touches[0]:o.changedTouches&&o.changedTouches.length&&(n=o.changedTouches[0]);var r=t.createEvent(\"MouseEvent\");r.initMouseEvent(s,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,o.relatedTarget),n.target.dispatchEvent(r),null!==i&&\"mousedown\"===i.type&&\"mouseup\"===s&&(s=\"click\",(r=t.createEvent(\"MouseEvent\")).initMouseEvent(s,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,o.relatedTarget),n.target.dispatchEvent(r))}},findPointerEventTargetByComponent:function(t,o,s){var n,i,r,a,u,h,c,l=s||e.stage.elem,d=-1/0,g=o.clientX,m=o.clientY;if(\"CANVAS\"!==l.nodeName){for(;\"string\"!=typeof l.id&&-1===l.id.indexOf(\"ent\");)l=l.parentNode;var v=e(parseInt(l.id.replace(\"ent\",\"\"),10));h=e.domHelper.translate(g,m,v._drawLayer),v.__c[t]&&v.isAt(h.x,h.y)&&(n=v,c=h)}if(!n)for(var p in e._drawLayers){var y=e._drawLayers[p];if(!(y._pointerEntities<=0))for(h=e.domHelper.translate(g,m,y),u=0,a=(r=e.map.search({_x:h.x,_y:h.y,_w:1,_h:1},!1)).length;u<a;++u)(i=r[u])._visible&&i._drawLayer===y&&i._globalZ>d&&i.__c[t]&&i.isAt(h.x,h.y)&&(d=i._globalZ,n=i,c=h)}return c||(c=e.domHelper.translate(g,m)),o.realX=c.x,o.realY=c.y,n},mouseWheelDispatch:function(t){t.direction=t.detail<0||t.wheelDelta>0?1:-1,e.trigger(\"MouseWheelScroll\",t)},keyboardDispatch:function(t){for(var o=t,s={},n=\"char charCode keyCode type shiftKey ctrlKey metaKey timestamp\".split(\" \"),i=n.length;i;){var r=n[--i];s[r]=o[r]}if(s.which=null!==o.charCode?o.charCode:o.keyCode,s.key=o.keyCode||o.which,s.originalEvent=o,\"keydown\"===(t=s).type?!0!==e.keydown[t.key]&&(e.keydown[t.key]=!0,e.trigger(\"KeyDown\",t)):\"keyup\"===t.type&&(delete e.keydown[t.key],e.trigger(\"KeyUp\",t)),e.selected&&!(8===t.key||t.key>=112&&t.key<=135))return o.stopPropagation?o.stopPropagation():o.cancelBubble=!0,o.target&&\"INPUT\"!==o.target.nodeName&&\"TEXTAREA\"!==o.target.nodeName&&(o.preventDefault?o.preventDefault():o.returnValue=!1),!1}}),e._preBind(\"Load\",function(){e.addEvent(this,\"keydown\",e.keyboardDispatch),e.addEvent(this,\"keyup\",e.keyboardDispatch),e.addEvent(this,e.stage.elem,\"mousedown\",e.mouseDispatch),e.addEvent(this,e.stage.elem,\"mouseup\",e.mouseDispatch),e.addEvent(this,t.body,\"mouseup\",e.detectBlur),e.addEvent(this,window,\"blur\",e.resetKeyDown),e.addEvent(this,e.stage.elem,\"mousemove\",e.mouseDispatch),e.addEvent(this,e.stage.elem,\"click\",e.mouseDispatch),e.addEvent(this,e.stage.elem,\"dblclick\",e.mouseDispatch),e.addEvent(this,e.stage.elem,\"touchstart\",e.touchDispatch),e.addEvent(this,e.stage.elem,\"touchmove\",e.touchDispatch),e.addEvent(this,e.stage.elem,\"touchend\",e.touchDispatch),e.addEvent(this,e.stage.elem,\"touchcancel\",e.touchDispatch),e.addEvent(this,e.stage.elem,\"touchleave\",e.touchDispatch),\"Moz\"===e.support.prefix?e.addEvent(this,e.stage.elem,\"DOMMouseScroll\",e.mouseWheelDispatch):e.addEvent(this,e.stage.elem,\"mousewheel\",e.mouseWheelDispatch)}),e._preBind(\"CraftyStop\",function(){e.removeEvent(this,\"keydown\",e.keyboardDispatch),e.removeEvent(this,\"keyup\",e.keyboardDispatch),e.stage&&(e.removeEvent(this,e.stage.elem,\"mousedown\",e.mouseDispatch),e.removeEvent(this,e.stage.elem,\"mouseup\",e.mouseDispatch),e.removeEvent(this,e.stage.elem,\"mousemove\",e.mouseDispatch),e.removeEvent(this,e.stage.elem,\"click\",e.mouseDispatch),e.removeEvent(this,e.stage.elem,\"dblclick\",e.mouseDispatch),e.removeEvent(this,e.stage.elem,\"touchstart\",e.touchDispatch),e.removeEvent(this,e.stage.elem,\"touchmove\",e.touchDispatch),e.removeEvent(this,e.stage.elem,\"touchend\",e.touchDispatch),e.removeEvent(this,e.stage.elem,\"touchcancel\",e.touchDispatch),e.removeEvent(this,e.stage.elem,\"touchleave\",e.touchDispatch),\"Moz\"===e.support.prefix?e.removeEvent(this,e.stage.elem,\"DOMMouseScroll\",e.mouseWheelDispatch):e.removeEvent(this,e.stage.elem,\"mousewheel\",e.mouseWheelDispatch)),e.removeEvent(this,t.body,\"mouseup\",e.detectBlur),e.removeEvent(this,window,\"blur\",e.resetKeyDown)}),e.c(\"Mouse\",{init:function(){e.mouseObjs++,this.requires(\"AreaMap\").bind(\"Remove\",function(){e.mouseObjs--})}}),e.c(\"Touch\",{init:function(){e.touchObjs++,this.requires(\"AreaMap\").bind(\"Remove\",function(){e.touchObjs--})}}),e.c(\"AreaMap\",{init:function(){this.has(\"Renderable\")&&this._drawLayer&&this._drawLayer._pointerEntities++},remove:function(){this.has(\"Renderable\")&&this._drawLayer&&this._drawLayer._pointerEntities--},events:{LayerAttached:function(e){e._pointerEntities++},LayerDetached:function(e){e._pointerEntities--}},areaMap:function(t){if(arguments.length>1){var o=Array.prototype.slice.call(arguments,0);t=new e.polygon(o)}else t=t.constructor===Array?new e.polygon(t.slice()):t.clone();return t.shift(this._x,this._y),this.mapArea=t,this.attach(this.mapArea),this.trigger(\"NewAreaMap\",t),this}}),e.c(\"Button\",{init:function(){var t=!e.mobile||e.mobile&&!e.multitouch()?\"Mouse\":\"Touch\";this.requires(t)}}),e.c(\"MouseDrag\",{_dragging:!1,init:function(){this.requires(\"Mouse\"),this.bind(\"MouseDown\",this._ondown)},remove:function(){this.unbind(\"MouseDown\",this._ondown)},_ondown:function(t){t.mouseButton===e.mouseButtons.LEFT&&this.startDrag(t)},_ondrag:function(e){if(!this._dragging||0===e.realX||0===e.realY)return!1;this.trigger(\"Dragging\",e)},_onup:function(t){t.mouseButton===e.mouseButtons.LEFT&&this.stopDrag(t)},startDrag:function(t){if(!this._dragging)return this._dragging=!0,e.addEvent(this,e.stage.elem,\"mousemove\",this._ondrag),e.addEvent(this,e.stage.elem,\"mouseup\",this._onup),this.trigger(\"StartDrag\",t||e.lastEvent),this},stopDrag:function(t){if(this._dragging)return this._dragging=!1,e.removeEvent(this,e.stage.elem,\"mousemove\",this._ondrag),e.removeEvent(this,e.stage.elem,\"mouseup\",this._onup),this.trigger(\"StopDrag\",t||e.lastEvent),this}}),e.c(\"Keyboard\",{isDown:function(t){return\"string\"==typeof t&&(t=e.keys[t]),!!e.keydown[t]}});"},"hash":"530ad7d923d2d0f31e3c32f5574642dd"}